<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <link rel="icon" crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/favicon.ico" />
    <!-- Preload is necessary because we show these images when we disconnect from the server,
    but at that point we cannot load these images from the server -->
    <link rel="preload" crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/gradient-yHQUC_QB.png" as="image" />
    <link rel="preload" crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/noise-60BoTA8O.png" as="image" />
    <!-- Preload the fonts -->
    <link rel="preload" crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/Lora-VariableFont_wght-B2ootaw-.ttf" as="font" crossorigin="anonymous" />
    <link rel="preload" crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/PTSans-Regular-CxL0S8W7.ttf" as="font" crossorigin="anonymous" />
    <link rel="preload" crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/PTSans-Bold-D9fedIX3.ttf" as="font" crossorigin="anonymous" />
    <link rel="preload" crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/FiraMono-Regular-BTCkDNvf.ttf" as="font" crossorigin="anonymous" />
    <link rel="preload" crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/FiraMono-Medium-DU3aDxX5.ttf" as="font" crossorigin="anonymous" />
    <link rel="preload" crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/FiraMono-Bold-CLVRCuM9.ttf" as="font" crossorigin="anonymous" />

    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="theme-color" content="#000000" />
    <meta name="description" content="a marimo app" />
    <link rel="apple-touch-icon" crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/apple-touch-icon.png" />
    <link rel="manifest" crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/manifest.json" />

    <script data-marimo="true">
      function __resizeIframe(obj) {
        const scrollbarHeight = 20; // Max between windows, mac, and linux

        function setHeight() {
          // Guard against race condition where iframe isn't ready
          if (!obj.contentWindow?.document?.documentElement) {
            return;
          }
          const element = obj.contentWindow.document.documentElement;
          // If there is no vertical scrollbar, we don't need to resize the iframe
          if (element.scrollHeight === element.clientHeight) {
            return;
          }

          // Create a new height that includes the scrollbar height if it's visible
          const hasHorizontalScrollbar = element.scrollWidth > element.clientWidth;
          const newHeight = element.scrollHeight + (hasHorizontalScrollbar ? scrollbarHeight : 0);

          // Only update the height if it's different from the current height
          if (obj.style.height !== `${newHeight}px`) {
            obj.style.height = `${newHeight}px`;
          }
        }

        // Resize the iframe to the height of the content and bottom scrollbar height
        setHeight();

        // Resize the iframe when the content changes
        const resizeObserver = new ResizeObserver((_entries) => {
          setHeight();
        });
        // Only observe if iframe content is ready
        if (obj.contentWindow?.document?.body) {
          resizeObserver.observe(obj.contentWindow.document.body);
        }
      }
    </script>
    <marimo-filename hidden>utility-option-pricing.py</marimo-filename>
    <!-- TODO(Trevor): Legacy, required by VS Code plugin. Remove when plugin is updated (see marimo/server/_templates/template.py) -->
    <marimo-version data-version="{{ version }}" hidden></marimo-version>
    <marimo-user-config data-config="{{ user_config }}" hidden></marimo-user-config>
    <marimo-server-token data-token="{{ server_token }}" hidden></marimo-server-token>
    <!-- /TODO -->
    <title>utility-option-pricing</title>
    <script type="module" crossorigin crossorigin="anonymous" src="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/index-3OIHLLq_.js"></script>
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/preload-helper-g1IWzEZ-.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/chunk-LvLJmgfZ.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/react-XTZdWHwa.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/compiler-runtime-QczY1yfQ.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/useEventListener-4mpeqPxW.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/react-dom-BZDtXk6t.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/jsx-runtime-DUsrKwmN.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/Combination-D2HqSOvH.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/clsx-FpJB9huX.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/cn-Cs2e4A8T.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/menu-items-B57SjdWM.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/hotkeys-Dh4gy4JD.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/button-D8mnDDLX.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/dist-Dj-O1Spr.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/createLucideIcon-BJ2I6csQ.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/check-CWbw3kKW.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/select-CgZgQ5hV.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/multi-map-D3NvLiI9.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/chevron-right-B_qBg_RU.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/dropdown-menu-Ciqx4yT-.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/tooltip-DqNvr2Rw.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/_Uint8Array-BGESiCQL.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/_getTag-BWqNuuwU.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/_baseIsEqual-C8v2yRqO.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/jotai-D74Ef_p1.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/invariant-Amh6wt4N.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/isArrayLikeObject-BkJc8lDE.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/merge-5YNOh9ZD.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/zod-BBqism5D.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/utils-x9KlwLm7.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/requests-THIDPq-F.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/once-BxRirs3K.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/toDate-Y5T6FHPx.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/isSymbol-BGkTcW3U.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/toString-DlRqgfqz.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/_baseSlice-BoaxdS7L.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/_hasUnicode-CNlKPr15.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/useLifecycle-8fgb5Nue.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/capitalize-L9-XHPtm.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/ai-model-dropdown-CO52rzQt.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/badge-Cm0WUI-_.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/use-toast-DKTyV2AR.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/constants-BmIIVBf_.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/Deferred-9HYzcD3r.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/config-CbG7e0K6.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/uuid-B8w6pjWV.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/DeferredRequestRegistry-DfLQSvoS.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/connection-B11rCPnY.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/useNonce-D8CLFIrY.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/capabilities-Bdlrhekp.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/createReducer-VgoBNe3M.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/dist-C3a_7WFa.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/dist-0z0sEYV-.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/dist-BzfTz_Dx.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/dist-DmruaXMM.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/dist-DU0YrNRK.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/dist-_bGPtAsk.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/dist-DsSBESho.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/dist-B2TjmP7E.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/dist-BzDb7E9f.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/stex-C4ZxI0N3.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/cjs-Ba5CQnxe.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/_arrayReduce-DdxhySYh.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/type-kFt-n-jZ.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/_baseProperty-D0ckTA0L.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/toNumber-GB_lFVaq.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/now-CAWn5i9V.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/debounce-Bgq-wc7M.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/toInteger-Cl1doThW.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/main-CC_mbgxK.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/cells-DoKM12vd.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/kbd-EdFdwHEs.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/renderShortcut-CLenKJO6.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/useEvent-l9BzRqpK.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/useDeleteCell-BDBSmjLV.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/lazy-Cbg8zRvU.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/defaultLocale-8c1ixjJ_.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/precisionRound-CQhbsDNz.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/defaultLocale-BECdiY5x.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/vega-loader.browser-DZ31-605.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/tooltip-CSAGVmjx.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/ErrorBoundary-6EjkHrSV.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/alert-dialog-D9SwG8oA.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/dialog-BPIq0Dmw.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/useDebounce-C9S6xmGh.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/numbers-BigybruE.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/SSRProvider-DlZbKHsu.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/context-CO64Gasq.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/useNumberFormatter-B5HAJDUq.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/usePress-DHxqjtDm.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/input-CVoLDDk-.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/ImperativeModal-ameyIrhc.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/cell-link-BiAu_8pk.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/alert-D5BMn3Et.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/links-Iv0WhyKW.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/state-i7G4J1VS.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/MarimoErrorOutput-Bh7Bgl2Z.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/copy-BS3uwoaq.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/copy-DhmkXAPp.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/copy-icon-Lyk2_Z8G.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/spinner-DpaQpaiI.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/dist-D1pae9A2.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/focus-CyxSol0W.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/popover-DZBXSGEz.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/useRunCells-DT1En-Te.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/mode-DKDAYLK9.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/purify.es-hXMlfS4W.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/RenderHTML-Dlz0Ew2i.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/table-CesNYRF-.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/tabs-BjAbB8w_.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/add-missing-import-DV1FOw9w.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/useAsyncData-_-DLduEH.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/useIframeCapabilities-r0LQMxAQ.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/LazyAnyLanguageCodeMirror-C7KtNlRp.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/error-banner-C9tkg1MX.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/formats-C3exma5i.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/useTheme-DpA-8Qyy.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/en-US-Lc4gASCJ.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/isValid-Cd_L_2Pm.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/maps-D4abje2p.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/shim-D-ElLTBO.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/download-CCvBQ7qL.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/extends-C2lJEiP_.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/emotion-is-prop-valid.esm-c4A1huxA.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/useDateFormatter-BMdQ9MI_.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/katex-BmfUoCWW.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/marked.esm-idL59iHw.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/chunk-T7OEMACY-CdGEwedE.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/range-Bbli-TEL.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/table-kHJ0xpFt.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/Output-DxdWGPFi.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/name-cell-input-C6ZYU6mN.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/useHotkey-B0ylhc2m.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/dist-CqHWOZu2.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/dist-BcLYYUSi.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/dist-BVXr6b5T.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/dist-BrEX5EQl.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/dist-CalRK9ms.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/dist-Cc4T7UUX.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/dist-D3MC5WiF.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/dist-DgaCIZAa.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/dist-rqHtY98i.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/dist-tj-jaP-y.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/dist-w7c0BKrD.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/dist-CCZcRJI9.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/dist-CrDb6akR.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/apl-BQt6lLuE.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/asciiarmor-BjX7bs0j.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/asn1-xn1MtyoW.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/brainfuck-BjO-UY1i.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/clike-DW9tQWfF.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/clojure-BSW96HRx.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/cmake-C7UlMfz3.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/cobol-CyWIev3Y.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/coffeescript-DTvziYTK.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/commonlisp-yMdkdGMi.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/crystal-BGnoSp3z.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/css-D7fWzevp.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/cypher-Cr1dl0Qf.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/d-C2bS5bA6.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/diff-B2mHQyn6.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/dtd-Cy-lUE7p.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/dylan-mm60grwk.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/ecl-Cqi05Wy1.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/eiffel-FkvfLQq7.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/elm-Da5txHw0.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/erlang-CdnCEH5x.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/simple-mode-B185hCuE.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/factor-CamlR8EJ.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/forth-UcMX0m31.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/fortran-DZ_vNVsP.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/gas-CM88o6Zj.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/gherkin-BhrpTeN9.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/groovy-BFju68Wx.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/haskell-CrWHY4et.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/haxe-1eKW-tbO.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/idl-Do4AwvU2.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/javascript-CTXZKRYd.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/julia-BRynwHI4.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/livescript-ZmIBNA-I.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/lua-mUfZ-MRC.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/mathematica-Dil5dTHO.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/mbox-Dnkn9wSr.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/mirc-auEWieOB.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/mllike-xVJsauJ8.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/modelica-B8kajVDm.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/mscgen-Bsnta1jn.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/mumps-CMw16b5q.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/nsis-DwPdi8sw.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/ntriples-O5lQxirn.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/octave-CMfAar-E.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/oz-CLRI9Qww.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/pascal-D2M_3HBx.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/perl-B8lV7aKt.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/pig-Bima2bfE.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/powershell-v_t41ydu.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/properties-ChrStSby.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/protobuf-Bin6kmlf.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/pug-UWVdYLYW.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/puppet-DYrtWvYn.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/python-BuKrulde.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/q-CrXUTiVN.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/r-Bk2Tiso2.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/rpm-CmmZphz3.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/ruby-ElyOTVeQ.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/sas-jE3ZlG0K.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/scheme-CZF1tRbv.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/shell-LqT3ZqMa.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/sieve-y15yT7Pp.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/smalltalk-pk5PvsMs.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/sparql-DTZ_gfPQ.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/stylus-CrGj0eNT.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/swift-tt3PlBbI.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/tcl-1P4b0GMJ.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/textile-BHDIuMYh.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/toml-C8qoqk_i.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/troff-DMiF5Zmz.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/ttcn-cfg-qLZtNU-E.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/ttcn-BAUp3RZn.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/turtle-BizIwmKv.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/vb-Bn_uCxNL.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/vbscript-BTKW8Atx.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/velocity-CcB05fpi.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/verilog-BWdtOJH8.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/vhdl-CzFOaOHx.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/webidl-DDEKCqSy.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/xquery-BcF6ZhQP.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/yacas-BARQAiXa.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/z80-DO_Ep0iT.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/esm-DnNh7vdQ.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/objectWithoutPropertiesLoose-DDabolgJ.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/esm-Crqxhl3F.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/trash-Df8Wb7xS.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/ConsoleOutput-D8ETq-cc.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/icons-BgmgMjOV.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/blob-LiDbeYko.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/add-cell-with-ai-85tnyxYo.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/chart-no-axes-column-BrQ3B3xc.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/square-function-D5EEjILG.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/spec-DpllSlJD.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/useInstallPackage-BaAhpZlP.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/column-preview-DGBk0umL.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/useAddCell-DYfGo4T8.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/toggle-PGHtwx2G.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/api-CoLss8_O.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/globals-oV9pRUSB.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/share-DjbnD3WE.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/memoize-DN0TMY36.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/get-CyLJYAfP.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/_baseSet-CKSmZC_I.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/utilities.esm-DvrcU9Ky.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/floating-outline-DmCT2Mvg.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/eye-off-BUwXWtH0.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/plus-CiGrWbgb.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/readonly-python-code-CkaJ4Tks.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/file-video-camera-BGBfFNDn.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/file-text-O5IflCIn.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/file-CqXxt3_J.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/types-BMriRmf-.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/label-4Nancvon.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/textarea-BnZHy5Jt.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/circle-x-Cc9X6U_B.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/refresh-ccw-aU2rUkrI.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/trash-2-Du5ITnDv.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/form-600t_Civ.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/field-Dov6YyOV.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/switch-Ct8mUApv.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/useBoolean-Dmwks1uh.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/useDeepCompareMemoize-C8RdAYFq.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/types-D0WVpW93.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/prop-types-WJwGTMoZ.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/es-DAmFxw3U.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/VisuallyHidden-RqykLBKh.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/_baseFlatten-rM2FaX4x.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/hasIn-CE-pxQP-.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/_basePickBy-LbasZ8ix.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/pick-FbHfDtcJ.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/send-LAFRRDPT.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/code-xml-DdSOsi73.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/download-Dmmu2U4a.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/globe-vMZtva7z.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/refresh-cw-BOc7UXm9.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/settings-DznrHqbd.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/square-DhlBDqyx.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/triangle-alert-Bf1kg4xT.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/dist-DL3W3q-2.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/bundle.esm-C-9IAWQU.js">
    <link rel="stylesheet" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/cells-wU8qigWB.css">
    <link rel="stylesheet" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/Output-DUep6sC9.css">
    <link rel="stylesheet" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/ConsoleOutput-BFFTcC5Y.css">
    <link rel="stylesheet" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/index-CJU5NUvF.css">
  
<script data-marimo="true">
    window.__MARIMO_STATIC__ = {};
    window.__MARIMO_STATIC__.files = {};
</script>
</head>
  <body>
    <div id="root"></div>
    <!-- This is a portal for the data editor to render in -->
    <div id="portal" data-testid="glide-portal" style="position: fixed; left: 0; top: 0; z-index: 9999"></div>
    <script data-marimo="true">
      window.__MARIMO_MOUNT_CONFIG__ = {
            "filename": "utility-option-pricing.py",
            "mode": "read",
            "version": "0.18.4",
            "serverToken": "static",
            "config": {"ai": {"models": {"custom_models": [], "displayed_models": []}}, "completion": {"activate_on_typing": true, "copilot": false}, "diagnostics": {"sql_linter": true}, "display": {"cell_output": "below", "code_editor_font_size": 14, "dataframes": "rich", "default_table_max_columns": 50, "default_table_page_size": 10, "default_width": "medium", "reference_highlighting": false, "theme": "light"}, "formatting": {"line_length": 79}, "keymap": {"overrides": {}, "preset": "default"}, "language_servers": {"pylsp": {"enable_flake8": false, "enable_mypy": true, "enable_pydocstyle": false, "enable_pyflakes": false, "enable_pylint": false, "enable_ruff": true, "enabled": false}}, "mcp": {"mcpServers": {}, "presets": []}, "package_management": {"manager": "pip"}, "runtime": {"auto_instantiate": false, "auto_reload": "off", "default_sql_output": "auto", "on_cell_change": "autorun", "output_max_bytes": 8000000, "reactive_tests": true, "std_stream_max_bytes": 1000000, "watcher_on_save": "lazy"}, "save": {"autosave": "after_delay", "autosave_delay": 1000, "format_on_save": false}, "server": {"browser": "default", "follow_symlink": false}, "snippets": {"custom_paths": [], "include_default_snippets": true}},
            "configOverrides": {},
            "appConfig": {"sql_output": "auto", "width": "compact"},
            "view": {"showAppCode": true},
            "notebook": {"cells": [{"code": "mo.md(r\"\"\"![MOSEK ApS](https://www.mosek.com/static/images/branding/webgraphmoseklogocolor.png )\"\"\")", "code_hash": "271c93fd1913447fc8645725a5909adb", "config": {"column": null, "disabled": false, "hide_code": true}, "id": "Hbol", "name": "_"}, {"code": "mo.md(r\"\"\"# Utility based option pricing with transaction costs and diversification\"\"\")", "code_hash": "21b5eab5abf857c28a6431b10b99fda9", "config": {"column": null, "disabled": false, "hide_code": true}, "id": "MJUe", "name": "_"}, {"code": "mo.md(r\"\"\"In this notebook, we present the \u003Ci\u003EFusion\u003C/i\u003E implementation of the utility based option pricing model, presented by [Andersen et. al. (1999)](https://www.sciencedirect.com/science/article/pii/S0168927498001044). The purpose of the model is to estimate the reservation purchase price of a European call option, written on a risky security when there is proportional transaction costs in the market.\"\"\")", "code_hash": "7a586eb7ae8f2d0663f9d7c1b28704cc", "config": {"column": null, "disabled": false, "hide_code": true}, "id": "vblA", "name": "_"}, {"code": "mo.md(r\"\"\"## The Model\"\"\")", "code_hash": "625c77bfdf123262ac44a8d3aeced0ce", "config": {"column": null, "disabled": false, "hide_code": true}, "id": "bkHC", "name": "_"}, {"code": "mo.md(\n    r\"\"\"\nConsider an economy evolving over T periods, ${0,t_1,t_2,t_3,...,t_T = \\overline{T}}$ where $\\overline{T}$ is the time horizon in years. We consider that the investor has one risk-free security, such as a bond, that pays at a constant interest rate of $r\\geq 0$, and $m$ risky securities with price processes denoted by $(S_1,S_2,...,S_m)$. The price of the risky securities evolves in an event tree such that: \n\n$$(S_{1,n},S_{2,n},..,S_{m,n}) = \\begin{cases}\n(a_1 S_{1,n-1}, a_2 S_{2,n-1},..,a_m S_{m,n-1}), \\,\\, \\text{with probability } q_1, \\\\\n(b_1 S_{1,n-1}, b_2 S_{2,n-1},..,b_m S_{m,n-1}), \\,\\, \\text{with probability } q_2, \\\\\n(c_1 S_{1,n-1}, c_2 S_{2,n-1},..,c_m S_{m,n-1}), \\,\\, \\text{with probability } q_3 = (1-q_1-q_2)\n\\end{cases}\n$$\n\n\nwhere the three possibilities lead to an event tree of splitting index 3 (In the fusion model presented below, we have considered a general case where one can have a different splitting index). The event tree for two risky securities can be visualized as shown in the figure below.\n\"\"\"\n)", "code_hash": "feba1d4d019a5b995303a266532dd43d", "config": {"column": null, "disabled": false, "hide_code": true}, "id": "lEQa", "name": "_"}, {"code": "mo.md(\n    r\"\"\"\nLet, $\\mathbf{\\alpha_{n}} = (\\alpha_1,\\alpha_2,...,\\alpha_m)$ denote the number of units of the risky security held by the investor at time $t_n$, and $\\beta_n$ denote the dollar amount held by the investor in bonds at the same time. Then, the \u003Ci\u003E'budget constraint'\u003C/i\u003E on the bonds an investor can buy in the next period is given by:\n\n\n$$\\beta_n(I_n) \\leq (1+r)\\beta_{n-1}(I_n) + \\sum_{i=1}^{m} S_{i,n}(I_n)[\\alpha_{i,n-1}(I_n) - \\alpha_{i,n}(I_n) - \\theta_i |\\alpha_{i,n-1}(I_n) - \\alpha_{i,n}(I_n)|]$$\n\n\nwhere $\\theta_i$ is the transaction cost for trading of risky security $i$ and $I_n$ denotes the path being considered (in other words, the sequence of events in the event tree). The total number of paths possible for a tree of splitting index $s$, over $n$ time periods is $s^n$. Initially, if we consider that the wealth of the investor is $W_0$, then of course the first budget constraint becomes:\n\n$$\\beta_0 \\leq W_0 - \\sum_{i=1}^{m} S_{i,0}[\\alpha_{i,0} + |\\alpha_{i,0}|]$$\n\n\nAdditionally, in the final period the investor will sell all of the risky securities, thus ending up with a wealth $W_T(I_T)$ for path $I_T$, such that:\n\n$$W_T(I_T) \\leq (1+r)\\beta_{T-1}(I_T) + \\sum_{i=1}^{m} S_{i,T}(I_T)[\\alpha_{i,T-1}(I_T) - \\theta_i |\\alpha_{i,T-1}(I_T)|]$$\n\"\"\"\n)", "code_hash": "7b9ae8626bb88b18845ee377ee5ac50a", "config": {"column": null, "disabled": false, "hide_code": true}, "id": "PKri", "name": "_"}, {"code": "mo.md(r\"\"\"### 1.) Portfolio choice\"\"\")", "code_hash": "251fdff7c1f7ef7fdcfc40f07a5eccc2", "config": {"column": null, "disabled": false, "hide_code": true}, "id": "Xref", "name": "_"}, {"code": "mo.md(\n    r\"\"\"\nThe goal of the investor is to choose a portfolio strategy (i.e. the sequence {${\\mathbf{\\alpha_n(I_n)},\\beta_n(I_n)}$}) that maximizes the expected utility. The expected utility is given by:\n\n$$E[U(W_T)] = \\sum_{I_{T}\\in F_T} q_1^{A(I_T)}q_2^{B(I_T)}(1-q_1-q_2)^{T-A(I_T)-B(I_T)}U(W_T(I_T))$$\n\n\nNote that the summation is over all the possible paths for a tree of a given split index and T time-periods (the set denoted by $F_T$). $A(I_T)$ and $B(I_T)$ denote the number of times the first and second possibilities are considered in every path, respectively. Following the equations presented above, the complete optimization problem can be written as:\n\n\n$$U^*(W_0) = \\text{maximize}_{({\\mathbf{\\alpha}_n(I_n),\\beta_n(I_n))}_{I_n\\in F_T,{n=1,2,..,T-1}}}\\,\\,\\,E[U(W_T)]$$\n\n\n$$\\text{subject to:  } \\beta_0 \\leq W_0 - \\sum_{i=1}^{m} S_{i,0}[\\alpha_{i,0} + |\\alpha_{i,0}|],$$\n\n$$\\beta_n(I_n) \\leq (1+r)\\beta_{n-1}(I_n) + \\sum_{i=1}^{m} S_{i,n}(I_n)[\\alpha_{i,n-1}(I_n) - \\alpha_{i,n}(I_n) - \\theta_i |\\alpha_{i,n-1}(I_n) - \\alpha_{i,n}(I_n)|],$$\n\n$$W_T(I_T) \\leq (1+r)\\beta_{T-1}(I_T) + \\sum_{i=1}^{m} S_{i,T}(I_T)[\\alpha_{i,T-1}(I_T) - \\theta_i |\\alpha_{i,T-1}(I_T)|],\\,\\,\\, \\forall I_T\\in F_T$$\n\"\"\"\n)", "code_hash": "31620c238300b47ca5755db9b52e8665", "config": {"column": null, "disabled": false, "hide_code": true}, "id": "SFPL", "name": "_"}, {"code": "mo.md(r\"\"\"### 2.) Price vector process\"\"\")", "code_hash": "0ee83ef9672dbe6532fa07ea1c3fcf27", "config": {"column": null, "disabled": false, "hide_code": true}, "id": "BYtC", "name": "_"}, {"code": "mo.md(\n    r\"\"\"\nThe continuous price process that we intended to approximate is:\n\n$$\\frac{d\\tilde{S_i}}{\\tilde{S_i}} = \\mu_idt + \\sum_{j=1}^{m}\\sigma_{ij} dW_j \\,\\, , \\,\\, \\forall i = 1,2,...,m$$\n\nwhere $\\mu_i$ and $\\sigma_{ij}$ are positive constants and the $W_j$ denote un-correlated standard Wiener processes. To construct a discrete approximation, we first define a stochastic vector as follows:\n\n$$(\\epsilon_1,\\epsilon_2,..,\\epsilon_m) = \\begin{cases}\n(\\epsilon_1 (\\omega_1),\\epsilon_2 (\\omega_1),..,\\epsilon_m (\\omega_1)), \\,\\, \\text{with probability } q_1, \\\\\n(\\epsilon_1 (\\omega_2),\\epsilon_2 (\\omega_2),..,\\epsilon_m (\\omega_2)), \\,\\, \\text{with probability } q_2, \\\\\n(\\epsilon_1 (\\omega_3),\\epsilon_2 (\\omega_3),..,\\epsilon_m (\\omega_3)), \\,\\, \\text{with probability } q_3 = (1-q_1-q_2)\n\\end{cases}\n$$\n\"\"\"\n)", "code_hash": "edfb3022ba0f2d6eeadf78b36f1494ec", "config": {"column": null, "disabled": false, "hide_code": true}, "id": "RGSE", "name": "_"}, {"code": "mo.md(\n    r\"\"\"\nThe equation describing the event tree (first equation of the notebook) becomes a discrete approximation of the above-stated stochastic process if we set:\n\n$$a_i = e^{\\mu_i \\Delta t}\\bigg( \\frac{e^{\\big[\\sum_{j=1}^{m}\\sigma_{ij}\\epsilon_j(\\omega_1)\\sqrt{\\Delta t}\\big]}}{z_i}\\bigg)$$\n\n$$b_i = e^{\\mu_i \\Delta t}\\bigg( \\frac{e^{\\big[\\sum_{j=1}^{m}\\sigma_{ij}\\epsilon_j(\\omega_2)\\sqrt{\\Delta t}\\big]}}{z_i}\\bigg)$$\n\n$$c_i = e^{\\mu_i \\Delta t}\\bigg( \\frac{e^{\\big[\\sum_{j=1}^{m}\\sigma_{ij}\\epsilon_j(\\omega_3)\\sqrt{\\Delta t}\\big]}}{z_i}\\bigg)$$\n\n\n\nIn the limit $T\\to \\infty$ (or alternatively $\\Delta t \\to 0$), the approximation approaches the continuous process.\n\"\"\"\n)", "code_hash": "d5cf2f9daa739a0086250ac5407d2013", "config": {"column": null, "disabled": false, "hide_code": true}, "id": "Kclp", "name": "_"}, {"code": "mo.md(r\"\"\"### 3.) Investor's reservation purchase price for a European call option\"\"\")", "code_hash": "ad62bd21514321339ce843c4b66de78d", "config": {"column": null, "disabled": false, "hide_code": true}, "id": "emfo", "name": "_"}, {"code": "mo.md(r\"\"\"Suppose that an investor is interested in buying a European call option on the security $S_1$, with time to maturity $\\overline{T}$ and a strike price $K\u003E0$. At the expiration time, the investor would get a payment of $\\text{max}(S_{1,T} - K, 0)$ (assuming cash settlement and also that the investor will not be re-selling the option once it has been purchased.) Our goal is now to estimate the highest price this investor is willing to pay, to purchase such an option.\"\"\")", "code_hash": "374db6a77a617b53d589027eb3f99a73", "config": {"column": null, "disabled": false, "hide_code": true}, "id": "Hstk", "name": "_"}, {"code": "mo.md(r\"\"\"If the investor does not purchase the call option and only trades in the risky securities $S_i$ and the bonds, then the portfolio is given by the optimization problem stated above. However, if the investor buys the call option at a reservation purchase price of $C$, then their portfolio becomes the following:\"\"\")", "code_hash": "4d5c2219a06fc5a157aebf81469c3a0e", "config": {"column": null, "disabled": false, "hide_code": true}, "id": "nWHF", "name": "_"}, {"code": "mo.md(\n    r\"\"\"\n$$P(C,W_0) = \\text{maximize}_{({\\mathbf{\\alpha}_n(I_n),\\beta_n(I_n))}_{I_n\\in F_T,{n=1,2,..,T-1}}}\\,\\,\\,E[U(W_T)]$$\n\n\n$$\\text{subject to:   }\\beta_0 \\leq W_0 - C - \\sum_{i=1}^{m} S_{i,0}[\\alpha_{i,0} + |\\alpha_{i,0}|],$$\n\n$$\\beta_n(I_n) \\leq (1+r)\\beta_{n-1}(I_n) + \\sum_{i=1}^{m} S_{i,n}(I_n)[\\alpha_{i,n-1}(I_n) - \\alpha_{i,n}(I_n) - \\theta_i |\\alpha_{i,n-1}(I_n) - \\alpha_{i,n}(I_n)|],$$\n\n$$W_T(I_T) \\leq (1+r)\\beta_{T-1}(I_T) + \\sum_{i=1}^{m} S_{i,T}(I_T)[\\alpha_{i,T-1}(I_T) - \\theta_i |\\alpha_{i,T-1}(I_T)|] + \\text{max}(S_{1,T}(I_T) - K,0), \\,\\,\\, \\forall I_T\\in F_T$$\n\"\"\"\n)", "code_hash": "ef3a2c9e99314eb7f708be59682d9bfe", "config": {"column": null, "disabled": false, "hide_code": true}, "id": "iLit", "name": "_"}, {"code": "mo.md(\n    r\"\"\"\nThe highest price that investor is willing to pay for the given call option, is therefore given by the price for which the maximum expected utility in the two portfolios becomes equal, making the investor indifferent to the choices. Thus, the final optimization problem that we need to consider is:\n\n$$C^* = \\text{maximize}_{({\\mathbf{\\alpha}_n(I_n),\\beta_n(I_n))}_{I_n\\in F_T,{n=1,2,..,T-1}}} \\,\\,\\, C$$\n\n$$\\text{subject to: } E[U(W_T)] \\geq U^*(W_0) $$\n\nalong with the other constraints mentioned in the optimization problem for the portfolio in which the option is purchased.\n\"\"\"\n)", "code_hash": "68d76aa168358ac4d7833683aa5dce65", "config": {"column": null, "disabled": false, "hide_code": true}, "id": "ZHCJ", "name": "_"}, {"code": "mo.md(r\"\"\"### 4.) Utility function\"\"\")", "code_hash": "d52e9a0fec4fa83c645a1db9b990fdb6", "config": {"column": null, "disabled": false, "hide_code": true}, "id": "ROlb", "name": "_"}, {"code": "mo.md(\n    r\"\"\"\nIn the optimization problems mentioned above, we need to optimize the expected utility. The utility functions that we consider are members of a family called HARA utility functions (Hyperbolic Absolute Risk Aversion). The general expression for HARA utility is:\n\n$$U(W) = \\frac{1-\\gamma}{\\gamma}\\bigg(\\frac{aW}{1-\\gamma} + b\\bigg)^\\gamma \\,;\\, a\u003E0$$\n\nwhere $W \u003E ((\\gamma - 1)b)/a$. Note that the exponential and logarithmic utility functions are also members of the HARA-class.\n\"\"\"\n)", "code_hash": "96bd836f9fe889486738ed332724a667", "config": {"column": null, "disabled": false, "hide_code": true}, "id": "qnkX", "name": "_"}, {"code": "mo.md(\n    r\"\"\"\nAnother thing to consider is the Arrow-Pratt measure of the Absolute risk aversion. For the HARA-class, it is:\n\n$$ARA(W) = \\bigg(\\frac{W}{1-\\gamma} + \\frac{b}{a}\\bigg)^{-1}$$\n\"\"\"\n)", "code_hash": "ddbcacee30e4eadd594dac907f62a2f3", "config": {"column": null, "disabled": false, "hide_code": true}, "id": "TqIu", "name": "_"}, {"code": "mo.md(r\"\"\"# Fusion Implementation\"\"\")", "code_hash": "c6e7ea95a86124310192111484eb7a1a", "config": {"column": null, "disabled": false, "hide_code": true}, "id": "Vxnm", "name": "_"}, {"code": "mo.md(r\"\"\"Now we proceed with the construction of the fusion model. We start by making a Tree class that will represent the event tree discussed above.\"\"\")", "code_hash": "1da59235aee77b064e03b7f31942c02b", "config": {"column": null, "disabled": false, "hide_code": true}, "id": "DnEU", "name": "_"}, {"code": "mo.md(\n    r\"\"\"\n### Parameters for Initializing the Tree Class\n\nWhen creating a Tree object, the following parameters define the investment environment and decision-making setup:\n\n- **M** \u2013 The optimization model, typically a MOSEK Fusion `Model`, that will hold variables, constraints, and the objective.  \n- **T** \u2013 The number of discrete time steps in the investment horizon.  \n- **W\u2080** \u2013 The investor\u2019s initial wealth at time 0.  \n- **S** \u2013 The price-scaling matrix that adjusts asset prices over time.  \n- **\u03b8** \u2013 The vector of transaction costs, representing costs incurred when trading risky assets.  \n- **S\u1d65\u2080** \u2013 The initial price vector for the risky securities at time 0.  \n- **r** \u2013 The risk-free interest rate applied to bonds.  \n- **U = [a, b, \u03b3]** \u2013 The set of parameters defining the investor\u2019s HARA (Hyperbolic Absolute Risk Aversion) utility function, capturing risk preferences.\n\"\"\"\n)", "code_hash": "955dd180dc13a0e7df50dc3a74328c0c", "config": {"column": null, "disabled": false, "hide_code": true}, "id": "ulZA", "name": "_"}, {"code": "mo.md(r\"\"\"### HARA utility as a Power cone:\"\"\")", "code_hash": "5ebdc6915d7ca1ad010364a65313a920", "config": {"column": null, "disabled": false, "hide_code": true}, "id": "ecfG", "name": "_"}, {"code": "mo.md(\n    r\"\"\"\nThe objective function is:\n\n$$\\text{maximize   }E[U(W_T)] = \\sum_{I_T\\in F_T}P(I_T) \\bigg(\\frac{1-\\gamma}{\\gamma}\\bigg)  \\bigg(\\frac{aW(I_T)}{1-\\gamma} + b\\bigg)^\\gamma$$\n\nwhere $P(I_T)$ is the probability of a given path. We can re-write this as:\n\n\n$$\\text{maximize   } \\sum_{I_T\\in F_T}P(I_T) \\bigg(\\frac{1-\\gamma}{\\gamma}\\bigg) h(I_T)$$\n\n$$\\text{subject to :   } h(I_T)\\leq \\bigg(\\frac{aW(I_T)}{1-\\gamma} + b\\bigg)^\\gamma$$\n\n\nNow, the constraint can be expressed as a Power cone. However, there are a few possible cases:\n\n1.) $\\gamma \u003E 1$: In this case, the conic representation is:\n\n$$\\Bigg(h(I_T),1,\\bigg(\\frac{aW(I_T)}{1-\\gamma} + b\\bigg) \\Bigg) \\in \\mathcal{P}_3^{1/\\gamma}$$\n\n2.) $0 \u003C \\gamma \u003C 1$:\n\n$$\\Bigg(\\bigg(\\frac{aW(I_T)}{1-\\gamma} + b\\bigg),1, h(I_T) \\Bigg) \\in \\mathcal{P}_3^{\\gamma}$$\n\n3.) $\\gamma \u003C 0$:\n\n$$\\Bigg(h(I_T),\\bigg(\\frac{aW(I_T)}{1-\\gamma} + b\\bigg),1  \\Bigg) \\in \\mathcal{P}_3^{1/(1-\\gamma)}$$\n\"\"\"\n)", "code_hash": "c1145c5406e9af887526a1a48fdbb1fc", "config": {"column": null, "disabled": false, "hide_code": true}, "id": "Pvdt", "name": "_"}, {"code": "mo.md(r\"\"\"### Exponential utility as an exponential cone:\"\"\")", "code_hash": "6793fc9396c18f62c24d38d10d23b16a", "config": {"column": null, "disabled": false, "hide_code": true}, "id": "ZBYS", "name": "_"}, {"code": "mo.md(\n    r\"\"\"\nThe objective function in the case of exponential utility will be given by:\n\n$$\\text{maximize   }E[U(W_T)] = \\sum_{I_T\\in F_T}P(I_T) \\bigg(1 - e^{- [\\text{ARA}(W)] W(I_T)}\\bigg)\n$$\n\nif the Absolute Risk aversion is nonzero. However, if ARA$(W) = 0$, then the objective function is simply:\n\n$$\\text{maximize   }E[U(W_T)] = \\sum_{I_T\\in F_T}P(I_T) W(I_T)$$\n\nFor the non-zero ARA$(W)$, we express the objective function as follows:\n\n$$\\text{maximize   } \\sum_{I_T\\in F_T}P(I_T) h(I_T)$$\n\n$$\\text{subject to:  } (1-h(I_T))\\geq e^{-[\\text{ARA}(W)]W(I_T)}$$\n\nand the constraint is readily expressed as an exponential cone:\n\n$$\\big((1-h(I_T)),1,-[\\text{ARA}(W)]W(I_T)\\big) \\in K_{exp}$$\n\"\"\"\n)", "code_hash": "ac5ad3ec3bc5e3cb2bd6a3652eab0bf6", "config": {"column": null, "disabled": false, "hide_code": true}, "id": "aLJB", "name": "_"}, {"code": "import numpy as np\nfrom mosek.fusion import Model, Domain, Expr, ObjectiveSense, Matrix, Var, SolutionStatus\nimport sys\nimport matplotlib.pyplot as plt\nimport time", "code_hash": "88c6a0b25bb955b6f7bd9d2ff3990136", "config": {"column": null, "disabled": false, "hide_code": false}, "id": "nHfw", "name": "_"}, {"code": "class Tree:    \n    # Instantiate the Tree class.\n    def __init__(self, M, T, W_0, S, theta, S_v_0, r, U):\n        self.M = M\n        self.W_0 = W_0\n        self.T = T\n        self.S_v = S\n        self.r = r    \n        # Shape of the cost scaling matrix will give us the split index and the number of risky securities.\n        self.s, self.n = S.shape\n        self.cost = np.asarray([theta])\n        self.S_v_0 = S_v_0\n        # Parameters for the utility function.\n        self.U = U\n        self.S_v_t = S_v_0\n        # This is to decide which utility will be used.\n        self.util_dispatch = {'HARA': self.HARA_util, 'EXP': self.exp_util}\n        self.levels = []\n\n    # Method to make all the levels, or the time steps in the tree.\n    def level_make(self):\n        # Number of risky securities, i.e. alpha{i,t=0}\n        self.a0 = self.M.variable('a_0', [1, self.n])\n        # Bonds at t=0.\n        self.b0 = self.M.variable('b_0', 1)\n        # Making the first budget constraint.\n        self.budg_ex = Expr.sub(\n            Expr.sub(self.W_0, self.b0),\n            Expr.dot(self.S_v_0, Expr.mulElm(1 + self.cost, self.a0))\n        )\n        self.root_budget = self.M.constraint('Budget_0', self.budg_ex, Domain.greaterThan(0.0))\n        # This list will hold the level objects associated to this tree.\n        a, b = self.a0, self.b0\n        for i in range(1, self.T + 1):\n            # Appending level n, based on the level (n-1).\n            self.levels.append(Level(i, self, a, b))\n            a = self.levels[i - 1].a_new\n            b = self.levels[i - 1].b_new\n        # a_T is zero ().\n\n    # Method to make the HARA utility function and the corresponding Power-cone constraint.\n    def HARA_util(self, W):\n        self.h = self.M.variable('h', self.s**self.T, Domain.greaterThan(0.0))\n\n        # HARA utility is only defined for when W \u003E (gamma - 1)a/b.\n        self.M.constraint(W, Domain.greaterThan(self.U[1] * (self.U[2] - 1) / self.U[0]))\n\n        I = Expr.constTerm([self.s**self.T], 1.0)\n        self.E1 = Expr.add(\n            Expr.mul(self.U[0] / (1 - self.U[2]), W),\n            Expr.constTerm(W.getShape(), self.U[1])\n        )\n\n        # Different cases for different gamma values\n        if self.U[2] \u003E 1.0:\n            self.M.constraint('Obj_terms_HARA', Expr.hstack(self.h, I, self.E1), Domain.inPPowerCone(1 / self.U[2]))\n        elif self.U[2] \u003C 0.0:\n            self.M.constraint('Obj_terms_HARA', Expr.hstack(self.h, self.E1, I), Domain.inPPowerCone(1 / (1 - self.U[2])))\n        else:\n            self.M.constraint('Obj_terms_HARA', Expr.hstack(self.E1, I, self.h), Domain.inPPowerCone(self.U[2]))\n\n        return Expr.mul(((1 - self.U[2]) / self.U[2]), self.h)\n\n    # Method to make the Exponential utility constraints.\n    def exp_util(self, W):\n        # Zero ARA(W) case\n        if self.U == 0:\n            return W\n        # Nonzero ARA(W) case\n        self.h = self.M.variable('h', self.s**self.T)\n        I = Expr.constTerm([self.s**self.T], 1.0)\n        E_exp = Expr.mul(-self.U, W)\n        self.M.constraint('Obj_terms_exp',\n                          Expr.hstack(Expr.sub(I, Expr.mul(self.U, self.h)), I, E_exp),\n                          Domain.inPExpCone())\n        return self.h", "code_hash": "e041cc8373b5ba5789368bcd2509d67e", "config": {"column": null, "disabled": false, "hide_code": false}, "id": "xXTn", "name": "_"}, {"code": "mo.md(\n    r\"\"\"\nThe \u003Ci\u003ETree\u003C/i\u003E class defined above has the sub-class \u003Ci\u003ELevel\u003C/i\u003E. The budget constraints involved in our model connect variables that lie in consecutive levels. Therefore, we can visualize all the constraints between two levels in the following manner (Note: for ease of visualization, we take the split index as $s = 3$, and a time period of n = 3):\n\n$$\n\\begin{pmatrix}\na\\begin{bmatrix}\nS_{(1,2)} \\\\\nS_{(2,2)} \\\\\nS_{(3,2)} \\\\\n\\end{bmatrix}\\\\\nb\\begin{bmatrix}\nS_{(1,2)} \\\\\nS_{(2,2)} \\\\\nS_{(3,2)} \\\\\n\\end{bmatrix}\\\\\nc\\begin{bmatrix}\nS_{(1,2)} \\\\\nS_{(2,2)} \\\\\nS_{(3,2)} \\\\\n\\end{bmatrix}\\\\\n\\end{pmatrix}\n:\n\\begin{pmatrix}\n\\begin{bmatrix}\n\\mathbf{\\alpha_{(1,2)}},\\beta_{(1,2)} \\\\\n\\mathbf{\\alpha_{(2,2)}},\\beta_{(2,2)} \\\\\n\\mathbf{\\alpha_{(3,2)}},\\beta_{(3,2)} \\\\\n\\end{bmatrix} \\\\\n\\begin{bmatrix}\n\\mathbf{\\alpha_{(1,2)}},\\beta_{(1,2)} \\\\\n\\mathbf{\\alpha_{(2,2)}},\\beta_{(2,2)} \\\\\n\\mathbf{\\alpha_{(3,2)}},\\beta_{(3,2)} \\\\\n\\end{bmatrix} \\\\\n\\begin{bmatrix}\n\\mathbf{\\alpha_{(1,2)}},\\beta_{(1,2)} \\\\\n\\mathbf{\\alpha_{(2,2)}},\\beta_{(2,2)} \\\\\n\\mathbf{\\alpha_{(3,2)}},\\beta_{(3,2)} \\\\\n\\end{bmatrix} \\\\\n\\end{pmatrix}  \\longrightarrow\n\\begin{pmatrix}\n\\mathbf{\\alpha_{(1,3)}},\\beta_{(1,3)} \\\\\n\\mathbf{\\alpha_{(2,3)}},\\beta_{(2,3)} \\\\\n\\mathbf{\\alpha_{(3,3)}},\\beta_{(3,3)} \\\\\n\\mathbf{\\alpha_{(4,3)}},\\beta_{(4,3)} \\\\\n\\mathbf{\\alpha_{(5,3)}},\\beta_{(5,3)} \\\\\n\\mathbf{\\alpha_{(6,3)}},\\beta_{(6,3)} \\\\\n\\mathbf{\\alpha_{(7,3)}},\\beta_{(7,3)} \\\\\n\\mathbf{\\alpha_{(8,3)}},\\beta_{(8,3)} \\\\\n\\mathbf{\\alpha_{(9,3)}},\\beta_{(9,3)} \\\\\n\\end{pmatrix}\n$$\n\nHere, the first column vector is a \u003Ci\u003E\"vstack\"\u003C/i\u003E of the price vector at level $n=2$, multiplied by the scaling factors for the price. Therefore, the first column is the new price vector (for $n=3$). In the second column, $\\alpha$'s will be vectors if there are multiple risky securities. Also, $\\alpha_{(i,n)}$ and $\\beta_{(i,n)}$ correspond to the number of risky securities and the bonds, respectively, for the $i^{\\text{th}}$ path at the $n^{\\text{th}}$ time period. It is to be realized that for a given time period, $1\\leq i \\leq s^n$.\n\nThe above-stated representation shows that we can \u003Ci\u003E\"repeat\"\u003C/i\u003E the variables of the previous level $s$ number of times and then it becomes quite easy to implement the budget constraints in \u003Ci\u003EFusion\u003C/i\u003E. One can also extend the above shown method to a higher split index.\n\"\"\"\n)", "code_hash": "ca864b4f823644018656531685ae1b4a", "config": {"column": null, "disabled": false, "hide_code": true}, "id": "AjVT", "name": "_"}, {"code": "# Each level corresponds to a time step in the event tree.\nclass Level:\n    # l corresponds to the time step; a_old, b_old belong to (l-1) in the tree. \n    def __init__(self, l, Tree, a_old, b_old):\n        if l == Tree.T:\n            # If the current level is the final time period, then all risky securities are considered sold.\n            self.a_new = Expr.constTerm([Tree.s**l, Tree.n], 0.0)\n            # Final step's bonds are the wealth W(I_T); later used in the utility function.\n            self.b_new = Tree.M.variable('W_T', Tree.s**l)\n        else:\n            # Risky securities for time step l.\n            self.a_new = Tree.M.variable(f'a_{l}', [Tree.s**l, Tree.n])\n            # Bonds in dollars for time step l.\n            self.b_new = Tree.M.variable(f'b_{l}', Tree.s**l)\n\n        # Variable for the quadratic cone to implement the absolute value constraint.\n        self.t_new = Tree.M.variable(f't_{l}', [Tree.s**l, Tree.n], Domain.greaterThan(0.0))\n        Tree.cost = np.repeat(Tree.cost, Tree.s, axis=0)\n\n        # Repeating/Stacking the (l-1) level variables for budget constraints. \n        A = Expr.repeat(a_old, Tree.s, 0)\n        B = Expr.repeat(b_old, Tree.s, 0)\n\n        # Price vector of previous level, scaled and stacked vertically.\n        Tree.S_v_t = np.vstack([np.multiply(j, Tree.S_v_t) for j in Tree.S_v])\n\n        # Expressions for budget constraints.\n        self.bond_sub = Expr.sub(Expr.mul(B, (1 + Tree.r)), self.b_new)\n        self.secu_sub = Expr.sub(self.a_new, A)\n        self.transact = Expr.add(self.secu_sub, Expr.mulElm(Tree.cost, self.t_new))\n        self.secu_exp = Expr.mulDiag(self.transact, Tree.S_v_t.transpose())\n\n        # Linear budget constraint.\n        self.budg_constr = Tree.M.constraint(f'Budget_{l}',\n                                             Expr.sub(self.bond_sub, self.secu_exp),\n                                             Domain.greaterThan(0.0))\n        # Quadratic cone for absolute value requirement.\n        Tree.M.constraint(f'a{l}_abs', Expr.stack(2, self.t_new, self.secu_sub), Domain.inQCone())", "code_hash": "8d0e30e9d2fc7f8d1db49f4eb9398c07", "config": {"column": null, "disabled": false, "hide_code": false}, "id": "pHFh", "name": "_"}, {"code": "mo.md(r\"\"\"### Now that we have the basic structure of the tree ready, we can easily make the \u003Ci\u003EFusion\u003C/i\u003E model as follows...\"\"\")", "code_hash": "d09f6827d335c660c308e3357d5cee07", "config": {"column": null, "disabled": false, "hide_code": true}, "id": "NCOB", "name": "_"}, {"code": "mo.md(r\"\"\"We will represent the paths $I_T$ by their numbers. Therefore, we have (split_index)$^T$ paths. Each Path number represented in the base of the split index will give us a unique id for each path.\"\"\")", "code_hash": "c7c6957cbf80d754a73b9cd6637bbc61", "config": {"column": null, "disabled": false, "hide_code": true}, "id": "aqbW", "name": "_"}, {"code": "def base_rep(b, i, size):\n    n = np.zeros(size)\n    for j in range(size):\n        n[j] = i % b\n        if i // b == 0:\n            break\n        else:\n            i = i // b\n    return np.flip(n)\n\ndef path_id_make(split_index, T):\n    path_id = []\n    for i in range(split_index ** T):\n        path_id.append(base_rep(split_index, i, T))\n    return np.asarray(path_id).astype(int)\n\ndef path_route_calc(path_id, split_index, q, *args):\n    s = np.zeros(split_index)\n    for _p in path_id:\n        s[_p] = s[_p] + 1\n    if args:\n        path_S1 = []\n        for j in range(split_index):\n            path_S1.append(args[0][j] ** s[j])\n        path_S1T = np.prod(np.asarray(path_S1))\n        return path_S1T\n    else:\n        path_prob = np.prod(q ** s)\n        return path_prob\n\ndef price_vector_z(sigma, eps, dt, q):\n    E = np.exp(np.matmul(eps, sigma) * np.sqrt(dt))\n    return np.matmul(q, E)\n\ndef price_vector_abc(sigma, eps, dt, q, mu, Z):\n    E1 = np.multiply(np.exp(np.matmul(eps, sigma) * np.sqrt(dt)), 1 / Z)\n    E2 = np.repeat([np.exp(mu * dt)], eps.shape[0], axis=0)\n    return np.multiply(E2, E1)", "code_hash": "5f70432b5ee80b9c8e7e402949f627e7", "config": {"column": null, "disabled": false, "hide_code": false}, "id": "TRpd", "name": "_"}, {"code": "mo.md(r\"\"\"### Portfolio without call option:\"\"\")", "code_hash": "00deb359a0a9a7a579c66dddb8565f36", "config": {"column": null, "disabled": false, "hide_code": true}, "id": "TXez", "name": "_"}, {"code": "def Portfolio(port_params, util_type='HARA', wrtLog=True):\n    T, W_0, S, theta, S_v_0, r, U, q = port_params\n    M = Model('PORTFOLIO')\n    if wrtLog:\n        M.setLogHandler(sys.stdout)\n    Tree_1 = Tree(M, T, W_0, S, theta, S_v_0, r, U)\n    Tree_1.level_make()\n    H = Tree_1.util_dispatch[util_type](Tree_1.levels[T - 1].b_new)\n    path_ids = path_id_make(Tree_1.s, T)\n    path_probs = [path_route_calc(_p, Tree_1.s, q) for _p in path_ids]\n    Obj = Expr.dot(H, path_probs)\n    M.objective('PORTFOLIO_OBJ', ObjectiveSense.Maximize, Obj)\n    M.solve()\n    utility_W0 = M.primalObjValue()\n    ut_time = M.getSolverDoubleInfo('optimizerTime')\n    ut_iter = M.getSolverIntInfo('intpntIter')\n    return (M, Tree_1, utility_W0, path_ids, Obj, [ut_iter, ut_time])", "code_hash": "be5b9f94ab0902c31e46aee30be6bc79", "config": {"column": null, "disabled": false, "hide_code": false}, "id": "dNNg", "name": "_"}, {"code": "mo.md(r\"\"\"### Portfolio with call option:\"\"\")", "code_hash": "29af54ceaaed297a538c48ea65535135", "config": {"column": null, "disabled": false, "hide_code": true}, "id": "yCnT", "name": "_"}, {"code": "mo.md(r\"\"\"This model involves modifying the initial and the final budget constraints, adding a constraint on the new utility, creating a new objective (the option price) and re-optimizing the previous model. Fusion allows re-optimizing (this saves a considerable amount of time, which would otherwise be spent in re-building the model).\"\"\")", "code_hash": "39377ca1b3c37b02d05257931a141c0e", "config": {"column": null, "disabled": false, "hide_code": true}, "id": "wlCL", "name": "_"}, {"code": "def Option_Portfolio(port_params, K, util_type='HARA', writeLog=True, solver_info=False):\n    T, W_0, S, theta, S_v_0, r, U, q = port_params\n    M, Tree_1, utility_W0, path_ids, Obj, obj_info = Portfolio(port_params, util_type=util_type, wrtLog=writeLog)\n    path_Svs = np.asarray([path_route_calc(_p, S.shape[0], q, S[:, 0]) for _p in path_ids])\n    call_profit = (path_Svs - K + abs(path_Svs - K)) / 2\n    Call = M.variable('Call_Price', 1, Domain.inRange(0.0, S_v_0[0]))\n    Tree_1.root_budget.update(Expr.neg(Call), Call)\n    Tree_1.levels[T - 1].budg_constr.update(call_profit.tolist())\n    M.constraint('E_geq_U', Expr.sub(Obj, utility_W0), Domain.greaterThan(0.0))\n    M.objective('Call_price_OBJECTIVE', ObjectiveSense.Maximize, Call)\n    M.solve()\n    if solver_info:\n        price_time = M.getSolverDoubleInfo('optimizerTime')\n        price_iter = M.getSolverIntInfo('intpntIter')\n        n_cons = M.getSolverIntInfo('optNumcon')\n        n_vars = M.getSolverIntInfo('optNumvar')\n        return (M.primalObjValue(), n_cons, n_vars, obj_info[0], obj_info[1], price_iter, price_time)\n    else:\n        return M.primalObjValue()", "code_hash": "f3925182f45e85195e7504e5cceadd9e", "config": {"column": null, "disabled": false, "hide_code": false}, "id": "kqZH", "name": "_"}, {"code": "mo.md(r\"\"\"Now, to demonstrate the model, we solve it for two simple cases. The values taken below are the same as mentioned in the paper (\u003Ca href=\"https://www.sciencedirect.com/science/article/pii/S0168927498001044\"\u003EAndersen et. al.\u003C/a\u003E).\"\"\")", "code_hash": "a10b063476c1d4789dbf7bb2d68840fd", "config": {"column": null, "disabled": false, "hide_code": true}, "id": "wAgl", "name": "_"}, {"code": "T = 5\nsigma = np.asarray([0.2])\nq = np.ones(3) / 3\neps = np.asarray([[np.sqrt(2)], [-1 / np.sqrt(2)], [-1 / np.sqrt(2)]])\nT_horizon = 1 / 4\ndT = T_horizon / T\ntheta = [0.005]\nS_v_0 = [1.0]\nr = 1.06 ** dT - 1\nW_0 = 1.0\ngamma = 0.3\nb = 1\nc = 0.2\na = b / (1 / c + W_0 / (gamma - 1))\nK = 1\nmu = 0.15\nZ = price_vector_z(sigma, eps, dT, q)\nS_coeffs = np.expand_dims(price_vector_abc(sigma, eps, dT, q, mu, Z), axis=1)\n_util_paras = np.asarray([a, b, gamma])\n_input_pars = [T, W_0, S_coeffs, theta, S_v_0, r, _util_paras, q]\nprint('\\n\\nCall option price = {}'.format(Option_Portfolio(_input_pars, K)))", "code_hash": "1f4d6e981f20d261908f59347743bb26", "config": {"column": null, "disabled": false, "hide_code": false}, "id": "rEll", "name": "_"}, {"code": "_input_pars = [T, W_0, S_coeffs, theta, S_v_0, r, c, q]\nprint('\\n\\nCall option price = {}'.format(Option_Portfolio(_input_pars, K, util_type='EXP')))", "code_hash": "815bd804a627466cd3ffb1e3d2a90e7f", "config": {"column": null, "disabled": false, "hide_code": false}, "id": "dGlV", "name": "_"}, {"code": "mo.md(r\"\"\"# Test-cases:\"\"\")", "code_hash": "226b9042a0ada127db3dd554d5e4f271", "config": {"column": null, "disabled": false, "hide_code": true}, "id": "SdmI", "name": "_"}, {"code": "mo.md(r\"\"\"### Reservation price sensitivity for the choice of utility function:\"\"\")", "code_hash": "7f640dcc4bf32a5f7be5d9f4f3d58e0a", "config": {"column": null, "disabled": false, "hide_code": true}, "id": "lgWD", "name": "_"}, {"code": "mo.md(r\"\"\"\u003Cb\u003E(a.) Dependency of the reservation purchase price on $\\gamma$, $ARA(W_0)$ and $\\overline{T}$.\u003C/b\u003E (Consider Table 3, \u003Ca href=\"https://www.sciencedirect.com/science/article/pii/S0168927498001044\"\u003EAndersen et. al.\u003C/a\u003E)\"\"\")", "code_hash": "8a31d9cfefe366de4b835dd183df9107", "config": {"column": null, "disabled": false, "hide_code": true}, "id": "yOPj", "name": "_"}, {"code": "gamma_1 = [-4.0, -2.0, -0.9, -0.3, 0.3, 0.6]\nprint('ARA = 0.2 ; Time Horizon = 1/4 year')\nprint('{0:^6}  {1:^9}'.format('gamma', 'C'))\nfor _g in gamma_1:\n    a_1 = b / (1 / c + W_0 / (_g - 1))\n    _util_paras = np.asarray([a_1, b, _g])\n    _input_pars = [T, W_0, S_coeffs, theta, S_v_0, r, _util_paras, q]\n    print('{0:^ 5.1f}  {1:^9.7f}'.format(_g, Option_Portfolio(_input_pars, K, writeLog=False)))\n_input_pars = [T, W_0, S_coeffs, theta, S_v_0, r, c, q]\nprint('{0:^5}  {1:^9.7f}'.format('exp', Option_Portfolio(_input_pars, K, util_type='EXP', writeLog=False)))", "code_hash": "844932a5daccf22ca83d512581e6a1aa", "config": {"column": null, "disabled": false, "hide_code": false}, "id": "fwwy", "name": "_"}, {"code": "c_11 = 1.0\nprint('ARA = 1.0 ; Time Horizon = 1/4 year')\nprint('{0:^6}  {1:^9}'.format('gamma', 'C'))\nfor _g in gamma_1[0:4]:\n    a_2 = b / (1 / c_11 + W_0 / (_g - 1))\n    _util_paras = np.asarray([a_2, b, _g])\n    _input_pars = [T, W_0, S_coeffs, theta, S_v_0, r, _util_paras, q]\n    print('{0:^ 5.1f}  {1:^9.7f}'.format(_g, Option_Portfolio(_input_pars, K, writeLog=False)))\n_input_pars = [T, W_0, S_coeffs, theta, S_v_0, r, c_11, q]\nprint('{0:^5}  {1:^9.7f}'.format('exp', Option_Portfolio(_input_pars, K, util_type='EXP', writeLog=False)))", "code_hash": "378ed80881fb58b031d5a1ea8adbd899", "config": {"column": null, "disabled": false, "hide_code": false}, "id": "LJZf", "name": "_"}, {"code": "T_horizon_1 = 9\ndT_1 = T_horizon_1 / T\n_Z = price_vector_z(sigma, eps, dT_1, q)\nS_coeffs_1 = np.expand_dims(price_vector_abc(sigma, eps, dT_1, q, mu, _Z), axis=1)\nr_1 = 1.06 ** dT_1 - 1\nc_2 = 0.2\nprint('ARA = 0.2 ; Time Horizon = 9 years')\nprint('{0:^6}  {1:^9}'.format('gamma', 'C'))\nfor _g in gamma_1:\n    a_3 = b / (1 / c_2 + W_0 / (_g - 1))\n    _util_paras = np.asarray([a_3, b, _g])\n    _input_pars = [T, W_0, S_coeffs_1, theta, S_v_0, r_1, _util_paras, q]\n    print('{0:^ 5.1f}  {1:^9.7f}'.format(_g, Option_Portfolio(_input_pars, K, writeLog=False)))\n_input_pars = [T, W_0, S_coeffs_1, theta, S_v_0, r_1, c_2, q]\nprint('{0:^5}  {1:^9.7f}'.format('exp', Option_Portfolio(_input_pars, K, util_type='EXP', writeLog=False)))", "code_hash": "defd0a40bea8529bffd7d39dd1433c6f", "config": {"column": null, "disabled": false, "hide_code": false}, "id": "urSm", "name": "_"}, {"code": "c_3 = 1.0\nprint('ARA = 1.0 ; Time Horizon = 9 years')\nprint('{0:^6}  {1:^9}'.format('gamma', 'C'))\nfor _g in gamma_1[0:4]:\n    a_4 = b / (1 / c_3 + W_0 / (_g - 1))\n    _util_paras = np.asarray([a_4, b, _g])\n    _input_pars = [T, W_0, S_coeffs_1, theta, S_v_0, r_1, _util_paras, q]\n    print('{0:^ 5.1f}  {1:^9.7f}'.format(_g, Option_Portfolio(_input_pars, K, writeLog=False)))\n_input_pars = [T, W_0, S_coeffs_1, theta, S_v_0, r_1, c_3, q]\nprint('{0:^5}  {1:^9.7f}'.format('exp', Option_Portfolio(_input_pars, K, util_type='EXP', writeLog=False)))", "code_hash": "41415f2f70827cc951ee36c3ab28b6d3", "config": {"column": null, "disabled": false, "hide_code": false}, "id": "jxvo", "name": "_"}, {"code": "mo.md(r\"\"\"\u003Cb\u003E(b.) Dependency of the reservation purchase price on the initial level of Relative Risk Aversion, $RRA(W_0)$\u003C/b\u003E (Consider Table 4, \u003Ca href=\"https://www.sciencedirect.com/science/article/pii/S0168927498001044\"\u003EAndersen et. al.\u003C/a\u003E)\"\"\")", "code_hash": "fa8709fa6d64ee190161f1cbaf7d9fd5", "config": {"column": null, "disabled": false, "hide_code": true}, "id": "mWxS", "name": "_"}, {"code": "T_1 = 5\nT_horizon_2 = 1 / 4\ndT_2 = T_horizon_2 / T_1\nr_2 = 1.06 ** dT_2 - 1\nW_0_1 = [1.0, 4.0, 8.0]\ngamma_2 = -1.0\nb_1 = 1\nc_4 = 0.2\nZ2 = price_vector_z(sigma, eps, dT_2, q)\nS_coeffs_2 = np.expand_dims(price_vector_abc(sigma, eps, dT_2, q, mu, Z2), axis=1)\nprint('ARA = 0.2 ; Time Horizon = 1/4 year')\nprint('{0:^5}  {1:^5}  {2:^9}'.format('W_0', 'RRA', 'C'))\nfor _w0 in W_0_1:\n    a_5 = b_1 / (1 / c_4 + _w0 / (gamma_2 - 1))\n    _util_paras = np.asarray([a_5, b_1, gamma_2])\n    _input_pars = [T_1, _w0, S_coeffs_2, theta, S_v_0, r_2, _util_paras, q]\n    print('{0:^5.0f}  {1:^5.1f}  {2:^9.7f}'.format(_w0, c_4 * _w0, Option_Portfolio(_input_pars, K, writeLog=False)))\n_input_pars = [T_1, 1.0, S_coeffs_2, theta, S_v_0, r_2, c_4, q]\nprint('{0:^5}  {1:^5}  {2:^9.7f}'.format('exp', '', Option_Portfolio(_input_pars, K, util_type='EXP', writeLog=False)))", "code_hash": "1a64b800a123a3a4574e17f9b5f79f35", "config": {"column": null, "disabled": false, "hide_code": false}, "id": "CcZR", "name": "_"}, {"code": "T_horizon_3 = 9\ndT_3 = T_horizon_3 / T_1\nr_3 = 1.06 ** dT_3 - 1\nZ3 = price_vector_z(sigma, eps, dT_3, q)\nS_coeffs_3 = np.expand_dims(price_vector_abc(sigma, eps, dT_3, q, mu, Z3), axis=1)\nprint('ARA = 0.2 ; Time Horizon = 9 years')\nprint('{0:^5}  {1:^5}  {2:^9}'.format('W_0', 'RRA', 'C'))\nfor _w0 in W_0_1:\n    a_6 = b_1 / (1 / c_4 + _w0 / (gamma_2 - 1))\n    _util_paras = np.asarray([a_6, b_1, gamma_2])\n    _input_pars = [T_1, _w0, S_coeffs_3, theta, S_v_0, r_3, _util_paras, q]\n    print('{0:^5.0f}  {1:^5.1f}  {2:^9.7f}'.format(_w0, c_4 * _w0, Option_Portfolio(_input_pars, K, writeLog=False)))\n_input_pars = [T_1, 1.0, S_coeffs_3, theta, S_v_0, r_3, c_4, q]\nprint('{0:^5}  {1:^5}  {2:^9.7f}'.format('exp', '', Option_Portfolio(_input_pars, K, util_type='EXP', writeLog=False)))", "code_hash": "89395266de80d1195e23f57f86e6e6ed", "config": {"column": null, "disabled": false, "hide_code": false}, "id": "YWSi", "name": "_"}, {"code": "mo.md(r\"\"\"\u003Cb\u003E(c.) Convergence of the reservation purchase price.\u003C/b\u003E (Consider Table 5, \u003Ca href=\"https://www.sciencedirect.com/science/article/pii/S0168927498001044\"\u003EAndersen et. al.\u003C/a\u003E)\"\"\")", "code_hash": "23958c65cf9a0082b31b2536079bbd82", "config": {"column": null, "disabled": false, "hide_code": true}, "id": "zlud", "name": "_"}, {"code": "T_horizon_4 = 1 / 4\nW_0_2 = 1.0\ngamma_3 = 0.3\nb_2 = 0.0\nc_5 = 0.7\na_7 = 1 - gamma_3\n_util_paras = np.asarray([a_7, b_2, gamma_3])\nC_trio = []\nprint('{0:^3}  {1:12}  {2:12}  {3:^12}'.format(' ', '-exp(-0.7W)', '(W^0.3)/0.3', ' '))\nprint('{0:^3}  {1:^12}  {2:^12}  {3:^12}'.format('T', 'C_exp', 'C_pow', 'CRR'))\nfor T_2 in np.arange(1, 12):\n    dT_4 = T_horizon_4 / T_2\n    r_4 = 1.06 ** dT_4 - 1\n    Z4 = price_vector_z(sigma, eps, dT_4, q)\n    S_coeffs_4 = np.expand_dims(price_vector_abc(sigma, eps, dT_4, q, mu, Z4), axis=1)\n    _input_pars = [T_2, W_0_2, S_coeffs_4, theta, S_v_0, r_4, _util_paras, q]\n    _C_pow = Option_Portfolio(_input_pars, K, writeLog=False)\n    _input_pars = [T_2, W_0_2, S_coeffs_4, [0.0], S_v_0, r_4, _util_paras, q]\n    CRR = Option_Portfolio(_input_pars, K, writeLog=False)\n    _input_pars = [T_2, W_0_2, S_coeffs_4, theta, S_v_0, r_4, c_5, q]\n    _C_exp = Option_Portfolio(_input_pars, K, util_type='EXP', writeLog=False)\n    print('{0:^3d}  {1:^12.10f}  {2:^12.10f}  {3:^12.10f}'.format(T_2, _C_exp, _C_pow, CRR))\n    C_trio.append([_C_exp, _C_pow, CRR])", "code_hash": "b450e4c2d08f000aae7e5747f14b13ae", "config": {"column": null, "disabled": false, "hide_code": false}, "id": "tZnO", "name": "_"}, {"code": "mo.md(r\"\"\"\u003Cb\u003E(d.) Reservation purchase price dependence on absolute risk aversion (Exponential utility).\u003C/b\u003E (Consider Table 6, \u003Ca href=\"https://www.sciencedirect.com/science/article/pii/S0168927498001044\"\u003EAndersen et. al.\u003C/a\u003E)\"\"\")", "code_hash": "769695a6e2d9aa219bd353b2c07a696c", "config": {"column": null, "disabled": false, "hide_code": true}, "id": "xvXZ", "name": "_"}, {"code": "T_3 = 9\ndT_5 = T_horizon_4 / T_3\ntheta_1 = [0.005]\nr_5 = 1.06 ** dT_5 - 1\nc_6 = [0.1, 0.2, 0.4, 0.8, 1.0, 2.0, 4.0]\nZ5 = price_vector_z(sigma, eps, dT_5, q)\nS_coeffs_5 = np.expand_dims(price_vector_abc(sigma, eps, dT_5, q, mu, Z5), axis=1)\nprint('{0:^8}  {1:^12}'.format('ARA(W_0)', 'C[ARA(W_0)]'))\nC_ara = []\nfor kappa in c_6:\n    _input_pars = [T_3, W_0_2, S_coeffs_5, theta_1, S_v_0, r_5, kappa, q]\n    _C_exp = Option_Portfolio(_input_pars, K, util_type='EXP', writeLog=False)\n    print('{0:^8.2f}  {1:^12.10f}'.format(kappa, _C_exp))\n    C_ara.append(_C_exp)", "code_hash": "06e4aaf81502b2d6d073f86917fdabf0", "config": {"column": null, "disabled": false, "hide_code": false}, "id": "CLip", "name": "_"}, {"code": "mo.md(r\"\"\"\u003Cb\u003E(e.) Reservation purchase price dependence on absolute risk aversion (Power utility).\u003C/b\u003E (Consider Table 7, \u003Ca href=\"https://www.sciencedirect.com/science/article/pii/S0168927498001044\"\u003EAndersen et. al.\u003C/a\u003E)\"\"\")", "code_hash": "02e79effd899f2dca5c765bdd44e9f2d", "config": {"column": null, "disabled": false, "hide_code": true}, "id": "YECM", "name": "_"}, {"code": "_eta = np.linspace(0.1, 0.9, 9)\na_8 = 1\nb_3 = 0.0\nprint('{0:^5}  {1:^12}'.format('eta', 'C[ARA(W_0)]'))\nC_eta = []\nfor n in _eta:\n    gamma_4 = 1 - n\n    _util_paras = np.asarray([a_8, b_3, gamma_4])\n    _input_pars = [T_3, W_0_2, S_coeffs_5, theta_1, S_v_0, r_5, _util_paras, q]\n    _C_pow = Option_Portfolio(_input_pars, K, writeLog=False)\n    print('{0:^5.2f}  {1:^12.10f}'.format(n, _C_pow))\n    C_eta.append(_C_pow)", "code_hash": "03d677a8351b2090be3dee126a9a1ac8", "config": {"column": null, "disabled": false, "hide_code": false}, "id": "cEAS", "name": "_"}, {"code": "mo.md(r\"\"\"\u003Cb\u003E(f.) Reservation purchase price dependence on initial wealth (Power utility with $\\eta = 0.7$).\u003C/b\u003E (Consider Table 8, \u003Ca href=\"https://www.sciencedirect.com/science/article/pii/S0168927498001044\"\u003EAndersen et. al.\u003C/a\u003E)\"\"\")", "code_hash": "dde475df8dafea357df0432568446399", "config": {"column": null, "disabled": false, "hide_code": true}, "id": "iXej", "name": "_"}, {"code": "_eta = 0.7\nW_0_3 = [0.25, 0.5, 1.0, 2.0, 4.0, 8.0]\ngamma_5 = 1 - _eta\n_util_paras = np.asarray([a_8, b_3, gamma_5])\nprint('{0:^5}  {1:^12}'.format('W_0', 'C_pow(W_0)'))\nC_w0 = []\nfor _w0 in W_0_3:\n    _input_pars = [T_3, _w0, S_coeffs_5, theta_1, S_v_0, r_5, _util_paras, q]\n    _C_pow = Option_Portfolio(_input_pars, K, writeLog=False)\n    print('{0:^5.2f}  {1:^12.10f}'.format(_w0, _C_pow))\n    C_w0.append(_C_pow)", "code_hash": "3bd85754d56f70f45c3eae07ea62940f", "config": {"column": null, "disabled": false, "hide_code": false}, "id": "EJmg", "name": "_"}, {"code": "mo.md(r\"\"\"### The effect of diversification opportunities on the reservation purchase price.\"\"\")", "code_hash": "24043bdae6f5088e365a63e0a02b6219", "config": {"column": null, "disabled": false, "hide_code": true}, "id": "UmEG", "name": "_"}, {"code": "mo.md(\n    r\"\"\"\nThe model presented above is fairly general, and therefore we can easily extend its application to the case where trade takes place in multiple securities. For illustration, we present the case where there are two risky securities, following \u003Ca href=\"https://www.sciencedirect.com/science/article/pii/S0168927498001044\"\u003EAndersen et. al.\u003C/a\u003E. For this example, we have:\n\n$$\n\\sigma^{T} = \\begin{pmatrix}\n\\sigma_{11}\\, ,\\,\\sigma_{21} \\\\\n\\sigma_{12}\\, ,\\,\\sigma_{22} \\\\\n\\end{pmatrix} = \\begin{pmatrix}\n\\sigma_{11}\\, ,\\, 0.2\\rho\\\\\n0.0\\, , \\, \\sqrt{(0.2)^2 - \\sigma_{21}^2} \\\\\n\\end{pmatrix}\n$$\n\nwhere $\\rho$ is the correlation between logarithms of the two securities. The $\\epsilon$ matrix is given by, \n\n$$\\epsilon = \\begin{pmatrix}\n\\epsilon_1 (\\omega_1),\\epsilon_2 (\\omega_1) \\\\\n\\epsilon_1 (\\omega_2),\\epsilon_2 (\\omega_2) \\\\\n\\epsilon_1 (\\omega_3),\\epsilon_2 (\\omega_3)\n\\end{pmatrix} = \\begin{pmatrix}\n\\sqrt{2}\\,\\,,\\,\\,0 \\\\\n-1/\\sqrt{2},\\sqrt{3/2} \\\\\n-1/\\sqrt{2},\\sqrt{3/2}\n\\end{pmatrix}\n$$\n\"\"\"\n)", "code_hash": "8d4251f1f5fb92dc8f7df155cbcf611a", "config": {"column": null, "disabled": false, "hide_code": true}, "id": "vEBW", "name": "_"}, {"code": "mo.md(\n    r\"\"\"\nMoreover, we will consider different values for the transaction costs. There are three situations considered below: completely frictionless market, friction in one security, friction in both securities.\n\n\u003Cb\u003ENote\u003C/b\u003E: In the code, we use the transpose of the sigma matrix, hence the shapes of the arrays that represent $\\sigma$ and $\\epsilon$ must be maintained similar to what is shown in the code below.\n\"\"\"\n)", "code_hash": "4c9265ae30364c72c16462ee68b4a913", "config": {"column": null, "disabled": false, "hide_code": true}, "id": "kLmu", "name": "_"}, {"code": "mo.md(r\"\"\"\u003Cb\u003E(g.) Reservation purchase price of a call option for T=9 as a function of $\\rho$ and $\\theta_i$ in the presence of two risky securities.\u003C/b\u003E (Consider Table 10, \u003Ca href=\"https://www.sciencedirect.com/science/article/pii/S0168927498001044\"\u003EAndersen et. al.\u003C/a\u003E)\"\"\")", "code_hash": "3514f7f12f9d65e4250ed05188f8b50b", "config": {"column": null, "disabled": false, "hide_code": true}, "id": "IpqN", "name": "_"}, {"code": "W_0_4 = 1.0\ngamma_6 = 0.3\nb_4 = 1\nc_7 = 0.2\na_9 = b_4 / (1 / c_7 + W_0_4 / (gamma_6 - 1))\n_util_paras = np.asarray([a_9, b_4, gamma_6])\nK_1 = 1\nsig11 = 0.2\nsig12 = 0.0\neps_1 = np.asarray([[np.sqrt(2), 0], [-1 / np.sqrt(2), np.sqrt(3 / 2)], [-1 / np.sqrt(2), -np.sqrt(3 / 2)]])\nS_v_0_1 = [1.0, 1.0]\nmu_1 = np.asarray([0.15, 0.15])\nrho = [1, 0.5, 0.0, -0.5, -0.9]\ntheta_2 = [0.0, 0.0]\nprint('theta_1 = {0:5.3f} ; theta_2 = {1:5.3f}'.format(theta_2[0], theta_2[1]))\nprint('{0:^5}  {1:^12}'.format('rho', 'C(S1,S2)'))\nfor _p in rho:\n    _sig21 = _p * 0.2\n    sigma_1 = np.asarray([[sig11, _sig21], [sig12, np.sqrt(0.2 ** 2 - _sig21 ** 2)]])\n    Z6 = price_vector_z(sigma_1, eps_1, dT_5, q)\n    S_coeffs_6 = price_vector_abc(sigma_1, eps_1, dT_5, q, mu_1, Z6)\n    _input_pars = [T_3, W_0_4, S_coeffs_6, theta_2, S_v_0_1, r_5, c_7, q]\n    print('{0:^ 4.1f}  {1:^12.10f}'.format(_p, Option_Portfolio(_input_pars, K_1, util_type='EXP', writeLog=False)))", "code_hash": "45499e470d8a872f42ba1f159de89e54", "config": {"column": null, "disabled": false, "hide_code": false}, "id": "dxZZ", "name": "_"}, {"code": "theta_3 = [0.005, 0.0]\nprint('theta_1 = {0:5.3f} ; theta_2 = {1:5.3f}'.format(theta_3[0], theta_3[1]))\nprint('{0:^5}  {1:^12}'.format('rho', 'C(S1,S2)'))\nfor _p in rho:\n    _sig21 = _p * 0.2\n    sigma_2 = np.asarray([[sig11, _sig21], [sig12, np.sqrt(0.2 ** 2 - _sig21 ** 2)]])\n    Z7 = price_vector_z(sigma_2, eps_1, dT_5, q)\n    S_coeffs_7 = price_vector_abc(sigma_2, eps_1, dT_5, q, mu_1, Z7)\n    _input_pars = [T_3, W_0_4, S_coeffs_7, theta_3, S_v_0_1, r_5, c_7, q]\n    print('{0:^ 4.2f}  {1:^12.10f}'.format(_p, Option_Portfolio(_input_pars, K_1, util_type='EXP', writeLog=False)))", "code_hash": "adffca033bdd12860e966740f19f367d", "config": {"column": null, "disabled": false, "hide_code": false}, "id": "dlnW", "name": "_"}, {"code": "theta_4 = [0.005, 0.005]\nprint('theta_1 = {0:5.3f} ; theta_2 = {1:5.3f}'.format(theta_4[0], theta_4[1]))\nprint('{0:^5}  {1:^12}'.format('rho', 'C(S1,S2)'))\nfor _p in rho:\n    _sig21 = _p * 0.2\n    sigma_3 = np.asarray([[sig11, _sig21], [sig12, np.sqrt(0.2 ** 2 - _sig21 ** 2)]])\n    Z8 = price_vector_z(sigma_3, eps_1, dT_5, q)\n    S_coeffs_8 = price_vector_abc(sigma_3, eps_1, dT_5, q, mu_1, Z8)\n    _input_pars = [T_3, W_0_4, S_coeffs_8, theta_4, S_v_0_1, r_5, c_7, q]\n    print('{0:^ 4.2f}  {1:^12.10f}'.format(_p, Option_Portfolio(_input_pars, K_1, util_type='EXP', writeLog=False)))", "code_hash": "0e4fcac2c49cd090ec248e5f2f0458e9", "config": {"column": null, "disabled": false, "hide_code": false}, "id": "TTti", "name": "_"}, {"code": "mo.md(r\"\"\"\u003Cb\u003E(h.) Reservation purchase price of a call option for T=9, as a function of $\\theta_i$, in the case of two risky securities; $\\rho = -0.9$.\u003C/b\u003E (Consider Table 11, \u003Ca href=\"https://www.sciencedirect.com/science/article/pii/S0168927498001044\"\u003EAndersen et. al.\u003C/a\u003E)\"\"\")", "code_hash": "b9231ae33809da2ac021dff013f74830", "config": {"column": null, "disabled": false, "hide_code": true}, "id": "RKFZ", "name": "_"}, {"code": "rho_1 = -0.9\n_sig21 = rho_1 * 0.2\nsigma_4 = np.asarray([[sig11, _sig21], [sig12, np.sqrt(0.2 ** 2 - _sig21 ** 2)]])\nZ9 = price_vector_z(sigma_4, eps_1, dT_5, q)\nS_coeffs_9 = price_vector_abc(sigma_4, eps_1, dT_5, q, mu_1, Z9)\ntheta_list = [0.0008, 0.0016, 0.003, 0.006, 0.01, 0.02, 0.05, 0.1]\nprint('{0:^5}  {1:^12}'.format('theta', 'C(S1,S2)'))\nfor theta_i in theta_list:\n    theta_5 = [theta_i, theta_i]\n    _input_pars = [T_3, W_0_4, S_coeffs_9, theta_5, S_v_0_1, r_5, c_7, q]\n    print('{0:^5.4f}  {1:^12.10f}'.format(theta_i, Option_Portfolio(_input_pars, K_1, util_type='EXP', writeLog=False)))", "code_hash": "d00fe31d9c906e500c5af9cd7be504be", "config": {"column": null, "disabled": false, "hide_code": false}, "id": "IaQp", "name": "_"}, {"code": "mo.md(r\"\"\"\u003Cb\u003E(i.) Computational efficiency for different values of T (time periods).\u003C/b\u003E (Consider Table 12, \u003Ca href=\"https://www.sciencedirect.com/science/article/pii/S0168927498001044\"\u003EAndersen et. al.\u003C/a\u003E)\"\"\")", "code_hash": "f3cfda319489e0a06c5a2d122856f763", "config": {"column": null, "disabled": false, "hide_code": true}, "id": "IWgg", "name": "_"}, {"code": "mo.md(r\"\"\"The columns of the output table in the following cell denote: T (time periods), cons. (number of constraints), vars. (number of variables), it. (number of iterations for the \u003Ci\u003Eno-option\u003C/i\u003E model as well as the \u003Ci\u003Eoption-price\u003C/i\u003E model), time. (time taken, in seconds for both models).\"\"\")", "code_hash": "30543d8afad6653cb6d762e4067a2ad3", "config": {"column": null, "disabled": false, "hide_code": true}, "id": "fCoF", "name": "_"}, {"code": "theta_6 = [0.005, 0.005]\nprint('{0:^2}  {1:^8}  {2:^10}  {3:^11}  {4:^11}'.format('', '', '', 'No-option', 'Option-price'))\nprint('{0:\u003E2}  {1:\u003E8}  {2:\u003E10}  {3:^3}  {4:^6}  {5:^3}  {6:^6}'.format('T', 'cons.', 'vars.', 'it.', 'time', 'it.', 'time'))\ntotal_info_arr = []\nfor T_4 in range(1, 10):\n    try:\n        T_horizon_5 = 1 / 4\n        dt = T_horizon_5 / T_4\n        r_6 = 1.06 ** dT_5 - 1\n        Z10 = price_vector_z(sigma_4, eps_1, dT_5, q)\n        S_coeffs_10 = price_vector_abc(sigma_4, eps_1, dT_5, q, mu_1, Z10)\n        _input_pars = [T_4, W_0_4, S_coeffs_10, theta_6, S_v_0_1, r_6, c_7, q]\n        call, n_cons, n_var, ut_it, ut_time, price_it, price_time = Option_Portfolio(_input_pars, K_1, util_type='EXP', writeLog=False, solver_info=True)\n        print('{0:\u003E2d}  {1:\u003E8d}  {2:\u003E10d}  {3:\u003E3d}  {4:\u003E6.3f}  {5:\u003E3d}  {6:\u003E6.3f}'.format(T_4, n_cons, n_var, ut_it, ut_time, price_it, price_time))\n        total_info_arr.append([call, n_cons, n_var, ut_it, ut_time, price_it, price_time])\n    except MemoryError as e:\n        print(e)\n        break\n    except SolutionError as s:\n        print(s)\n    except OptimizerError as e:\n        print(e)\n        break", "code_hash": "3bf857efdb061a9a681217d07c444116", "config": {"column": null, "disabled": false, "hide_code": false}, "id": "LkGn", "name": "_"}, {"code": "mo.md(r\"\"\"The calculations shown above were performed on a desktop with 15.6 GB of RAM and an Intel$^\\circledR$ Core$^{\\text{TM}}$ i7-6770HQ CPU @ 2.6 GHz $\\times$ 8.\"\"\")", "code_hash": "30caa2aa26809eb2978ccb7d5db28435", "config": {"column": null, "disabled": false, "hide_code": true}, "id": "zVRe", "name": "_"}, {"code": "mo.md(r\"\"\"\u003Ca rel=\"license\" href=\"http://creativecommons.org/licenses/by/4.0/\"\u003E\u003Cimg alt=\"Creative Commons License\" style=\"border-width:0\" src=\"https://i.creativecommons.org/l/by/4.0/80x15.png\" /\u003E\u003C/a\u003E\u003Cbr /\u003EThis work is licensed under a \u003Ca rel=\"license\" href=\"http://creativecommons.org/licenses/by/4.0/\"\u003ECreative Commons Attribution 4.0 International License\u003C/a\u003E. The **MOSEK** logo and name are trademarks of \u003Ca href=\"http://mosek.com\"\u003EMosek ApS\u003C/a\u003E. The code is provided as-is. Compatibility with future release of **MOSEK** or the `Fusion API` are not guaranteed. For more information contact our [support](mailto:support@mosek.com).\"\"\")", "code_hash": "1457d7ea0ad46d737c6d62314b6b464a", "config": {"column": null, "disabled": false, "hide_code": true}, "id": "woaO", "name": "_"}, {"code": "import marimo as mo", "code_hash": "1d0db38904205bec4d6f6f6a1f6cec3e", "config": {"column": null, "disabled": false, "hide_code": true}, "id": "HnMC", "name": "_"}], "metadata": {"marimo_version": "0.18.4"}, "version": "1"},
            "session": {"cells": [{"code_hash": "271c93fd1913447fc8645725a5909adb", "console": [], "id": "Hbol", "outputs": [{"data": {"text/markdown": "\u003Cspan class=\"markdown prose dark:prose-invert contents\"\u003E\u003Cspan class=\"paragraph\"\u003E\u003Cimg alt=\"MOSEK ApS\" src=\"https://www.mosek.com/static/images/branding/webgraphmoseklogocolor.png\" /\u003E\u003C/span\u003E\u003C/span\u003E"}, "type": "data"}]}, {"code_hash": "21b5eab5abf857c28a6431b10b99fda9", "console": [], "id": "MJUe", "outputs": [{"data": {"text/markdown": "\u003Cspan class=\"markdown prose dark:prose-invert contents\"\u003E\u003Ch1 id=\"utility-based-option-pricing-with-transaction-costs-and-diversification\"\u003EUtility based option pricing with transaction costs and diversification\u003C/h1\u003E\u003C/span\u003E"}, "type": "data"}]}, {"code_hash": "7a586eb7ae8f2d0663f9d7c1b28704cc", "console": [], "id": "vblA", "outputs": [{"data": {"text/markdown": "\u003Cspan class=\"markdown prose dark:prose-invert contents\"\u003E\u003Cspan class=\"paragraph\"\u003EIn this notebook, we present the \u003Ci\u003EFusion\u003C/i\u003E implementation of the utility based option pricing model, presented by \u003Ca href=\"https://www.sciencedirect.com/science/article/pii/S0168927498001044\" rel=\"noopener noreferrer\" target=\"_blank\"\u003EAndersen et. al. (1999)\u003C/a\u003E. The purpose of the model is to estimate the reservation purchase price of a European call option, written on a risky security when there is proportional transaction costs in the market.\u003C/span\u003E\u003C/span\u003E"}, "type": "data"}]}, {"code_hash": "625c77bfdf123262ac44a8d3aeced0ce", "console": [], "id": "bkHC", "outputs": [{"data": {"text/markdown": "\u003Cspan class=\"markdown prose dark:prose-invert contents\"\u003E\u003Ch2 id=\"the-model\"\u003EThe Model\u003C/h2\u003E\u003C/span\u003E"}, "type": "data"}]}, {"code_hash": "feba1d4d019a5b995303a266532dd43d", "console": [], "id": "lEQa", "outputs": [{"data": {"text/markdown": "\u003Cspan class=\"markdown prose dark:prose-invert contents\"\u003E\u003Cspan class=\"paragraph\"\u003EConsider an economy evolving over T periods, \u003Cmarimo-tex class=\"arithmatex\"\u003E||({0,t_1,t_2,t_3,...,t_T = \\overline{T}}||)\u003C/marimo-tex\u003E where \u003Cmarimo-tex class=\"arithmatex\"\u003E||(\\overline{T}||)\u003C/marimo-tex\u003E is the time horizon in years. We consider that the investor has one risk-free security, such as a bond, that pays at a constant interest rate of \u003Cmarimo-tex class=\"arithmatex\"\u003E||(r\\geq 0||)\u003C/marimo-tex\u003E, and \u003Cmarimo-tex class=\"arithmatex\"\u003E||(m||)\u003C/marimo-tex\u003E risky securities with price processes denoted by \u003Cmarimo-tex class=\"arithmatex\"\u003E||((S_1,S_2,...,S_m)||)\u003C/marimo-tex\u003E. The price of the risky securities evolves in an event tree such that:\u003C/span\u003E\n\u003Cmarimo-tex class=\"arithmatex\"\u003E||[(S_{1,n},S_{2,n},..,S_{m,n}) = \\begin{cases}\n(a_1 S_{1,n-1}, a_2 S_{2,n-1},..,a_m S_{m,n-1}), \\,\\, \\text{with probability } q_1, \\\\\n(b_1 S_{1,n-1}, b_2 S_{2,n-1},..,b_m S_{m,n-1}), \\,\\, \\text{with probability } q_2, \\\\\n(c_1 S_{1,n-1}, c_2 S_{2,n-1},..,c_m S_{m,n-1}), \\,\\, \\text{with probability } q_3 = (1-q_1-q_2)\n\\end{cases}\n||]\u003C/marimo-tex\u003E\u003Cspan class=\"paragraph\"\u003Ewhere the three possibilities lead to an event tree of splitting index 3 (In the fusion model presented below, we have considered a general case where one can have a different splitting index). The event tree for two risky securities can be visualized as shown in the figure below.\u003C/span\u003E\u003C/span\u003E"}, "type": "data"}]}, {"code_hash": "7b9ae8626bb88b18845ee377ee5ac50a", "console": [], "id": "PKri", "outputs": [{"data": {"text/markdown": "\u003Cspan class=\"markdown prose dark:prose-invert contents\"\u003E\u003Cspan class=\"paragraph\"\u003ELet, \u003Cmarimo-tex class=\"arithmatex\"\u003E||(\\mathbf{\\alpha_{n}} = (\\alpha_1,\\alpha_2,...,\\alpha_m)||)\u003C/marimo-tex\u003E denote the number of units of the risky security held by the investor at time \u003Cmarimo-tex class=\"arithmatex\"\u003E||(t_n||)\u003C/marimo-tex\u003E, and \u003Cmarimo-tex class=\"arithmatex\"\u003E||(\\beta_n||)\u003C/marimo-tex\u003E denote the dollar amount held by the investor in bonds at the same time. Then, the \u003Ci\u003E'budget constraint'\u003C/i\u003E on the bonds an investor can buy in the next period is given by:\u003C/span\u003E\n\u003Cmarimo-tex class=\"arithmatex\"\u003E||[\\beta_n(I_n) \\leq (1+r)\\beta_{n-1}(I_n) + \\sum_{i=1}^{m} S_{i,n}(I_n)[\\alpha_{i,n-1}(I_n) - \\alpha_{i,n}(I_n) - \\theta_i |\\alpha_{i,n-1}(I_n) - \\alpha_{i,n}(I_n)|]||]\u003C/marimo-tex\u003E\u003Cspan class=\"paragraph\"\u003Ewhere \u003Cmarimo-tex class=\"arithmatex\"\u003E||(\\theta_i||)\u003C/marimo-tex\u003E is the transaction cost for trading of risky security \u003Cmarimo-tex class=\"arithmatex\"\u003E||(i||)\u003C/marimo-tex\u003E and \u003Cmarimo-tex class=\"arithmatex\"\u003E||(I_n||)\u003C/marimo-tex\u003E denotes the path being considered (in other words, the sequence of events in the event tree). The total number of paths possible for a tree of splitting index \u003Cmarimo-tex class=\"arithmatex\"\u003E||(s||)\u003C/marimo-tex\u003E, over \u003Cmarimo-tex class=\"arithmatex\"\u003E||(n||)\u003C/marimo-tex\u003E time periods is \u003Cmarimo-tex class=\"arithmatex\"\u003E||(s^n||)\u003C/marimo-tex\u003E. Initially, if we consider that the wealth of the investor is \u003Cmarimo-tex class=\"arithmatex\"\u003E||(W_0||)\u003C/marimo-tex\u003E, then of course the first budget constraint becomes:\u003C/span\u003E\n\u003Cmarimo-tex class=\"arithmatex\"\u003E||[\\beta_0 \\leq W_0 - \\sum_{i=1}^{m} S_{i,0}[\\alpha_{i,0} + |\\alpha_{i,0}|]||]\u003C/marimo-tex\u003E\u003Cspan class=\"paragraph\"\u003EAdditionally, in the final period the investor will sell all of the risky securities, thus ending up with a wealth \u003Cmarimo-tex class=\"arithmatex\"\u003E||(W_T(I_T)||)\u003C/marimo-tex\u003E for path \u003Cmarimo-tex class=\"arithmatex\"\u003E||(I_T||)\u003C/marimo-tex\u003E, such that:\u003C/span\u003E\n\u003Cmarimo-tex class=\"arithmatex\"\u003E||[W_T(I_T) \\leq (1+r)\\beta_{T-1}(I_T) + \\sum_{i=1}^{m} S_{i,T}(I_T)[\\alpha_{i,T-1}(I_T) - \\theta_i |\\alpha_{i,T-1}(I_T)|]||]\u003C/marimo-tex\u003E\u003C/span\u003E"}, "type": "data"}]}, {"code_hash": "251fdff7c1f7ef7fdcfc40f07a5eccc2", "console": [], "id": "Xref", "outputs": [{"data": {"text/markdown": "\u003Cspan class=\"markdown prose dark:prose-invert contents\"\u003E\u003Ch3 id=\"1-portfolio-choice\"\u003E1.) Portfolio choice\u003C/h3\u003E\u003C/span\u003E"}, "type": "data"}]}, {"code_hash": "31620c238300b47ca5755db9b52e8665", "console": [], "id": "SFPL", "outputs": [{"data": {"text/markdown": "\u003Cspan class=\"markdown prose dark:prose-invert contents\"\u003E\u003Cspan class=\"paragraph\"\u003EThe goal of the investor is to choose a portfolio strategy (i.e. the sequence {\u003Cmarimo-tex class=\"arithmatex\"\u003E||({\\mathbf{\\alpha_n(I_n)},\\beta_n(I_n)}||)\u003C/marimo-tex\u003E}) that maximizes the expected utility. The expected utility is given by:\u003C/span\u003E\n\u003Cmarimo-tex class=\"arithmatex\"\u003E||[E[U(W_T)] = \\sum_{I_{T}\\in F_T} q_1^{A(I_T)}q_2^{B(I_T)}(1-q_1-q_2)^{T-A(I_T)-B(I_T)}U(W_T(I_T))||]\u003C/marimo-tex\u003E\u003Cspan class=\"paragraph\"\u003ENote that the summation is over all the possible paths for a tree of a given split index and T time-periods (the set denoted by \u003Cmarimo-tex class=\"arithmatex\"\u003E||(F_T||)\u003C/marimo-tex\u003E). \u003Cmarimo-tex class=\"arithmatex\"\u003E||(A(I_T)||)\u003C/marimo-tex\u003E and \u003Cmarimo-tex class=\"arithmatex\"\u003E||(B(I_T)||)\u003C/marimo-tex\u003E denote the number of times the first and second possibilities are considered in every path, respectively. Following the equations presented above, the complete optimization problem can be written as:\u003C/span\u003E\n\u003Cmarimo-tex class=\"arithmatex\"\u003E||[U^*(W_0) = \\text{maximize}_{({\\mathbf{\\alpha}_n(I_n),\\beta_n(I_n))}_{I_n\\in F_T,{n=1,2,..,T-1}}}\\,\\,\\,E[U(W_T)]||]\u003C/marimo-tex\u003E\u003Cmarimo-tex class=\"arithmatex\"\u003E||[\\text{subject to:  } \\beta_0 \\leq W_0 - \\sum_{i=1}^{m} S_{i,0}[\\alpha_{i,0} + |\\alpha_{i,0}|],||]\u003C/marimo-tex\u003E\u003Cmarimo-tex class=\"arithmatex\"\u003E||[\\beta_n(I_n) \\leq (1+r)\\beta_{n-1}(I_n) + \\sum_{i=1}^{m} S_{i,n}(I_n)[\\alpha_{i,n-1}(I_n) - \\alpha_{i,n}(I_n) - \\theta_i |\\alpha_{i,n-1}(I_n) - \\alpha_{i,n}(I_n)|],||]\u003C/marimo-tex\u003E\u003Cmarimo-tex class=\"arithmatex\"\u003E||[W_T(I_T) \\leq (1+r)\\beta_{T-1}(I_T) + \\sum_{i=1}^{m} S_{i,T}(I_T)[\\alpha_{i,T-1}(I_T) - \\theta_i |\\alpha_{i,T-1}(I_T)|],\\,\\,\\, \\forall I_T\\in F_T||]\u003C/marimo-tex\u003E\u003C/span\u003E"}, "type": "data"}]}, {"code_hash": "0ee83ef9672dbe6532fa07ea1c3fcf27", "console": [], "id": "BYtC", "outputs": [{"data": {"text/markdown": "\u003Cspan class=\"markdown prose dark:prose-invert contents\"\u003E\u003Ch3 id=\"2-price-vector-process\"\u003E2.) Price vector process\u003C/h3\u003E\u003C/span\u003E"}, "type": "data"}]}, {"code_hash": "edfb3022ba0f2d6eeadf78b36f1494ec", "console": [], "id": "RGSE", "outputs": [{"data": {"text/markdown": "\u003Cspan class=\"markdown prose dark:prose-invert contents\"\u003E\u003Cspan class=\"paragraph\"\u003EThe continuous price process that we intended to approximate is:\u003C/span\u003E\n\u003Cmarimo-tex class=\"arithmatex\"\u003E||[\\frac{d\\tilde{S_i}}{\\tilde{S_i}} = \\mu_idt + \\sum_{j=1}^{m}\\sigma_{ij} dW_j \\,\\, , \\,\\, \\forall i = 1,2,...,m||]\u003C/marimo-tex\u003E\u003Cspan class=\"paragraph\"\u003Ewhere \u003Cmarimo-tex class=\"arithmatex\"\u003E||(\\mu_i||)\u003C/marimo-tex\u003E and \u003Cmarimo-tex class=\"arithmatex\"\u003E||(\\sigma_{ij}||)\u003C/marimo-tex\u003E are positive constants and the \u003Cmarimo-tex class=\"arithmatex\"\u003E||(W_j||)\u003C/marimo-tex\u003E denote un-correlated standard Wiener processes. To construct a discrete approximation, we first define a stochastic vector as follows:\u003C/span\u003E\n\u003Cmarimo-tex class=\"arithmatex\"\u003E||[(\\epsilon_1,\\epsilon_2,..,\\epsilon_m) = \\begin{cases}\n(\\epsilon_1 (\\omega_1),\\epsilon_2 (\\omega_1),..,\\epsilon_m (\\omega_1)), \\,\\, \\text{with probability } q_1, \\\\\n(\\epsilon_1 (\\omega_2),\\epsilon_2 (\\omega_2),..,\\epsilon_m (\\omega_2)), \\,\\, \\text{with probability } q_2, \\\\\n(\\epsilon_1 (\\omega_3),\\epsilon_2 (\\omega_3),..,\\epsilon_m (\\omega_3)), \\,\\, \\text{with probability } q_3 = (1-q_1-q_2)\n\\end{cases}\n||]\u003C/marimo-tex\u003E\u003C/span\u003E"}, "type": "data"}]}, {"code_hash": "d5cf2f9daa739a0086250ac5407d2013", "console": [], "id": "Kclp", "outputs": [{"data": {"text/markdown": "\u003Cspan class=\"markdown prose dark:prose-invert contents\"\u003E\u003Cspan class=\"paragraph\"\u003EThe equation describing the event tree (first equation of the notebook) becomes a discrete approximation of the above-stated stochastic process if we set:\u003C/span\u003E\n\u003Cmarimo-tex class=\"arithmatex\"\u003E||[a_i = e^{\\mu_i \\Delta t}\\bigg( \\frac{e^{\\big[\\sum_{j=1}^{m}\\sigma_{ij}\\epsilon_j(\\omega_1)\\sqrt{\\Delta t}\\big]}}{z_i}\\bigg)||]\u003C/marimo-tex\u003E\u003Cmarimo-tex class=\"arithmatex\"\u003E||[b_i = e^{\\mu_i \\Delta t}\\bigg( \\frac{e^{\\big[\\sum_{j=1}^{m}\\sigma_{ij}\\epsilon_j(\\omega_2)\\sqrt{\\Delta t}\\big]}}{z_i}\\bigg)||]\u003C/marimo-tex\u003E\u003Cmarimo-tex class=\"arithmatex\"\u003E||[c_i = e^{\\mu_i \\Delta t}\\bigg( \\frac{e^{\\big[\\sum_{j=1}^{m}\\sigma_{ij}\\epsilon_j(\\omega_3)\\sqrt{\\Delta t}\\big]}}{z_i}\\bigg)||]\u003C/marimo-tex\u003E\u003Cspan class=\"paragraph\"\u003EIn the limit \u003Cmarimo-tex class=\"arithmatex\"\u003E||(T\\to \\infty||)\u003C/marimo-tex\u003E (or alternatively \u003Cmarimo-tex class=\"arithmatex\"\u003E||(\\Delta t \\to 0||)\u003C/marimo-tex\u003E), the approximation approaches the continuous process.\u003C/span\u003E\u003C/span\u003E"}, "type": "data"}]}, {"code_hash": "ad62bd21514321339ce843c4b66de78d", "console": [], "id": "emfo", "outputs": [{"data": {"text/markdown": "\u003Cspan class=\"markdown prose dark:prose-invert contents\"\u003E\u003Ch3 id=\"3-investors-reservation-purchase-price-for-a-european-call-option\"\u003E3.) Investor's reservation purchase price for a European call option\u003C/h3\u003E\u003C/span\u003E"}, "type": "data"}]}, {"code_hash": "374db6a77a617b53d589027eb3f99a73", "console": [], "id": "Hstk", "outputs": [{"data": {"text/markdown": "\u003Cspan class=\"markdown prose dark:prose-invert contents\"\u003E\u003Cspan class=\"paragraph\"\u003ESuppose that an investor is interested in buying a European call option on the security \u003Cmarimo-tex class=\"arithmatex\"\u003E||(S_1||)\u003C/marimo-tex\u003E, with time to maturity \u003Cmarimo-tex class=\"arithmatex\"\u003E||(\\overline{T}||)\u003C/marimo-tex\u003E and a strike price \u003Cmarimo-tex class=\"arithmatex\"\u003E||(K\u0026gt;0||)\u003C/marimo-tex\u003E. At the expiration time, the investor would get a payment of \u003Cmarimo-tex class=\"arithmatex\"\u003E||(\\text{max}(S_{1,T} - K, 0)||)\u003C/marimo-tex\u003E (assuming cash settlement and also that the investor will not be re-selling the option once it has been purchased.) Our goal is now to estimate the highest price this investor is willing to pay, to purchase such an option.\u003C/span\u003E\u003C/span\u003E"}, "type": "data"}]}, {"code_hash": "4d5c2219a06fc5a157aebf81469c3a0e", "console": [], "id": "nWHF", "outputs": [{"data": {"text/markdown": "\u003Cspan class=\"markdown prose dark:prose-invert contents\"\u003E\u003Cspan class=\"paragraph\"\u003EIf the investor does not purchase the call option and only trades in the risky securities \u003Cmarimo-tex class=\"arithmatex\"\u003E||(S_i||)\u003C/marimo-tex\u003E and the bonds, then the portfolio is given by the optimization problem stated above. However, if the investor buys the call option at a reservation purchase price of \u003Cmarimo-tex class=\"arithmatex\"\u003E||(C||)\u003C/marimo-tex\u003E, then their portfolio becomes the following:\u003C/span\u003E\u003C/span\u003E"}, "type": "data"}]}, {"code_hash": "ef3a2c9e99314eb7f708be59682d9bfe", "console": [], "id": "iLit", "outputs": [{"data": {"text/markdown": "\u003Cspan class=\"markdown prose dark:prose-invert contents\"\u003E\u003Cmarimo-tex class=\"arithmatex\"\u003E||[P(C,W_0) = \\text{maximize}_{({\\mathbf{\\alpha}_n(I_n),\\beta_n(I_n))}_{I_n\\in F_T,{n=1,2,..,T-1}}}\\,\\,\\,E[U(W_T)]||]\u003C/marimo-tex\u003E\u003Cmarimo-tex class=\"arithmatex\"\u003E||[\\text{subject to:   }\\beta_0 \\leq W_0 - C - \\sum_{i=1}^{m} S_{i,0}[\\alpha_{i,0} + |\\alpha_{i,0}|],||]\u003C/marimo-tex\u003E\u003Cmarimo-tex class=\"arithmatex\"\u003E||[\\beta_n(I_n) \\leq (1+r)\\beta_{n-1}(I_n) + \\sum_{i=1}^{m} S_{i,n}(I_n)[\\alpha_{i,n-1}(I_n) - \\alpha_{i,n}(I_n) - \\theta_i |\\alpha_{i,n-1}(I_n) - \\alpha_{i,n}(I_n)|],||]\u003C/marimo-tex\u003E\u003Cmarimo-tex class=\"arithmatex\"\u003E||[W_T(I_T) \\leq (1+r)\\beta_{T-1}(I_T) + \\sum_{i=1}^{m} S_{i,T}(I_T)[\\alpha_{i,T-1}(I_T) - \\theta_i |\\alpha_{i,T-1}(I_T)|] + \\text{max}(S_{1,T}(I_T) - K,0), \\,\\,\\, \\forall I_T\\in F_T||]\u003C/marimo-tex\u003E\u003C/span\u003E"}, "type": "data"}]}, {"code_hash": "68d76aa168358ac4d7833683aa5dce65", "console": [], "id": "ZHCJ", "outputs": [{"data": {"text/markdown": "\u003Cspan class=\"markdown prose dark:prose-invert contents\"\u003E\u003Cspan class=\"paragraph\"\u003EThe highest price that investor is willing to pay for the given call option, is therefore given by the price for which the maximum expected utility in the two portfolios becomes equal, making the investor indifferent to the choices. Thus, the final optimization problem that we need to consider is:\u003C/span\u003E\n\u003Cmarimo-tex class=\"arithmatex\"\u003E||[C^* = \\text{maximize}_{({\\mathbf{\\alpha}_n(I_n),\\beta_n(I_n))}_{I_n\\in F_T,{n=1,2,..,T-1}}} \\,\\,\\, C||]\u003C/marimo-tex\u003E\u003Cmarimo-tex class=\"arithmatex\"\u003E||[\\text{subject to: } E[U(W_T)] \\geq U^*(W_0) ||]\u003C/marimo-tex\u003E\u003Cspan class=\"paragraph\"\u003Ealong with the other constraints mentioned in the optimization problem for the portfolio in which the option is purchased.\u003C/span\u003E\u003C/span\u003E"}, "type": "data"}]}, {"code_hash": "d52e9a0fec4fa83c645a1db9b990fdb6", "console": [], "id": "ROlb", "outputs": [{"data": {"text/markdown": "\u003Cspan class=\"markdown prose dark:prose-invert contents\"\u003E\u003Ch3 id=\"4-utility-function\"\u003E4.) Utility function\u003C/h3\u003E\u003C/span\u003E"}, "type": "data"}]}, {"code_hash": "96bd836f9fe889486738ed332724a667", "console": [], "id": "qnkX", "outputs": [{"data": {"text/markdown": "\u003Cspan class=\"markdown prose dark:prose-invert contents\"\u003E\u003Cspan class=\"paragraph\"\u003EIn the optimization problems mentioned above, we need to optimize the expected utility. The utility functions that we consider are members of a family called HARA utility functions (Hyperbolic Absolute Risk Aversion). The general expression for HARA utility is:\u003C/span\u003E\n\u003Cmarimo-tex class=\"arithmatex\"\u003E||[U(W) = \\frac{1-\\gamma}{\\gamma}\\bigg(\\frac{aW}{1-\\gamma} + b\\bigg)^\\gamma \\,;\\, a\u0026gt;0||]\u003C/marimo-tex\u003E\u003Cspan class=\"paragraph\"\u003Ewhere \u003Cmarimo-tex class=\"arithmatex\"\u003E||(W \u0026gt; ((\\gamma - 1)b)/a||)\u003C/marimo-tex\u003E. Note that the exponential and logarithmic utility functions are also members of the HARA-class.\u003C/span\u003E\u003C/span\u003E"}, "type": "data"}]}, {"code_hash": "ddbcacee30e4eadd594dac907f62a2f3", "console": [], "id": "TqIu", "outputs": [{"data": {"text/markdown": "\u003Cspan class=\"markdown prose dark:prose-invert contents\"\u003E\u003Cspan class=\"paragraph\"\u003EAnother thing to consider is the Arrow-Pratt measure of the Absolute risk aversion. For the HARA-class, it is:\u003C/span\u003E\n\u003Cmarimo-tex class=\"arithmatex\"\u003E||[ARA(W) = \\bigg(\\frac{W}{1-\\gamma} + \\frac{b}{a}\\bigg)^{-1}||]\u003C/marimo-tex\u003E\u003C/span\u003E"}, "type": "data"}]}, {"code_hash": "c6e7ea95a86124310192111484eb7a1a", "console": [], "id": "Vxnm", "outputs": [{"data": {"text/markdown": "\u003Cspan class=\"markdown prose dark:prose-invert contents\"\u003E\u003Ch1 id=\"fusion-implementation\"\u003EFusion Implementation\u003C/h1\u003E\u003C/span\u003E"}, "type": "data"}]}, {"code_hash": "1da59235aee77b064e03b7f31942c02b", "console": [], "id": "DnEU", "outputs": [{"data": {"text/markdown": "\u003Cspan class=\"markdown prose dark:prose-invert contents\"\u003E\u003Cspan class=\"paragraph\"\u003ENow we proceed with the construction of the fusion model. We start by making a Tree class that will represent the event tree discussed above.\u003C/span\u003E\u003C/span\u003E"}, "type": "data"}]}, {"code_hash": "955dd180dc13a0e7df50dc3a74328c0c", "console": [], "id": "ulZA", "outputs": [{"data": {"text/markdown": "\u003Cspan class=\"markdown prose dark:prose-invert contents\"\u003E\u003Ch3 id=\"parameters-for-initializing-the-tree-class\"\u003EParameters for Initializing the Tree Class\u003C/h3\u003E\n\u003Cspan class=\"paragraph\"\u003EWhen creating a Tree object, the following parameters define the investment environment and decision-making setup:\u003C/span\u003E\n\u003Cul\u003E\n\u003Cli\u003E\u003Cstrong\u003EM\u003C/strong\u003E \u2013 The optimization model, typically a MOSEK Fusion \u003Ccode\u003EModel\u003C/code\u003E, that will hold variables, constraints, and the objective.\u003C/li\u003E\n\u003Cli\u003E\u003Cstrong\u003ET\u003C/strong\u003E \u2013 The number of discrete time steps in the investment horizon.\u003C/li\u003E\n\u003Cli\u003E\u003Cstrong\u003EW\u2080\u003C/strong\u003E \u2013 The investor\u2019s initial wealth at time 0.\u003C/li\u003E\n\u003Cli\u003E\u003Cstrong\u003ES\u003C/strong\u003E \u2013 The price-scaling matrix that adjusts asset prices over time.\u003C/li\u003E\n\u003Cli\u003E\u003Cstrong\u003E\u03b8\u003C/strong\u003E \u2013 The vector of transaction costs, representing costs incurred when trading risky assets.\u003C/li\u003E\n\u003Cli\u003E\u003Cstrong\u003ES\u1d65\u2080\u003C/strong\u003E \u2013 The initial price vector for the risky securities at time 0.\u003C/li\u003E\n\u003Cli\u003E\u003Cstrong\u003Er\u003C/strong\u003E \u2013 The risk-free interest rate applied to bonds.\u003C/li\u003E\n\u003Cli\u003E\u003Cstrong\u003EU = [a, b, \u03b3]\u003C/strong\u003E \u2013 The set of parameters defining the investor\u2019s HARA (Hyperbolic Absolute Risk Aversion) utility function, capturing risk preferences.\u003C/li\u003E\n\u003C/ul\u003E\u003C/span\u003E"}, "type": "data"}]}, {"code_hash": "5ebdc6915d7ca1ad010364a65313a920", "console": [], "id": "ecfG", "outputs": [{"data": {"text/markdown": "\u003Cspan class=\"markdown prose dark:prose-invert contents\"\u003E\u003Ch3 id=\"hara-utility-as-a-power-cone\"\u003EHARA utility as a Power cone:\u003C/h3\u003E\u003C/span\u003E"}, "type": "data"}]}, {"code_hash": "c1145c5406e9af887526a1a48fdbb1fc", "console": [], "id": "Pvdt", "outputs": [{"data": {"text/markdown": "\u003Cspan class=\"markdown prose dark:prose-invert contents\"\u003E\u003Cspan class=\"paragraph\"\u003EThe objective function is:\u003C/span\u003E\n\u003Cmarimo-tex class=\"arithmatex\"\u003E||[\\text{maximize   }E[U(W_T)] = \\sum_{I_T\\in F_T}P(I_T) \\bigg(\\frac{1-\\gamma}{\\gamma}\\bigg)  \\bigg(\\frac{aW(I_T)}{1-\\gamma} + b\\bigg)^\\gamma||]\u003C/marimo-tex\u003E\u003Cspan class=\"paragraph\"\u003Ewhere \u003Cmarimo-tex class=\"arithmatex\"\u003E||(P(I_T)||)\u003C/marimo-tex\u003E is the probability of a given path. We can re-write this as:\u003C/span\u003E\n\u003Cmarimo-tex class=\"arithmatex\"\u003E||[\\text{maximize   } \\sum_{I_T\\in F_T}P(I_T) \\bigg(\\frac{1-\\gamma}{\\gamma}\\bigg) h(I_T)||]\u003C/marimo-tex\u003E\u003Cmarimo-tex class=\"arithmatex\"\u003E||[\\text{subject to :   } h(I_T)\\leq \\bigg(\\frac{aW(I_T)}{1-\\gamma} + b\\bigg)^\\gamma||]\u003C/marimo-tex\u003E\u003Cspan class=\"paragraph\"\u003ENow, the constraint can be expressed as a Power cone. However, there are a few possible cases:\u003C/span\u003E\n\u003Cspan class=\"paragraph\"\u003E1.) \u003Cmarimo-tex class=\"arithmatex\"\u003E||(\\gamma \u0026gt; 1||)\u003C/marimo-tex\u003E: In this case, the conic representation is:\u003C/span\u003E\n\u003Cmarimo-tex class=\"arithmatex\"\u003E||[\\Bigg(h(I_T),1,\\bigg(\\frac{aW(I_T)}{1-\\gamma} + b\\bigg) \\Bigg) \\in \\mathcal{P}_3^{1/\\gamma}||]\u003C/marimo-tex\u003E\u003Cspan class=\"paragraph\"\u003E2.) \u003Cmarimo-tex class=\"arithmatex\"\u003E||(0 \u0026lt; \\gamma \u0026lt; 1||)\u003C/marimo-tex\u003E:\u003C/span\u003E\n\u003Cmarimo-tex class=\"arithmatex\"\u003E||[\\Bigg(\\bigg(\\frac{aW(I_T)}{1-\\gamma} + b\\bigg),1, h(I_T) \\Bigg) \\in \\mathcal{P}_3^{\\gamma}||]\u003C/marimo-tex\u003E\u003Cspan class=\"paragraph\"\u003E3.) \u003Cmarimo-tex class=\"arithmatex\"\u003E||(\\gamma \u0026lt; 0||)\u003C/marimo-tex\u003E:\u003C/span\u003E\n\u003Cmarimo-tex class=\"arithmatex\"\u003E||[\\Bigg(h(I_T),\\bigg(\\frac{aW(I_T)}{1-\\gamma} + b\\bigg),1  \\Bigg) \\in \\mathcal{P}_3^{1/(1-\\gamma)}||]\u003C/marimo-tex\u003E\u003C/span\u003E"}, "type": "data"}]}, {"code_hash": "6793fc9396c18f62c24d38d10d23b16a", "console": [], "id": "ZBYS", "outputs": [{"data": {"text/markdown": "\u003Cspan class=\"markdown prose dark:prose-invert contents\"\u003E\u003Ch3 id=\"exponential-utility-as-an-exponential-cone\"\u003EExponential utility as an exponential cone:\u003C/h3\u003E\u003C/span\u003E"}, "type": "data"}]}, {"code_hash": "ac5ad3ec3bc5e3cb2bd6a3652eab0bf6", "console": [], "id": "aLJB", "outputs": [{"data": {"text/markdown": "\u003Cspan class=\"markdown prose dark:prose-invert contents\"\u003E\u003Cspan class=\"paragraph\"\u003EThe objective function in the case of exponential utility will be given by:\u003C/span\u003E\n\u003Cmarimo-tex class=\"arithmatex\"\u003E||[\\text{maximize   }E[U(W_T)] = \\sum_{I_T\\in F_T}P(I_T) \\bigg(1 - e^{- [\\text{ARA}(W)] W(I_T)}\\bigg)\n||]\u003C/marimo-tex\u003E\u003Cspan class=\"paragraph\"\u003Eif the Absolute Risk aversion is nonzero. However, if ARA\u003Cmarimo-tex class=\"arithmatex\"\u003E||((W) = 0||)\u003C/marimo-tex\u003E, then the objective function is simply:\u003C/span\u003E\n\u003Cmarimo-tex class=\"arithmatex\"\u003E||[\\text{maximize   }E[U(W_T)] = \\sum_{I_T\\in F_T}P(I_T) W(I_T)||]\u003C/marimo-tex\u003E\u003Cspan class=\"paragraph\"\u003EFor the non-zero ARA\u003Cmarimo-tex class=\"arithmatex\"\u003E||((W)||)\u003C/marimo-tex\u003E, we express the objective function as follows:\u003C/span\u003E\n\u003Cmarimo-tex class=\"arithmatex\"\u003E||[\\text{maximize   } \\sum_{I_T\\in F_T}P(I_T) h(I_T)||]\u003C/marimo-tex\u003E\u003Cmarimo-tex class=\"arithmatex\"\u003E||[\\text{subject to:  } (1-h(I_T))\\geq e^{-[\\text{ARA}(W)]W(I_T)}||]\u003C/marimo-tex\u003E\u003Cspan class=\"paragraph\"\u003Eand the constraint is readily expressed as an exponential cone:\u003C/span\u003E\n\u003Cmarimo-tex class=\"arithmatex\"\u003E||[\\big((1-h(I_T)),1,-[\\text{ARA}(W)]W(I_T)\\big) \\in K_{exp}||]\u003C/marimo-tex\u003E\u003C/span\u003E"}, "type": "data"}]}, {"code_hash": "88c6a0b25bb955b6f7bd9d2ff3990136", "console": [], "id": "nHfw", "outputs": [{"data": {"text/plain": ""}, "type": "data"}]}, {"code_hash": "e041cc8373b5ba5789368bcd2509d67e", "console": [], "id": "xXTn", "outputs": [{"data": {"text/plain": ""}, "type": "data"}]}, {"code_hash": "ca864b4f823644018656531685ae1b4a", "console": [], "id": "AjVT", "outputs": [{"data": {"text/markdown": "\u003Cspan class=\"markdown prose dark:prose-invert contents\"\u003E\u003Cspan class=\"paragraph\"\u003EThe \u003Ci\u003ETree\u003C/i\u003E class defined above has the sub-class \u003Ci\u003ELevel\u003C/i\u003E. The budget constraints involved in our model connect variables that lie in consecutive levels. Therefore, we can visualize all the constraints between two levels in the following manner (Note: for ease of visualization, we take the split index as \u003Cmarimo-tex class=\"arithmatex\"\u003E||(s = 3||)\u003C/marimo-tex\u003E, and a time period of n = 3):\u003C/span\u003E\n\u003Cmarimo-tex class=\"arithmatex\"\u003E||[\n\\begin{pmatrix}\na\\begin{bmatrix}\nS_{(1,2)} \\\\\nS_{(2,2)} \\\\\nS_{(3,2)} \\\\\n\\end{bmatrix}\\\\\nb\\begin{bmatrix}\nS_{(1,2)} \\\\\nS_{(2,2)} \\\\\nS_{(3,2)} \\\\\n\\end{bmatrix}\\\\\nc\\begin{bmatrix}\nS_{(1,2)} \\\\\nS_{(2,2)} \\\\\nS_{(3,2)} \\\\\n\\end{bmatrix}\\\\\n\\end{pmatrix}\n:\n\\begin{pmatrix}\n\\begin{bmatrix}\n\\mathbf{\\alpha_{(1,2)}},\\beta_{(1,2)} \\\\\n\\mathbf{\\alpha_{(2,2)}},\\beta_{(2,2)} \\\\\n\\mathbf{\\alpha_{(3,2)}},\\beta_{(3,2)} \\\\\n\\end{bmatrix} \\\\\n\\begin{bmatrix}\n\\mathbf{\\alpha_{(1,2)}},\\beta_{(1,2)} \\\\\n\\mathbf{\\alpha_{(2,2)}},\\beta_{(2,2)} \\\\\n\\mathbf{\\alpha_{(3,2)}},\\beta_{(3,2)} \\\\\n\\end{bmatrix} \\\\\n\\begin{bmatrix}\n\\mathbf{\\alpha_{(1,2)}},\\beta_{(1,2)} \\\\\n\\mathbf{\\alpha_{(2,2)}},\\beta_{(2,2)} \\\\\n\\mathbf{\\alpha_{(3,2)}},\\beta_{(3,2)} \\\\\n\\end{bmatrix} \\\\\n\\end{pmatrix}  \\longrightarrow\n\\begin{pmatrix}\n\\mathbf{\\alpha_{(1,3)}},\\beta_{(1,3)} \\\\\n\\mathbf{\\alpha_{(2,3)}},\\beta_{(2,3)} \\\\\n\\mathbf{\\alpha_{(3,3)}},\\beta_{(3,3)} \\\\\n\\mathbf{\\alpha_{(4,3)}},\\beta_{(4,3)} \\\\\n\\mathbf{\\alpha_{(5,3)}},\\beta_{(5,3)} \\\\\n\\mathbf{\\alpha_{(6,3)}},\\beta_{(6,3)} \\\\\n\\mathbf{\\alpha_{(7,3)}},\\beta_{(7,3)} \\\\\n\\mathbf{\\alpha_{(8,3)}},\\beta_{(8,3)} \\\\\n\\mathbf{\\alpha_{(9,3)}},\\beta_{(9,3)} \\\\\n\\end{pmatrix}\n||]\u003C/marimo-tex\u003E\u003Cspan class=\"paragraph\"\u003EHere, the first column vector is a \u003Ci\u003E\"vstack\"\u003C/i\u003E of the price vector at level \u003Cmarimo-tex class=\"arithmatex\"\u003E||(n=2||)\u003C/marimo-tex\u003E, multiplied by the scaling factors for the price. Therefore, the first column is the new price vector (for \u003Cmarimo-tex class=\"arithmatex\"\u003E||(n=3||)\u003C/marimo-tex\u003E). In the second column, \u003Cmarimo-tex class=\"arithmatex\"\u003E||(\\alpha||)\u003C/marimo-tex\u003E's will be vectors if there are multiple risky securities. Also, \u003Cmarimo-tex class=\"arithmatex\"\u003E||(\\alpha_{(i,n)}||)\u003C/marimo-tex\u003E and \u003Cmarimo-tex class=\"arithmatex\"\u003E||(\\beta_{(i,n)}||)\u003C/marimo-tex\u003E correspond to the number of risky securities and the bonds, respectively, for the \u003Cmarimo-tex class=\"arithmatex\"\u003E||(i^{\\text{th}}||)\u003C/marimo-tex\u003E path at the \u003Cmarimo-tex class=\"arithmatex\"\u003E||(n^{\\text{th}}||)\u003C/marimo-tex\u003E time period. It is to be realized that for a given time period, \u003Cmarimo-tex class=\"arithmatex\"\u003E||(1\\leq i \\leq s^n||)\u003C/marimo-tex\u003E.\u003C/span\u003E\n\u003Cspan class=\"paragraph\"\u003EThe above-stated representation shows that we can \u003Ci\u003E\"repeat\"\u003C/i\u003E the variables of the previous level \u003Cmarimo-tex class=\"arithmatex\"\u003E||(s||)\u003C/marimo-tex\u003E number of times and then it becomes quite easy to implement the budget constraints in \u003Ci\u003EFusion\u003C/i\u003E. One can also extend the above shown method to a higher split index.\u003C/span\u003E\u003C/span\u003E"}, "type": "data"}]}, {"code_hash": "8d0e30e9d2fc7f8d1db49f4eb9398c07", "console": [], "id": "pHFh", "outputs": [{"data": {"text/plain": ""}, "type": "data"}]}, {"code_hash": "d09f6827d335c660c308e3357d5cee07", "console": [], "id": "NCOB", "outputs": [{"data": {"text/markdown": "\u003Cspan class=\"markdown prose dark:prose-invert contents\"\u003E\u003Ch3 id=\"now-that-we-have-the-basic-structure-of-the-tree-ready-we-can-easily-make-the-fusion-model-as-follows\"\u003ENow that we have the basic structure of the tree ready, we can easily make the \u003Ci\u003EFusion\u003C/i\u003E model as follows...\u003C/h3\u003E\u003C/span\u003E"}, "type": "data"}]}, {"code_hash": "c7c6957cbf80d754a73b9cd6637bbc61", "console": [], "id": "aqbW", "outputs": [{"data": {"text/markdown": "\u003Cspan class=\"markdown prose dark:prose-invert contents\"\u003E\u003Cspan class=\"paragraph\"\u003EWe will represent the paths \u003Cmarimo-tex class=\"arithmatex\"\u003E||(I_T||)\u003C/marimo-tex\u003E by their numbers. Therefore, we have (split_index)\u003Cmarimo-tex class=\"arithmatex\"\u003E||(^T||)\u003C/marimo-tex\u003E paths. Each Path number represented in the base of the split index will give us a unique id for each path.\u003C/span\u003E\u003C/span\u003E"}, "type": "data"}]}, {"code_hash": "5f70432b5ee80b9c8e7e402949f627e7", "console": [], "id": "TRpd", "outputs": [{"data": {"text/plain": ""}, "type": "data"}]}, {"code_hash": "00deb359a0a9a7a579c66dddb8565f36", "console": [], "id": "TXez", "outputs": [{"data": {"text/markdown": "\u003Cspan class=\"markdown prose dark:prose-invert contents\"\u003E\u003Ch3 id=\"portfolio-without-call-option\"\u003EPortfolio without call option:\u003C/h3\u003E\u003C/span\u003E"}, "type": "data"}]}, {"code_hash": "be5b9f94ab0902c31e46aee30be6bc79", "console": [], "id": "dNNg", "outputs": [{"data": {"text/plain": ""}, "type": "data"}]}, {"code_hash": "29af54ceaaed297a538c48ea65535135", "console": [], "id": "yCnT", "outputs": [{"data": {"text/markdown": "\u003Cspan class=\"markdown prose dark:prose-invert contents\"\u003E\u003Ch3 id=\"portfolio-with-call-option\"\u003EPortfolio with call option:\u003C/h3\u003E\u003C/span\u003E"}, "type": "data"}]}, {"code_hash": "39377ca1b3c37b02d05257931a141c0e", "console": [], "id": "wlCL", "outputs": [{"data": {"text/markdown": "\u003Cspan class=\"markdown prose dark:prose-invert contents\"\u003E\u003Cspan class=\"paragraph\"\u003EThis model involves modifying the initial and the final budget constraints, adding a constraint on the new utility, creating a new objective (the option price) and re-optimizing the previous model. Fusion allows re-optimizing (this saves a considerable amount of time, which would otherwise be spent in re-building the model).\u003C/span\u003E\u003C/span\u003E"}, "type": "data"}]}, {"code_hash": "f3925182f45e85195e7504e5cceadd9e", "console": [], "id": "kqZH", "outputs": [{"data": {"text/plain": ""}, "type": "data"}]}, {"code_hash": "a10b063476c1d4789dbf7bb2d68840fd", "console": [], "id": "wAgl", "outputs": [{"data": {"text/markdown": "\u003Cspan class=\"markdown prose dark:prose-invert contents\"\u003E\u003Cspan class=\"paragraph\"\u003ENow, to demonstrate the model, we solve it for two simple cases. The values taken below are the same as mentioned in the paper (\u003Ca href=\"https://www.sciencedirect.com/science/article/pii/S0168927498001044\"\u003EAndersen et. al.\u003C/a\u003E).\u003C/span\u003E\u003C/span\u003E"}, "type": "data"}]}, {"code_hash": "1f4d6e981f20d261908f59347743bb26", "console": [{"mimetype": "text/plain", "name": "stdout", "text": "Problem\n  Name                   : PORTFOLIO       \n  Objective sense        : maximize        \n  Type                   : CONIC (conic optimization problem)\n  Constraints            : 607             \n  Affine conic cons.     : 606 (1455 rows)\n  Disjunctive cons.      : 0               \n  Cones                  : 0               \n  Scalar variables       : 1092            \n  Matrix variables       : 0               \n  Integer variables      : 0               \n\nOptimizer started.\nPresolve started.\nLinear dependency checker started.\nLinear dependency checker terminated.\nEliminator started.\nFreed constraints in eliminator : 154\nEliminator terminated.\nEliminator started.\nFreed constraints in eliminator : 0\nEliminator terminated.\nEliminator - tries                  : 2                 time                   : 0.00            \nLin. dep.  - tries                  : 1                 time                   : 0.00            \nLin. dep.  - primal attempts        : 1                 successes              : 1               \nLin. dep.  - dual attempts          : 0                 successes              : 0               \nLin. dep.  - primal deps.           : 0                 dual deps.             : 0               \nPresolve terminated. Time: 0.00    \nOptimizer  - threads                : 32              \nOptimizer  - solved problem         : the primal      \nOptimizer  - Constraints            : 492             \nOptimizer  - Cones                  : 607             \nOptimizer  - Scalar variables       : 1464              conic                  : 1463            \nOptimizer  - Semi-definite variables: 0                 scalarized             : 0               \nFactor     - setup time             : 0.00            \nFactor     - dense det. time        : 0.00              GP order time          : 0.00            \nFactor     - nonzeros before factor : 5542              after factor           : 5542            \nFactor     - dense dim.             : 0                 flops                  : 2.23e+05        \nITE PFEAS    DFEAS    GFEAS    PRSTATUS   POBJ              DOBJ              MU       TIME  \n0   1.0e+00  1.1e+00  3.2e+02  0.00e+00   -0.000000000e+00  3.168332369e+02   1.0e+00  0.01  \n1   2.0e-01  2.3e-01  2.3e+01  1.57e+00   8.248141497e-01   4.845767624e+01   2.0e-01  0.01  \n2   8.3e-03  9.5e-03  2.1e-01  1.19e+00   1.022072549e+00   2.835112736e+00   8.3e-03  0.01  \n3   5.9e-03  6.7e-03  1.4e-01  5.43e-01   1.360762644e+00   2.834893058e+00   5.9e-03  0.01  \n4   4.0e-03  4.5e-03  8.4e-02  4.98e-01   1.720332461e+00   2.867097762e+00   4.0e-03  0.02  \n5   7.1e-04  8.1e-04  5.1e-03  8.32e-01   2.441776955e+00   2.658301860e+00   7.1e-04  0.02  \n6   1.4e-04  1.6e-04  4.5e-04  9.24e-01   2.552914834e+00   2.597063756e+00   1.4e-04  0.02  \n7   2.1e-05  2.3e-05  2.9e-05  1.01e+00   2.579272227e+00   2.585658886e+00   2.1e-05  0.02  \n8   1.6e-05  1.9e-05  2.2e-05  7.57e-01   2.581255419e+00   2.586735992e+00   1.6e-05  0.02  \n9   8.0e-06  9.1e-06  8.7e-06  7.11e-01   2.585607275e+00   2.588735052e+00   8.0e-06  0.02  \n10  3.3e-06  3.7e-06  2.8e-06  6.82e-01   2.589152183e+00   2.590701035e+00   3.3e-06  0.02  \n11  1.7e-06  1.9e-06  1.1e-06  5.84e-01   2.591176033e+00   2.592087555e+00   1.7e-06  0.02  \n12  6.3e-07  7.2e-07  2.7e-07  7.70e-01   2.592662811e+00   2.593031641e+00   6.3e-07  0.03  \n13  4.5e-08  5.1e-08  5.3e-09  9.17e-01   2.593599329e+00   2.593626581e+00   4.5e-08  0.03  \n14  1.8e-10  2.0e-10  1.2e-12  1.00e+00   2.593675234e+00   2.593675342e+00   1.8e-10  0.03  \n15  1.1e-08  3.8e-11  1.0e-13  1.00e+00   2.593675519e+00   2.593675540e+00   3.3e-11  0.03  \nOptimizer terminated. Time: 0.03    \n\n\nInterior-point solution summary\n  Problem status  : PRIMAL_AND_DUAL_FEASIBLE\n  Solution status : OPTIMAL\n  Primal.  obj: 2.5936755193e+00    nrm: 6e+00    Viol.  con: 8e-08    var: 0e+00    acc: 1e-09  \n  Dual.    obj: 2.5936755573e+00    nrm: 2e-01    Viol.  con: 2e-13    var: 6e-11    acc: 0e+00  \nProblem\n  Name                   : PORTFOLIO       \n  Objective sense        : maximize        \n  Type                   : CONIC (conic optimization problem)\n  Constraints            : 608             \n  Affine conic cons.     : 606 (1455 rows)\n  Disjunctive cons.      : 0               \n  Cones                  : 0               \n  Scalar variables       : 1093            \n  Matrix variables       : 0               \n  Integer variables      : 0               \n\nOptimizer started.\nOptimizer terminated. Time: 0.03    \n\n\nInterior-point solution summary\n  Problem status  : PRIMAL_AND_DUAL_FEASIBLE\n  Solution status : OPTIMAL\n  Primal.  obj: 5.3868221761e-02    nrm: 6e+00    Viol.  con: 2e-06    var: 0e+00    acc: 2e-07  \n  Dual.    obj: 5.3868222579e-02    nrm: 1e+01    Viol.  con: 9e-14    var: 1e-12    acc: 0e+00  \n\n\nCall option price = 0.05386822176132122\n", "type": "stream"}], "id": "rEll", "outputs": [{"data": {"text/plain": ""}, "type": "data"}]}, {"code_hash": "815bd804a627466cd3ffb1e3d2a90e7f", "console": [{"mimetype": "text/plain", "name": "stdout", "text": "Problem\n  Name                   : PORTFOLIO       \n  Objective sense        : maximize        \n  Type                   : CONIC (conic optimization problem)\n  Constraints            : 364             \n  Affine conic cons.     : 606 (1455 rows)\n  Disjunctive cons.      : 0               \n  Cones                  : 0               \n  Scalar variables       : 1092            \n  Matrix variables       : 0               \n  Integer variables      : 0               \n\nOptimizer started.\nPresolve started.\nLinear dependency checker started.\nLinear dependency checker terminated.\nEliminator started.\nFreed constraints in eliminator : 154\nEliminator terminated.\nEliminator started.\nFreed constraints in eliminator : 0\nEliminator terminated.\nEliminator - tries                  : 2                 time                   : 0.00            \nLin. dep.  - tries                  : 1                 time                   : 0.00            \nLin. dep.  - primal attempts        : 1                 successes              : 1               \nLin. dep.  - dual attempts          : 0                 successes              : 0               \nLin. dep.  - primal deps.           : 0                 dual deps.             : 0               \nPresolve terminated. Time: 0.00    \nOptimizer  - threads                : 32              \nOptimizer  - solved problem         : the primal      \nOptimizer  - Constraints            : 492             \nOptimizer  - Cones                  : 607             \nOptimizer  - Scalar variables       : 1464              conic                  : 1463            \nOptimizer  - Semi-definite variables: 0                 scalarized             : 0               \nFactor     - setup time             : 0.00            \nFactor     - dense det. time        : 0.00              GP order time          : 0.00            \nFactor     - nonzeros before factor : 5542              after factor           : 5542            \nFactor     - dense dim.             : 0                 flops                  : 2.23e+05        \nITE PFEAS    DFEAS    GFEAS    PRSTATUS   POBJ              DOBJ              MU       TIME  \n0   5.2e-01  1.3e+00  2.0e+02  0.00e+00   -1.454638549e+00  2.006397864e+02   1.0e+00  0.01  \n1   3.5e-01  8.6e-01  1.2e+02  6.17e-01   -2.109789934e+00  1.432114744e+02   6.8e-01  0.01  \n2   1.0e-01  2.5e-01  1.8e+01  7.75e-01   -3.758631159e+00  4.112628612e+01   2.0e-01  0.01  \n3   1.0e-02  2.5e-02  3.8e-01  1.08e+00   -3.380715125e+00  6.766783378e-01   2.0e-02  0.01  \n4   1.5e-03  3.7e-03  1.6e-02  1.63e+00   4.242857232e-01   8.526600531e-01   2.9e-03  0.01  \n5   2.7e-04  6.7e-04  1.2e-03  1.13e+00   8.337277231e-01   9.063537390e-01   5.3e-04  0.01  \n6   6.7e-05  1.6e-04  1.8e-04  1.03e+00   9.023620185e-01   9.201590373e-01   1.3e-04  0.01  \n7   4.7e-05  1.2e-04  1.2e-04  5.97e-01   9.099633158e-01   9.248156129e-01   9.2e-05  0.01  \n8   2.8e-05  7.0e-05  6.6e-05  5.25e-01   9.194841890e-01   9.299442881e-01   5.5e-05  0.01  \n9   7.8e-06  1.9e-05  1.3e-05  5.78e-01   9.341496224e-01   9.378417766e-01   1.5e-05  0.01  \n10  2.8e-06  6.9e-06  3.8e-06  3.49e-01   9.443654532e-01   9.461947762e-01   5.4e-06  0.01  \n11  1.1e-06  2.8e-06  1.0e-06  7.73e-01   9.485007825e-01   9.492920338e-01   2.2e-06  0.01  \n12  2.4e-07  6.0e-07  1.1e-07  9.29e-01   9.508590761e-01   9.510334121e-01   4.7e-07  0.01  \n13  5.8e-09  1.4e-08  4.1e-10  9.82e-01   9.515581553e-01   9.515623194e-01   1.1e-08  0.02  \n14  4.2e-10  1.0e-09  7.9e-12  1.00e+00   9.515740625e-01   9.515743632e-01   8.0e-10  0.02  \n15  2.2e-09  1.3e-10  3.7e-13  1.00e+00   9.515751406e-01   9.515751800e-01   1.0e-10  0.02  \nOptimizer terminated. Time: 0.02    \n\n\nInterior-point solution summary\n  Problem status  : PRIMAL_AND_DUAL_FEASIBLE\n  Solution status : OPTIMAL\n  Primal.  obj: 9.5157514063e-01    nrm: 6e+00    Viol.  con: 3e-09    var: 0e+00    acc: 0e+00  \n  Dual.    obj: 9.5157524023e-01    nrm: 8e-01    Viol.  con: 6e-14    var: 2e-10    acc: 0e+00  \nProblem\n  Name                   : PORTFOLIO       \n  Objective sense        : maximize        \n  Type                   : CONIC (conic optimization problem)\n  Constraints            : 365             \n  Affine conic cons.     : 606 (1455 rows)\n  Disjunctive cons.      : 0               \n  Cones                  : 0               \n  Scalar variables       : 1093            \n  Matrix variables       : 0               \n  Integer variables      : 0               \n\nOptimizer started.\nOptimizer terminated. Time: 0.02    \n\n\nInterior-point solution summary\n  Problem status  : PRIMAL_AND_DUAL_FEASIBLE\n  Solution status : OPTIMAL\n  Primal.  obj: 5.3526714776e-02    nrm: 6e+00    Viol.  con: 1e-07    var: 0e+00    acc: 4e-08  \n  Dual.    obj: 5.3526716809e-02    nrm: 1e+00    Viol.  con: 3e-14    var: 4e-12    acc: 0e+00  \n\n\nCall option price = 0.05352671477620865\n", "type": "stream"}], "id": "dGlV", "outputs": [{"data": {"text/plain": ""}, "type": "data"}]}, {"code_hash": "226b9042a0ada127db3dd554d5e4f271", "console": [], "id": "SdmI", "outputs": [{"data": {"text/markdown": "\u003Cspan class=\"markdown prose dark:prose-invert contents\"\u003E\u003Ch1 id=\"test-cases\"\u003ETest-cases:\u003C/h1\u003E\u003C/span\u003E"}, "type": "data"}]}, {"code_hash": "7f640dcc4bf32a5f7be5d9f4f3d58e0a", "console": [], "id": "lgWD", "outputs": [{"data": {"text/markdown": "\u003Cspan class=\"markdown prose dark:prose-invert contents\"\u003E\u003Ch3 id=\"reservation-price-sensitivity-for-the-choice-of-utility-function\"\u003EReservation price sensitivity for the choice of utility function:\u003C/h3\u003E\u003C/span\u003E"}, "type": "data"}]}, {"code_hash": "8a31d9cfefe366de4b835dd183df9107", "console": [], "id": "yOPj", "outputs": [{"data": {"text/markdown": "\u003Cspan class=\"markdown prose dark:prose-invert contents\"\u003E\u003Cspan class=\"paragraph\"\u003E\u003Cb\u003E(a.) Dependency of the reservation purchase price on \u003Cmarimo-tex class=\"arithmatex\"\u003E||(\\gamma||)\u003C/marimo-tex\u003E, \u003Cmarimo-tex class=\"arithmatex\"\u003E||(ARA(W_0)||)\u003C/marimo-tex\u003E and \u003Cmarimo-tex class=\"arithmatex\"\u003E||(\\overline{T}||)\u003C/marimo-tex\u003E.\u003C/b\u003E (Consider Table 3, \u003Ca href=\"https://www.sciencedirect.com/science/article/pii/S0168927498001044\"\u003EAndersen et. al.\u003C/a\u003E)\u003C/span\u003E\u003C/span\u003E"}, "type": "data"}]}, {"code_hash": "844932a5daccf22ca83d512581e6a1aa", "console": [{"mimetype": "text/plain", "name": "stdout", "text": "ARA = 0.2 ; Time Horizon = 1/4 year\ngamma       C    \n-4.0   0.0535762\n-2.0   0.0536112\n-0.9   0.0536810\n-0.3   0.0537272\n 0.3   0.0538682\n 0.6   0.0541304\n exp   0.0535267\n", "type": "stream"}], "id": "fwwy", "outputs": [{"data": {"text/plain": ""}, "type": "data"}]}, {"code_hash": "378ed80881fb58b031d5a1ea8adbd899", "console": [{"mimetype": "text/plain", "name": "stdout", "text": "ARA = 1.0 ; Time Horizon = 1/4 year\ngamma       C    \n-4.0   0.0533258\n-2.0   0.0533598\n-0.9   0.0534038\n-0.3   0.0534565\n exp   0.0532800\n", "type": "stream"}], "id": "LJZf", "outputs": [{"data": {"text/plain": ""}, "type": "data"}]}, {"code_hash": "defd0a40bea8529bffd7d39dd1433c6f", "console": [{"mimetype": "text/plain", "name": "stdout", "text": "ARA = 0.2 ; Time Horizon = 9 years\ngamma       C    \n-4.0   0.4181738\n-2.0   0.4182255\n-0.9   0.4181908\n-0.3   0.4181755\n 0.3   0.4181516\n 0.6   0.4128493\n exp   0.4181519\n", "type": "stream"}], "id": "urSm", "outputs": [{"data": {"text/plain": ""}, "type": "data"}]}, {"code_hash": "41415f2f70827cc951ee36c3ab28b6d3", "console": [{"mimetype": "text/plain", "name": "stdout", "text": "ARA = 1.0 ; Time Horizon = 9 years\ngamma       C    \n-4.0   0.4181591\n-2.0   0.4181625\n-0.9   0.4182211\n-0.3   0.4181503\n exp   0.4176739\n", "type": "stream"}], "id": "jxvo", "outputs": [{"data": {"text/plain": ""}, "type": "data"}]}, {"code_hash": "fa8709fa6d64ee190161f1cbaf7d9fd5", "console": [], "id": "mWxS", "outputs": [{"data": {"text/markdown": "\u003Cspan class=\"markdown prose dark:prose-invert contents\"\u003E\u003Cspan class=\"paragraph\"\u003E\u003Cb\u003E(b.) Dependency of the reservation purchase price on the initial level of Relative Risk Aversion, \u003Cmarimo-tex class=\"arithmatex\"\u003E||(RRA(W_0)||)\u003C/marimo-tex\u003E\u003C/b\u003E (Consider Table 4, \u003Ca href=\"https://www.sciencedirect.com/science/article/pii/S0168927498001044\"\u003EAndersen et. al.\u003C/a\u003E)\u003C/span\u003E\u003C/span\u003E"}, "type": "data"}]}, {"code_hash": "1a64b800a123a3a4574e17f9b5f79f35", "console": [{"mimetype": "text/plain", "name": "stdout", "text": "ARA = 0.2 ; Time Horizon = 1/4 year\n W_0    RRA       C    \n  1     0.2   0.0537152\n  4     0.8   0.0536544\n  8     1.6   0.0537686\n exp          0.0535267\n", "type": "stream"}], "id": "CcZR", "outputs": [{"data": {"text/plain": ""}, "type": "data"}]}, {"code_hash": "89395266de80d1195e23f57f86e6e6ed", "console": [{"mimetype": "text/plain", "name": "stdout", "text": "ARA = 0.2 ; Time Horizon = 9 years\n W_0    RRA       C    \n  1     0.2   0.4182293\n  4     0.8   0.4182071\n  8     1.6   0.4181984\n exp          0.4181519\n", "type": "stream"}], "id": "YWSi", "outputs": [{"data": {"text/plain": ""}, "type": "data"}]}, {"code_hash": "23958c65cf9a0082b31b2536079bbd82", "console": [], "id": "zlud", "outputs": [{"data": {"text/markdown": "\u003Cspan class=\"markdown prose dark:prose-invert contents\"\u003E\u003Cspan class=\"paragraph\"\u003E\u003Cb\u003E(c.) Convergence of the reservation purchase price.\u003C/b\u003E (Consider Table 5, \u003Ca href=\"https://www.sciencedirect.com/science/article/pii/S0168927498001044\"\u003EAndersen et. al.\u003C/a\u003E)\u003C/span\u003E\u003C/span\u003E"}, "type": "data"}]}, {"code_hash": "b450e4c2d08f000aae7e5747f14b13ae", "console": [{"mimetype": "text/plain", "name": "stdout", "text": "     -exp(-0.7W)   (W^0.3)/0.3               \n T      C_exp         C_pow          CRR     \n 1   0.0513874554  0.0513874714  0.0429986622\n 2   0.0566847075  0.0568627584  0.0498154961\n 3   0.0533733658  0.0536936606  0.0471563512\n 4   0.0491337364  0.0494956699  0.0429545588\n 5   0.0533720158  0.0537070260  0.0471967099\n 6   0.0533762999  0.0537372978  0.0473670389\n 7   0.0509534659  0.0513439232  0.0450257258\n 8   0.0524868316  0.0528617761  0.0465172792\n 9   0.0531665680  0.0535464978  0.0472606066\n10   0.0519293959  0.0523270236  0.0460868655\n11   0.0520640871  0.0524579433  0.0462000116\n", "type": "stream"}], "id": "tZnO", "outputs": [{"data": {"text/plain": ""}, "type": "data"}]}, {"code_hash": "769695a6e2d9aa219bd353b2c07a696c", "console": [], "id": "xvXZ", "outputs": [{"data": {"text/markdown": "\u003Cspan class=\"markdown prose dark:prose-invert contents\"\u003E\u003Cspan class=\"paragraph\"\u003E\u003Cb\u003E(d.) Reservation purchase price dependence on absolute risk aversion (Exponential utility).\u003C/b\u003E (Consider Table 6, \u003Ca href=\"https://www.sciencedirect.com/science/article/pii/S0168927498001044\"\u003EAndersen et. al.\u003C/a\u003E)\u003C/span\u003E\u003C/span\u003E"}, "type": "data"}]}, {"code_hash": "06e4aaf81502b2d6d073f86917fdabf0", "console": [{"mimetype": "text/plain", "name": "stdout", "text": "ARA(W_0)  C[ARA(W_0)] \n  0.10    0.0533772170\n  0.20    0.0533414059\n  0.40    0.0532712965\n  0.80    0.0531318709\n  1.00    0.0530625244\n  2.00    0.0527034446\n  4.00    0.0503788299\n", "type": "stream"}], "id": "CLip", "outputs": [{"data": {"text/plain": ""}, "type": "data"}]}, {"code_hash": "02e79effd899f2dca5c765bdd44e9f2d", "console": [], "id": "YECM", "outputs": [{"data": {"text/markdown": "\u003Cspan class=\"markdown prose dark:prose-invert contents\"\u003E\u003Cspan class=\"paragraph\"\u003E\u003Cb\u003E(e.) Reservation purchase price dependence on absolute risk aversion (Power utility).\u003C/b\u003E (Consider Table 7, \u003Ca href=\"https://www.sciencedirect.com/science/article/pii/S0168927498001044\"\u003EAndersen et. al.\u003C/a\u003E)\u003C/span\u003E\u003C/span\u003E"}, "type": "data"}]}, {"code_hash": "03d677a8351b2090be3dee126a9a1ac8", "console": [{"mimetype": "text/plain", "name": "stdout", "text": " eta   C[ARA(W_0)] \n0.10   0.0550906629\n0.20   0.0545760252\n0.30   0.0542082809\n0.40   0.0539549630\n0.50   0.0537752464\n0.60   0.0536467216\n0.70   0.0535464838\n0.80   0.0534634768\n0.90   0.0533917148\n", "type": "stream"}], "id": "cEAS", "outputs": [{"data": {"text/plain": ""}, "type": "data"}]}, {"code_hash": "dde475df8dafea357df0432568446399", "console": [], "id": "iXej", "outputs": [{"data": {"text/markdown": "\u003Cspan class=\"markdown prose dark:prose-invert contents\"\u003E\u003Cspan class=\"paragraph\"\u003E\u003Cb\u003E(f.) Reservation purchase price dependence on initial wealth (Power utility with \u003Cmarimo-tex class=\"arithmatex\"\u003E||(\\eta = 0.7||)\u003C/marimo-tex\u003E).\u003C/b\u003E (Consider Table 8, \u003Ca href=\"https://www.sciencedirect.com/science/article/pii/S0168927498001044\"\u003EAndersen et. al.\u003C/a\u003E)\u003C/span\u003E\u003C/span\u003E"}, "type": "data"}]}, {"code_hash": "3bd85754d56f70f45c3eae07ea62940f", "console": [{"mimetype": "text/plain", "name": "stdout", "text": " W_0    C_pow(W_0) \n0.25   0.0525390182\n0.50   0.0532969990\n1.00   0.0535465413\n2.00   0.0536743343\n4.00   0.0537394841\n8.00   0.0537718408\n", "type": "stream"}], "id": "EJmg", "outputs": [{"data": {"text/plain": ""}, "type": "data"}]}, {"code_hash": "24043bdae6f5088e365a63e0a02b6219", "console": [], "id": "UmEG", "outputs": [{"data": {"text/markdown": "\u003Cspan class=\"markdown prose dark:prose-invert contents\"\u003E\u003Ch3 id=\"the-effect-of-diversification-opportunities-on-the-reservation-purchase-price\"\u003EThe effect of diversification opportunities on the reservation purchase price.\u003C/h3\u003E\u003C/span\u003E"}, "type": "data"}]}, {"code_hash": "8d4251f1f5fb92dc8f7df155cbcf611a", "console": [], "id": "vEBW", "outputs": [{"data": {"text/markdown": "\u003Cspan class=\"markdown prose dark:prose-invert contents\"\u003E\u003Cspan class=\"paragraph\"\u003EThe model presented above is fairly general, and therefore we can easily extend its application to the case where trade takes place in multiple securities. For illustration, we present the case where there are two risky securities, following \u003Ca href=\"https://www.sciencedirect.com/science/article/pii/S0168927498001044\"\u003EAndersen et. al.\u003C/a\u003E. For this example, we have:\u003C/span\u003E\n\u003Cmarimo-tex class=\"arithmatex\"\u003E||[\n\\sigma^{T} = \\begin{pmatrix}\n\\sigma_{11}\\, ,\\,\\sigma_{21} \\\\\n\\sigma_{12}\\, ,\\,\\sigma_{22} \\\\\n\\end{pmatrix} = \\begin{pmatrix}\n\\sigma_{11}\\, ,\\, 0.2\\rho\\\\\n0.0\\, , \\, \\sqrt{(0.2)^2 - \\sigma_{21}^2} \\\\\n\\end{pmatrix}\n||]\u003C/marimo-tex\u003E\u003Cspan class=\"paragraph\"\u003Ewhere \u003Cmarimo-tex class=\"arithmatex\"\u003E||(\\rho||)\u003C/marimo-tex\u003E is the correlation between logarithms of the two securities. The \u003Cmarimo-tex class=\"arithmatex\"\u003E||(\\epsilon||)\u003C/marimo-tex\u003E matrix is given by,\u003C/span\u003E\n\u003Cmarimo-tex class=\"arithmatex\"\u003E||[\\epsilon = \\begin{pmatrix}\n\\epsilon_1 (\\omega_1),\\epsilon_2 (\\omega_1) \\\\\n\\epsilon_1 (\\omega_2),\\epsilon_2 (\\omega_2) \\\\\n\\epsilon_1 (\\omega_3),\\epsilon_2 (\\omega_3)\n\\end{pmatrix} = \\begin{pmatrix}\n\\sqrt{2}\\,\\,,\\,\\,0 \\\\\n-1/\\sqrt{2},\\sqrt{3/2} \\\\\n-1/\\sqrt{2},\\sqrt{3/2}\n\\end{pmatrix}\n||]\u003C/marimo-tex\u003E\u003C/span\u003E"}, "type": "data"}]}, {"code_hash": "4c9265ae30364c72c16462ee68b4a913", "console": [], "id": "kLmu", "outputs": [{"data": {"text/markdown": "\u003Cspan class=\"markdown prose dark:prose-invert contents\"\u003E\u003Cspan class=\"paragraph\"\u003EMoreover, we will consider different values for the transaction costs. There are three situations considered below: completely frictionless market, friction in one security, friction in both securities.\u003C/span\u003E\n\u003Cspan class=\"paragraph\"\u003E\u003Cb\u003ENote\u003C/b\u003E: In the code, we use the transpose of the sigma matrix, hence the shapes of the arrays that represent \u003Cmarimo-tex class=\"arithmatex\"\u003E||(\\sigma||)\u003C/marimo-tex\u003E and \u003Cmarimo-tex class=\"arithmatex\"\u003E||(\\epsilon||)\u003C/marimo-tex\u003E must be maintained similar to what is shown in the code below.\u003C/span\u003E\u003C/span\u003E"}, "type": "data"}]}, {"code_hash": "3514f7f12f9d65e4250ed05188f8b50b", "console": [], "id": "IpqN", "outputs": [{"data": {"text/markdown": "\u003Cspan class=\"markdown prose dark:prose-invert contents\"\u003E\u003Cspan class=\"paragraph\"\u003E\u003Cb\u003E(g.) Reservation purchase price of a call option for T=9 as a function of \u003Cmarimo-tex class=\"arithmatex\"\u003E||(\\rho||)\u003C/marimo-tex\u003E and \u003Cmarimo-tex class=\"arithmatex\"\u003E||(\\theta_i||)\u003C/marimo-tex\u003E in the presence of two risky securities.\u003C/b\u003E (Consider Table 10, \u003Ca href=\"https://www.sciencedirect.com/science/article/pii/S0168927498001044\"\u003EAndersen et. al.\u003C/a\u003E)\u003C/span\u003E\u003C/span\u003E"}, "type": "data"}]}, {"code_hash": "45499e470d8a872f42ba1f159de89e54", "console": [{"mimetype": "text/plain", "name": "stdout", "text": "theta_1 = 0.000 ; theta_2 = 0.000\n rho     C(S1,S2)  \n 1.0  0.0472606484\n 0.5  0.0472606399\n 0.0  0.0472606435\n-0.5  0.0472606471\n-0.9  0.0472605875\n", "type": "stream"}], "id": "dxZZ", "outputs": [{"data": {"text/plain": ""}, "type": "data"}]}, {"code_hash": "adffca033bdd12860e966740f19f367d", "console": [{"mimetype": "text/plain", "name": "stdout", "text": "theta_1 = 0.005 ; theta_2 = 0.000\n rho     C(S1,S2)  \n 1.00  0.0472605854\n 0.50  0.0535487335\n 0.00  0.0533470826\n-0.50  0.0531701190\n-0.90  0.0530337682\n", "type": "stream"}], "id": "dlnW", "outputs": [{"data": {"text/plain": ""}, "type": "data"}]}, {"code_hash": "0e4fcac2c49cd090ec248e5f2f0458e9", "console": [{"mimetype": "text/plain", "name": "stdout", "text": "theta_1 = 0.005 ; theta_2 = 0.005\n rho     C(S1,S2)  \n 1.00  0.0533413596\n 0.50  0.0533757243\n 0.00  0.0533420568\n-0.50  0.0530758552\n-0.90  0.0519971075\n", "type": "stream"}], "id": "TTti", "outputs": [{"data": {"text/plain": ""}, "type": "data"}]}, {"code_hash": "b9231ae33809da2ac021dff013f74830", "console": [], "id": "RKFZ", "outputs": [{"data": {"text/markdown": "\u003Cspan class=\"markdown prose dark:prose-invert contents\"\u003E\u003Cspan class=\"paragraph\"\u003E\u003Cb\u003E(h.) Reservation purchase price of a call option for T=9, as a function of \u003Cmarimo-tex class=\"arithmatex\"\u003E||(\\theta_i||)\u003C/marimo-tex\u003E, in the case of two risky securities; \u003Cmarimo-tex class=\"arithmatex\"\u003E||(\\rho = -0.9||)\u003C/marimo-tex\u003E.\u003C/b\u003E (Consider Table 11, \u003Ca href=\"https://www.sciencedirect.com/science/article/pii/S0168927498001044\"\u003EAndersen et. al.\u003C/a\u003E)\u003C/span\u003E\u003C/span\u003E"}, "type": "data"}]}, {"code_hash": "d00fe31d9c906e500c5af9cd7be504be", "console": [{"mimetype": "text/plain", "name": "stdout", "text": "theta    C(S1,S2)  \n0.0008  0.0477318040\n0.0016  0.0483915963\n0.0030  0.0497603537\n0.0060  0.0532557955\n0.0100  0.0595916650\n0.0200  0.0618326732\n0.0500  0.0618325718\n0.1000  0.0618325885\n", "type": "stream"}], "id": "IaQp", "outputs": [{"data": {"text/plain": ""}, "type": "data"}]}, {"code_hash": "f3cfda319489e0a06c5a2d122856f763", "console": [], "id": "IWgg", "outputs": [{"data": {"text/markdown": "\u003Cspan class=\"markdown prose dark:prose-invert contents\"\u003E\u003Cspan class=\"paragraph\"\u003E\u003Cb\u003E(i.) Computational efficiency for different values of T (time periods).\u003C/b\u003E (Consider Table 12, \u003Ca href=\"https://www.sciencedirect.com/science/article/pii/S0168927498001044\"\u003EAndersen et. al.\u003C/a\u003E)\u003C/span\u003E\u003C/span\u003E"}, "type": "data"}]}, {"code_hash": "30543d8afad6653cb6d762e4067a2ad3", "console": [], "id": "fCoF", "outputs": [{"data": {"text/markdown": "\u003Cspan class=\"markdown prose dark:prose-invert contents\"\u003E\u003Cspan class=\"paragraph\"\u003EThe columns of the output table in the following cell denote: T (time periods), cons. (number of constraints), vars. (number of variables), it. (number of iterations for the \u003Ci\u003Eno-option\u003C/i\u003E model as well as the \u003Ci\u003Eoption-price\u003C/i\u003E model), time. (time taken, in seconds for both models).\u003C/span\u003E\u003C/span\u003E"}, "type": "data"}]}, {"code_hash": "3bf857efdb061a9a681217d07c444116", "console": [{"mimetype": "text/plain", "name": "stdout", "text": "                           No-option   Option-price\n T     cons.       vars.  it.   time   it.   time \n 1         5          17    8   0.002    9   0.001\n 2        14          56    7   0.001    9   0.001\n 3        41         173    8   0.003   10   0.003\n 4       122         524   14   0.011   20   0.015\n 5       365        1577   18   0.040   22   0.045\n 6      1094        4736   22   0.170   22   0.115\n 7      3281       14213   25   0.543   25   0.434\n 8      9842       42644   29   1.955   29   1.373\n 9     29525      127937   39   9.263   32   5.237\n", "type": "stream"}], "id": "LkGn", "outputs": [{"data": {"text/plain": ""}, "type": "data"}]}, {"code_hash": "30caa2aa26809eb2978ccb7d5db28435", "console": [], "id": "zVRe", "outputs": [{"data": {"text/markdown": "\u003Cspan class=\"markdown prose dark:prose-invert contents\"\u003E\u003Cspan class=\"paragraph\"\u003EThe calculations shown above were performed on a desktop with 15.6 GB of RAM and an Intel\u003Cmarimo-tex class=\"arithmatex\"\u003E||(^\\circledR||)\u003C/marimo-tex\u003E Core\u003Cmarimo-tex class=\"arithmatex\"\u003E||(^{\\text{TM}}||)\u003C/marimo-tex\u003E i7-6770HQ CPU @ 2.6 GHz \u003Cmarimo-tex class=\"arithmatex\"\u003E||(\\times||)\u003C/marimo-tex\u003E 8.\u003C/span\u003E\u003C/span\u003E"}, "type": "data"}]}, {"code_hash": "1457d7ea0ad46d737c6d62314b6b464a", "console": [], "id": "woaO", "outputs": [{"data": {"text/markdown": "\u003Cspan class=\"markdown prose dark:prose-invert contents\"\u003E\u003Cspan class=\"paragraph\"\u003E\u003Ca rel=\"license\" href=\"http://creativecommons.org/licenses/by/4.0/\"\u003E\u003Cimg alt=\"Creative Commons License\" style=\"border-width:0\" src=\"https://i.creativecommons.org/l/by/4.0/80x15.png\" /\u003E\u003C/a\u003E\u003Cbr /\u003EThis work is licensed under a \u003Ca rel=\"license\" href=\"http://creativecommons.org/licenses/by/4.0/\"\u003ECreative Commons Attribution 4.0 International License\u003C/a\u003E. The \u003Cstrong\u003EMOSEK\u003C/strong\u003E logo and name are trademarks of \u003Ca href=\"http://mosek.com\"\u003EMosek ApS\u003C/a\u003E. The code is provided as-is. Compatibility with future release of \u003Cstrong\u003EMOSEK\u003C/strong\u003E or the \u003Ccode\u003EFusion API\u003C/code\u003E are not guaranteed. For more information contact our \u003Ca href=\"mailto:support@mosek.com\"\u003Esupport\u003C/a\u003E.\u003C/span\u003E\u003C/span\u003E"}, "type": "data"}]}, {"code_hash": "1d0db38904205bec4d6f6f6a1f6cec3e", "console": [], "id": "HnMC", "outputs": [{"data": {"text/plain": ""}, "type": "data"}]}], "metadata": {"marimo_version": "0.18.4"}, "version": "1"},
            "runtimeConfig": null,
        };
    </script>
  
<marimo-code hidden="">
    import%20marimo%0A%0A__generated_with%20%3D%20%220.18.4%22%0Aapp%20%3D%20marimo.App()%0A%0A%0A%40app.cell(hide_code%3DTrue)%0Adef%20_(mo)%3A%0A%20%20%20%20mo.md(r%22%22%22%0A%20%20%20%20!%5BMOSEK%20ApS%5D(https%3A%2F%2Fwww.mosek.com%2Fstatic%2Fimages%2Fbranding%2Fwebgraphmoseklogocolor.png%20)%0A%20%20%20%20%22%22%22)%0A%20%20%20%20return%0A%0A%0A%40app.cell(hide_code%3DTrue)%0Adef%20_(mo)%3A%0A%20%20%20%20mo.md(r%22%22%22%0A%20%20%20%20%23%20Utility%20based%20option%20pricing%20with%20transaction%20costs%20and%20diversification%0A%20%20%20%20%22%22%22)%0A%20%20%20%20return%0A%0A%0A%40app.cell(hide_code%3DTrue)%0Adef%20_(mo)%3A%0A%20%20%20%20mo.md(r%22%22%22%0A%20%20%20%20In%20this%20notebook%2C%20we%20present%20the%20%3Ci%3EFusion%3C%2Fi%3E%20implementation%20of%20the%20utility%20based%20option%20pricing%20model%2C%20presented%20by%20%5BAndersen%20et.%20al.%20(1999)%5D(https%3A%2F%2Fwww.sciencedirect.com%2Fscience%2Farticle%2Fpii%2FS0168927498001044).%20The%20purpose%20of%20the%20model%20is%20to%20estimate%20the%20reservation%20purchase%20price%20of%20a%20European%20call%20option%2C%20written%20on%20a%20risky%20security%20when%20there%20is%20proportional%20transaction%20costs%20in%20the%20market.%0A%20%20%20%20%22%22%22)%0A%20%20%20%20return%0A%0A%0A%40app.cell(hide_code%3DTrue)%0Adef%20_(mo)%3A%0A%20%20%20%20mo.md(r%22%22%22%0A%20%20%20%20%23%23%20The%20Model%0A%20%20%20%20%22%22%22)%0A%20%20%20%20return%0A%0A%0A%40app.cell(hide_code%3DTrue)%0Adef%20_(mo)%3A%0A%20%20%20%20mo.md(r%22%22%22%0A%20%20%20%20Consider%20an%20economy%20evolving%20over%20T%20periods%2C%20%24%7B0%2Ct_1%2Ct_2%2Ct_3%2C...%2Ct_T%20%3D%20%5Coverline%7BT%7D%7D%24%20where%20%24%5Coverline%7BT%7D%24%20is%20the%20time%20horizon%20in%20years.%20We%20consider%20that%20the%20investor%20has%20one%20risk-free%20security%2C%20such%20as%20a%20bond%2C%20that%20pays%20at%20a%20constant%20interest%20rate%20of%20%24r%5Cgeq%200%24%2C%20and%20%24m%24%20risky%20securities%20with%20price%20processes%20denoted%20by%20%24(S_1%2CS_2%2C...%2CS_m)%24.%20The%20price%20of%20the%20risky%20securities%20evolves%20in%20an%20event%20tree%20such%20that%3A%0A%0A%20%20%20%20%24%24(S_%7B1%2Cn%7D%2CS_%7B2%2Cn%7D%2C..%2CS_%7Bm%2Cn%7D)%20%3D%20%5Cbegin%7Bcases%7D%0A%20%20%20%20(a_1%20S_%7B1%2Cn-1%7D%2C%20a_2%20S_%7B2%2Cn-1%7D%2C..%2Ca_m%20S_%7Bm%2Cn-1%7D)%2C%20%5C%2C%5C%2C%20%5Ctext%7Bwith%20probability%20%7D%20q_1%2C%20%5C%5C%0A%20%20%20%20(b_1%20S_%7B1%2Cn-1%7D%2C%20b_2%20S_%7B2%2Cn-1%7D%2C..%2Cb_m%20S_%7Bm%2Cn-1%7D)%2C%20%5C%2C%5C%2C%20%5Ctext%7Bwith%20probability%20%7D%20q_2%2C%20%5C%5C%0A%20%20%20%20(c_1%20S_%7B1%2Cn-1%7D%2C%20c_2%20S_%7B2%2Cn-1%7D%2C..%2Cc_m%20S_%7Bm%2Cn-1%7D)%2C%20%5C%2C%5C%2C%20%5Ctext%7Bwith%20probability%20%7D%20q_3%20%3D%20(1-q_1-q_2)%0A%20%20%20%20%5Cend%7Bcases%7D%0A%20%20%20%20%24%24%0A%0A%0A%20%20%20%20where%20the%20three%20possibilities%20lead%20to%20an%20event%20tree%20of%20splitting%20index%203%20(In%20the%20fusion%20model%20presented%20below%2C%20we%20have%20considered%20a%20general%20case%20where%20one%20can%20have%20a%20different%20splitting%20index).%20The%20event%20tree%20for%20two%20risky%20securities%20can%20be%20visualized%20as%20shown%20in%20the%20figure%20below.%0A%20%20%20%20%22%22%22)%0A%20%20%20%20return%0A%0A%0A%40app.cell(hide_code%3DTrue)%0Adef%20_(mo)%3A%0A%20%20%20%20mo.md(r%22%22%22%0A%20%20%20%20Let%2C%20%24%5Cmathbf%7B%5Calpha_%7Bn%7D%7D%20%3D%20(%5Calpha_1%2C%5Calpha_2%2C...%2C%5Calpha_m)%24%20denote%20the%20number%20of%20units%20of%20the%20risky%20security%20held%20by%20the%20investor%20at%20time%20%24t_n%24%2C%20and%20%24%5Cbeta_n%24%20denote%20the%20dollar%20amount%20held%20by%20the%20investor%20in%20bonds%20at%20the%20same%20time.%20Then%2C%20the%20%3Ci%3E'budget%20constraint'%3C%2Fi%3E%20on%20the%20bonds%20an%20investor%20can%20buy%20in%20the%20next%20period%20is%20given%20by%3A%0A%0A%0A%20%20%20%20%24%24%5Cbeta_n(I_n)%20%5Cleq%20(1%2Br)%5Cbeta_%7Bn-1%7D(I_n)%20%2B%20%5Csum_%7Bi%3D1%7D%5E%7Bm%7D%20S_%7Bi%2Cn%7D(I_n)%5B%5Calpha_%7Bi%2Cn-1%7D(I_n)%20-%20%5Calpha_%7Bi%2Cn%7D(I_n)%20-%20%5Ctheta_i%20%7C%5Calpha_%7Bi%2Cn-1%7D(I_n)%20-%20%5Calpha_%7Bi%2Cn%7D(I_n)%7C%5D%24%24%0A%0A%0A%20%20%20%20where%20%24%5Ctheta_i%24%20is%20the%20transaction%20cost%20for%20trading%20of%20risky%20security%20%24i%24%20and%20%24I_n%24%20denotes%20the%20path%20being%20considered%20(in%20other%20words%2C%20the%20sequence%20of%20events%20in%20the%20event%20tree).%20The%20total%20number%20of%20paths%20possible%20for%20a%20tree%20of%20splitting%20index%20%24s%24%2C%20over%20%24n%24%20time%20periods%20is%20%24s%5En%24.%20Initially%2C%20if%20we%20consider%20that%20the%20wealth%20of%20the%20investor%20is%20%24W_0%24%2C%20then%20of%20course%20the%20first%20budget%20constraint%20becomes%3A%0A%0A%20%20%20%20%24%24%5Cbeta_0%20%5Cleq%20W_0%20-%20%5Csum_%7Bi%3D1%7D%5E%7Bm%7D%20S_%7Bi%2C0%7D%5B%5Calpha_%7Bi%2C0%7D%20%2B%20%7C%5Calpha_%7Bi%2C0%7D%7C%5D%24%24%0A%0A%0A%20%20%20%20Additionally%2C%20in%20the%20final%20period%20the%20investor%20will%20sell%20all%20of%20the%20risky%20securities%2C%20thus%20ending%20up%20with%20a%20wealth%20%24W_T(I_T)%24%20for%20path%20%24I_T%24%2C%20such%20that%3A%0A%0A%20%20%20%20%24%24W_T(I_T)%20%5Cleq%20(1%2Br)%5Cbeta_%7BT-1%7D(I_T)%20%2B%20%5Csum_%7Bi%3D1%7D%5E%7Bm%7D%20S_%7Bi%2CT%7D(I_T)%5B%5Calpha_%7Bi%2CT-1%7D(I_T)%20-%20%5Ctheta_i%20%7C%5Calpha_%7Bi%2CT-1%7D(I_T)%7C%5D%24%24%0A%20%20%20%20%22%22%22)%0A%20%20%20%20return%0A%0A%0A%40app.cell(hide_code%3DTrue)%0Adef%20_(mo)%3A%0A%20%20%20%20mo.md(r%22%22%22%0A%20%20%20%20%23%23%23%201.)%20Portfolio%20choice%0A%20%20%20%20%22%22%22)%0A%20%20%20%20return%0A%0A%0A%40app.cell(hide_code%3DTrue)%0Adef%20_(mo)%3A%0A%20%20%20%20mo.md(r%22%22%22%0A%20%20%20%20The%20goal%20of%20the%20investor%20is%20to%20choose%20a%20portfolio%20strategy%20(i.e.%20the%20sequence%20%7B%24%7B%5Cmathbf%7B%5Calpha_n(I_n)%7D%2C%5Cbeta_n(I_n)%7D%24%7D)%20that%20maximizes%20the%20expected%20utility.%20The%20expected%20utility%20is%20given%20by%3A%0A%0A%20%20%20%20%24%24E%5BU(W_T)%5D%20%3D%20%5Csum_%7BI_%7BT%7D%5Cin%20F_T%7D%20q_1%5E%7BA(I_T)%7Dq_2%5E%7BB(I_T)%7D(1-q_1-q_2)%5E%7BT-A(I_T)-B(I_T)%7DU(W_T(I_T))%24%24%0A%0A%0A%20%20%20%20Note%20that%20the%20summation%20is%20over%20all%20the%20possible%20paths%20for%20a%20tree%20of%20a%20given%20split%20index%20and%20T%20time-periods%20(the%20set%20denoted%20by%20%24F_T%24).%20%24A(I_T)%24%20and%20%24B(I_T)%24%20denote%20the%20number%20of%20times%20the%20first%20and%20second%20possibilities%20are%20considered%20in%20every%20path%2C%20respectively.%20Following%20the%20equations%20presented%20above%2C%20the%20complete%20optimization%20problem%20can%20be%20written%20as%3A%0A%0A%0A%20%20%20%20%24%24U%5E*(W_0)%20%3D%20%5Ctext%7Bmaximize%7D_%7B(%7B%5Cmathbf%7B%5Calpha%7D_n(I_n)%2C%5Cbeta_n(I_n))%7D_%7BI_n%5Cin%20F_T%2C%7Bn%3D1%2C2%2C..%2CT-1%7D%7D%7D%5C%2C%5C%2C%5C%2CE%5BU(W_T)%5D%24%24%0A%0A%0A%20%20%20%20%24%24%5Ctext%7Bsubject%20to%3A%20%20%7D%20%5Cbeta_0%20%5Cleq%20W_0%20-%20%5Csum_%7Bi%3D1%7D%5E%7Bm%7D%20S_%7Bi%2C0%7D%5B%5Calpha_%7Bi%2C0%7D%20%2B%20%7C%5Calpha_%7Bi%2C0%7D%7C%5D%2C%24%24%0A%0A%20%20%20%20%24%24%5Cbeta_n(I_n)%20%5Cleq%20(1%2Br)%5Cbeta_%7Bn-1%7D(I_n)%20%2B%20%5Csum_%7Bi%3D1%7D%5E%7Bm%7D%20S_%7Bi%2Cn%7D(I_n)%5B%5Calpha_%7Bi%2Cn-1%7D(I_n)%20-%20%5Calpha_%7Bi%2Cn%7D(I_n)%20-%20%5Ctheta_i%20%7C%5Calpha_%7Bi%2Cn-1%7D(I_n)%20-%20%5Calpha_%7Bi%2Cn%7D(I_n)%7C%5D%2C%24%24%0A%0A%20%20%20%20%24%24W_T(I_T)%20%5Cleq%20(1%2Br)%5Cbeta_%7BT-1%7D(I_T)%20%2B%20%5Csum_%7Bi%3D1%7D%5E%7Bm%7D%20S_%7Bi%2CT%7D(I_T)%5B%5Calpha_%7Bi%2CT-1%7D(I_T)%20-%20%5Ctheta_i%20%7C%5Calpha_%7Bi%2CT-1%7D(I_T)%7C%5D%2C%5C%2C%5C%2C%5C%2C%20%5Cforall%20I_T%5Cin%20F_T%24%24%0A%20%20%20%20%22%22%22)%0A%20%20%20%20return%0A%0A%0A%40app.cell(hide_code%3DTrue)%0Adef%20_(mo)%3A%0A%20%20%20%20mo.md(r%22%22%22%0A%20%20%20%20%23%23%23%202.)%20Price%20vector%20process%0A%20%20%20%20%22%22%22)%0A%20%20%20%20return%0A%0A%0A%40app.cell(hide_code%3DTrue)%0Adef%20_(mo)%3A%0A%20%20%20%20mo.md(r%22%22%22%0A%20%20%20%20The%20continuous%20price%20process%20that%20we%20intended%20to%20approximate%20is%3A%0A%0A%20%20%20%20%24%24%5Cfrac%7Bd%5Ctilde%7BS_i%7D%7D%7B%5Ctilde%7BS_i%7D%7D%20%3D%20%5Cmu_idt%20%2B%20%5Csum_%7Bj%3D1%7D%5E%7Bm%7D%5Csigma_%7Bij%7D%20dW_j%20%5C%2C%5C%2C%20%2C%20%5C%2C%5C%2C%20%5Cforall%20i%20%3D%201%2C2%2C...%2Cm%24%24%0A%0A%20%20%20%20where%20%24%5Cmu_i%24%20and%20%24%5Csigma_%7Bij%7D%24%20are%20positive%20constants%20and%20the%20%24W_j%24%20denote%20un-correlated%20standard%20Wiener%20processes.%20To%20construct%20a%20discrete%20approximation%2C%20we%20first%20define%20a%20stochastic%20vector%20as%20follows%3A%0A%0A%20%20%20%20%24%24(%5Cepsilon_1%2C%5Cepsilon_2%2C..%2C%5Cepsilon_m)%20%3D%20%5Cbegin%7Bcases%7D%0A%20%20%20%20(%5Cepsilon_1%20(%5Comega_1)%2C%5Cepsilon_2%20(%5Comega_1)%2C..%2C%5Cepsilon_m%20(%5Comega_1))%2C%20%5C%2C%5C%2C%20%5Ctext%7Bwith%20probability%20%7D%20q_1%2C%20%5C%5C%0A%20%20%20%20(%5Cepsilon_1%20(%5Comega_2)%2C%5Cepsilon_2%20(%5Comega_2)%2C..%2C%5Cepsilon_m%20(%5Comega_2))%2C%20%5C%2C%5C%2C%20%5Ctext%7Bwith%20probability%20%7D%20q_2%2C%20%5C%5C%0A%20%20%20%20(%5Cepsilon_1%20(%5Comega_3)%2C%5Cepsilon_2%20(%5Comega_3)%2C..%2C%5Cepsilon_m%20(%5Comega_3))%2C%20%5C%2C%5C%2C%20%5Ctext%7Bwith%20probability%20%7D%20q_3%20%3D%20(1-q_1-q_2)%0A%20%20%20%20%5Cend%7Bcases%7D%0A%20%20%20%20%24%24%0A%20%20%20%20%22%22%22)%0A%20%20%20%20return%0A%0A%0A%40app.cell(hide_code%3DTrue)%0Adef%20_(mo)%3A%0A%20%20%20%20mo.md(r%22%22%22%0A%20%20%20%20The%20equation%20describing%20the%20event%20tree%20(first%20equation%20of%20the%20notebook)%20becomes%20a%20discrete%20approximation%20of%20the%20above-stated%20stochastic%20process%20if%20we%20set%3A%0A%0A%20%20%20%20%24%24a_i%20%3D%20e%5E%7B%5Cmu_i%20%5CDelta%20t%7D%5Cbigg(%20%5Cfrac%7Be%5E%7B%5Cbig%5B%5Csum_%7Bj%3D1%7D%5E%7Bm%7D%5Csigma_%7Bij%7D%5Cepsilon_j(%5Comega_1)%5Csqrt%7B%5CDelta%20t%7D%5Cbig%5D%7D%7D%7Bz_i%7D%5Cbigg)%24%24%0A%0A%20%20%20%20%24%24b_i%20%3D%20e%5E%7B%5Cmu_i%20%5CDelta%20t%7D%5Cbigg(%20%5Cfrac%7Be%5E%7B%5Cbig%5B%5Csum_%7Bj%3D1%7D%5E%7Bm%7D%5Csigma_%7Bij%7D%5Cepsilon_j(%5Comega_2)%5Csqrt%7B%5CDelta%20t%7D%5Cbig%5D%7D%7D%7Bz_i%7D%5Cbigg)%24%24%0A%0A%20%20%20%20%24%24c_i%20%3D%20e%5E%7B%5Cmu_i%20%5CDelta%20t%7D%5Cbigg(%20%5Cfrac%7Be%5E%7B%5Cbig%5B%5Csum_%7Bj%3D1%7D%5E%7Bm%7D%5Csigma_%7Bij%7D%5Cepsilon_j(%5Comega_3)%5Csqrt%7B%5CDelta%20t%7D%5Cbig%5D%7D%7D%7Bz_i%7D%5Cbigg)%24%24%0A%0A%0A%0A%20%20%20%20In%20the%20limit%20%24T%5Cto%20%5Cinfty%24%20(or%20alternatively%20%24%5CDelta%20t%20%5Cto%200%24)%2C%20the%20approximation%20approaches%20the%20continuous%20process.%0A%20%20%20%20%22%22%22)%0A%20%20%20%20return%0A%0A%0A%40app.cell(hide_code%3DTrue)%0Adef%20_(mo)%3A%0A%20%20%20%20mo.md(r%22%22%22%0A%20%20%20%20%23%23%23%203.)%20Investor's%20reservation%20purchase%20price%20for%20a%20European%20call%20option%0A%20%20%20%20%22%22%22)%0A%20%20%20%20return%0A%0A%0A%40app.cell(hide_code%3DTrue)%0Adef%20_(mo)%3A%0A%20%20%20%20mo.md(r%22%22%22%0A%20%20%20%20Suppose%20that%20an%20investor%20is%20interested%20in%20buying%20a%20European%20call%20option%20on%20the%20security%20%24S_1%24%2C%20with%20time%20to%20maturity%20%24%5Coverline%7BT%7D%24%20and%20a%20strike%20price%20%24K%3E0%24.%20At%20the%20expiration%20time%2C%20the%20investor%20would%20get%20a%20payment%20of%20%24%5Ctext%7Bmax%7D(S_%7B1%2CT%7D%20-%20K%2C%200)%24%20(assuming%20cash%20settlement%20and%20also%20that%20the%20investor%20will%20not%20be%20re-selling%20the%20option%20once%20it%20has%20been%20purchased.)%20Our%20goal%20is%20now%20to%20estimate%20the%20highest%20price%20this%20investor%20is%20willing%20to%20pay%2C%20to%20purchase%20such%20an%20option.%0A%20%20%20%20%22%22%22)%0A%20%20%20%20return%0A%0A%0A%40app.cell(hide_code%3DTrue)%0Adef%20_(mo)%3A%0A%20%20%20%20mo.md(r%22%22%22%0A%20%20%20%20If%20the%20investor%20does%20not%20purchase%20the%20call%20option%20and%20only%20trades%20in%20the%20risky%20securities%20%24S_i%24%20and%20the%20bonds%2C%20then%20the%20portfolio%20is%20given%20by%20the%20optimization%20problem%20stated%20above.%20However%2C%20if%20the%20investor%20buys%20the%20call%20option%20at%20a%20reservation%20purchase%20price%20of%20%24C%24%2C%20then%20their%20portfolio%20becomes%20the%20following%3A%0A%20%20%20%20%22%22%22)%0A%20%20%20%20return%0A%0A%0A%40app.cell(hide_code%3DTrue)%0Adef%20_(mo)%3A%0A%20%20%20%20mo.md(r%22%22%22%0A%20%20%20%20%24%24P(C%2CW_0)%20%3D%20%5Ctext%7Bmaximize%7D_%7B(%7B%5Cmathbf%7B%5Calpha%7D_n(I_n)%2C%5Cbeta_n(I_n))%7D_%7BI_n%5Cin%20F_T%2C%7Bn%3D1%2C2%2C..%2CT-1%7D%7D%7D%5C%2C%5C%2C%5C%2CE%5BU(W_T)%5D%24%24%0A%0A%0A%20%20%20%20%24%24%5Ctext%7Bsubject%20to%3A%20%20%20%7D%5Cbeta_0%20%5Cleq%20W_0%20-%20C%20-%20%5Csum_%7Bi%3D1%7D%5E%7Bm%7D%20S_%7Bi%2C0%7D%5B%5Calpha_%7Bi%2C0%7D%20%2B%20%7C%5Calpha_%7Bi%2C0%7D%7C%5D%2C%24%24%0A%0A%20%20%20%20%24%24%5Cbeta_n(I_n)%20%5Cleq%20(1%2Br)%5Cbeta_%7Bn-1%7D(I_n)%20%2B%20%5Csum_%7Bi%3D1%7D%5E%7Bm%7D%20S_%7Bi%2Cn%7D(I_n)%5B%5Calpha_%7Bi%2Cn-1%7D(I_n)%20-%20%5Calpha_%7Bi%2Cn%7D(I_n)%20-%20%5Ctheta_i%20%7C%5Calpha_%7Bi%2Cn-1%7D(I_n)%20-%20%5Calpha_%7Bi%2Cn%7D(I_n)%7C%5D%2C%24%24%0A%0A%20%20%20%20%24%24W_T(I_T)%20%5Cleq%20(1%2Br)%5Cbeta_%7BT-1%7D(I_T)%20%2B%20%5Csum_%7Bi%3D1%7D%5E%7Bm%7D%20S_%7Bi%2CT%7D(I_T)%5B%5Calpha_%7Bi%2CT-1%7D(I_T)%20-%20%5Ctheta_i%20%7C%5Calpha_%7Bi%2CT-1%7D(I_T)%7C%5D%20%2B%20%5Ctext%7Bmax%7D(S_%7B1%2CT%7D(I_T)%20-%20K%2C0)%2C%20%5C%2C%5C%2C%5C%2C%20%5Cforall%20I_T%5Cin%20F_T%24%24%0A%20%20%20%20%22%22%22)%0A%20%20%20%20return%0A%0A%0A%40app.cell(hide_code%3DTrue)%0Adef%20_(mo)%3A%0A%20%20%20%20mo.md(r%22%22%22%0A%20%20%20%20The%20highest%20price%20that%20investor%20is%20willing%20to%20pay%20for%20the%20given%20call%20option%2C%20is%20therefore%20given%20by%20the%20price%20for%20which%20the%20maximum%20expected%20utility%20in%20the%20two%20portfolios%20becomes%20equal%2C%20making%20the%20investor%20indifferent%20to%20the%20choices.%20Thus%2C%20the%20final%20optimization%20problem%20that%20we%20need%20to%20consider%20is%3A%0A%0A%20%20%20%20%24%24C%5E*%20%3D%20%5Ctext%7Bmaximize%7D_%7B(%7B%5Cmathbf%7B%5Calpha%7D_n(I_n)%2C%5Cbeta_n(I_n))%7D_%7BI_n%5Cin%20F_T%2C%7Bn%3D1%2C2%2C..%2CT-1%7D%7D%7D%20%5C%2C%5C%2C%5C%2C%20C%24%24%0A%0A%20%20%20%20%24%24%5Ctext%7Bsubject%20to%3A%20%7D%20E%5BU(W_T)%5D%20%5Cgeq%20U%5E*(W_0)%20%24%24%0A%0A%20%20%20%20along%20with%20the%20other%20constraints%20mentioned%20in%20the%20optimization%20problem%20for%20the%20portfolio%20in%20which%20the%20option%20is%20purchased.%0A%20%20%20%20%22%22%22)%0A%20%20%20%20return%0A%0A%0A%40app.cell(hide_code%3DTrue)%0Adef%20_(mo)%3A%0A%20%20%20%20mo.md(r%22%22%22%0A%20%20%20%20%23%23%23%204.)%20Utility%20function%0A%20%20%20%20%22%22%22)%0A%20%20%20%20return%0A%0A%0A%40app.cell(hide_code%3DTrue)%0Adef%20_(mo)%3A%0A%20%20%20%20mo.md(r%22%22%22%0A%20%20%20%20In%20the%20optimization%20problems%20mentioned%20above%2C%20we%20need%20to%20optimize%20the%20expected%20utility.%20The%20utility%20functions%20that%20we%20consider%20are%20members%20of%20a%20family%20called%20HARA%20utility%20functions%20(Hyperbolic%20Absolute%20Risk%20Aversion).%20The%20general%20expression%20for%20HARA%20utility%20is%3A%0A%0A%20%20%20%20%24%24U(W)%20%3D%20%5Cfrac%7B1-%5Cgamma%7D%7B%5Cgamma%7D%5Cbigg(%5Cfrac%7BaW%7D%7B1-%5Cgamma%7D%20%2B%20b%5Cbigg)%5E%5Cgamma%20%5C%2C%3B%5C%2C%20a%3E0%24%24%0A%0A%20%20%20%20where%20%24W%20%3E%20((%5Cgamma%20-%201)b)%2Fa%24.%20Note%20that%20the%20exponential%20and%20logarithmic%20utility%20functions%20are%20also%20members%20of%20the%20HARA-class.%0A%20%20%20%20%22%22%22)%0A%20%20%20%20return%0A%0A%0A%40app.cell(hide_code%3DTrue)%0Adef%20_(mo)%3A%0A%20%20%20%20mo.md(r%22%22%22%0A%20%20%20%20Another%20thing%20to%20consider%20is%20the%20Arrow-Pratt%20measure%20of%20the%20Absolute%20risk%20aversion.%20For%20the%20HARA-class%2C%20it%20is%3A%0A%0A%20%20%20%20%24%24ARA(W)%20%3D%20%5Cbigg(%5Cfrac%7BW%7D%7B1-%5Cgamma%7D%20%2B%20%5Cfrac%7Bb%7D%7Ba%7D%5Cbigg)%5E%7B-1%7D%24%24%0A%20%20%20%20%22%22%22)%0A%20%20%20%20return%0A%0A%0A%40app.cell(hide_code%3DTrue)%0Adef%20_(mo)%3A%0A%20%20%20%20mo.md(r%22%22%22%0A%20%20%20%20%23%20Fusion%20Implementation%0A%20%20%20%20%22%22%22)%0A%20%20%20%20return%0A%0A%0A%40app.cell(hide_code%3DTrue)%0Adef%20_(mo)%3A%0A%20%20%20%20mo.md(r%22%22%22%0A%20%20%20%20Now%20we%20proceed%20with%20the%20construction%20of%20the%20fusion%20model.%20We%20start%20by%20making%20a%20Tree%20class%20that%20will%20represent%20the%20event%20tree%20discussed%20above.%0A%20%20%20%20%22%22%22)%0A%20%20%20%20return%0A%0A%0A%40app.cell(hide_code%3DTrue)%0Adef%20_(mo)%3A%0A%20%20%20%20mo.md(r%22%22%22%0A%20%20%20%20%23%23%23%20Parameters%20for%20Initializing%20the%20Tree%20Class%0A%0A%20%20%20%20When%20creating%20a%20Tree%20object%2C%20the%20following%20parameters%20define%20the%20investment%20environment%20and%20decision-making%20setup%3A%0A%0A%20%20%20%20-%20**M**%20%E2%80%93%20The%20optimization%20model%2C%20typically%20a%20MOSEK%20Fusion%20%60Model%60%2C%20that%20will%20hold%20variables%2C%20constraints%2C%20and%20the%20objective.%0A%20%20%20%20-%20**T**%20%E2%80%93%20The%20number%20of%20discrete%20time%20steps%20in%20the%20investment%20horizon.%0A%20%20%20%20-%20**W%E2%82%80**%20%E2%80%93%20The%20investor%E2%80%99s%20initial%20wealth%20at%20time%200.%0A%20%20%20%20-%20**S**%20%E2%80%93%20The%20price-scaling%20matrix%20that%20adjusts%20asset%20prices%20over%20time.%0A%20%20%20%20-%20**%CE%B8**%20%E2%80%93%20The%20vector%20of%20transaction%20costs%2C%20representing%20costs%20incurred%20when%20trading%20risky%20assets.%0A%20%20%20%20-%20**S%E1%B5%A5%E2%82%80**%20%E2%80%93%20The%20initial%20price%20vector%20for%20the%20risky%20securities%20at%20time%200.%0A%20%20%20%20-%20**r**%20%E2%80%93%20The%20risk-free%20interest%20rate%20applied%20to%20bonds.%0A%20%20%20%20-%20**U%20%3D%20%5Ba%2C%20b%2C%20%CE%B3%5D**%20%E2%80%93%20The%20set%20of%20parameters%20defining%20the%20investor%E2%80%99s%20HARA%20(Hyperbolic%20Absolute%20Risk%20Aversion)%20utility%20function%2C%20capturing%20risk%20preferences.%0A%20%20%20%20%22%22%22)%0A%20%20%20%20return%0A%0A%0A%40app.cell(hide_code%3DTrue)%0Adef%20_(mo)%3A%0A%20%20%20%20mo.md(r%22%22%22%0A%20%20%20%20%23%23%23%20HARA%20utility%20as%20a%20Power%20cone%3A%0A%20%20%20%20%22%22%22)%0A%20%20%20%20return%0A%0A%0A%40app.cell(hide_code%3DTrue)%0Adef%20_(mo)%3A%0A%20%20%20%20mo.md(r%22%22%22%0A%20%20%20%20The%20objective%20function%20is%3A%0A%0A%20%20%20%20%24%24%5Ctext%7Bmaximize%20%20%20%7DE%5BU(W_T)%5D%20%3D%20%5Csum_%7BI_T%5Cin%20F_T%7DP(I_T)%20%5Cbigg(%5Cfrac%7B1-%5Cgamma%7D%7B%5Cgamma%7D%5Cbigg)%20%20%5Cbigg(%5Cfrac%7BaW(I_T)%7D%7B1-%5Cgamma%7D%20%2B%20b%5Cbigg)%5E%5Cgamma%24%24%0A%0A%20%20%20%20where%20%24P(I_T)%24%20is%20the%20probability%20of%20a%20given%20path.%20We%20can%20re-write%20this%20as%3A%0A%0A%0A%20%20%20%20%24%24%5Ctext%7Bmaximize%20%20%20%7D%20%5Csum_%7BI_T%5Cin%20F_T%7DP(I_T)%20%5Cbigg(%5Cfrac%7B1-%5Cgamma%7D%7B%5Cgamma%7D%5Cbigg)%20h(I_T)%24%24%0A%0A%20%20%20%20%24%24%5Ctext%7Bsubject%20to%20%3A%20%20%20%7D%20h(I_T)%5Cleq%20%5Cbigg(%5Cfrac%7BaW(I_T)%7D%7B1-%5Cgamma%7D%20%2B%20b%5Cbigg)%5E%5Cgamma%24%24%0A%0A%0A%20%20%20%20Now%2C%20the%20constraint%20can%20be%20expressed%20as%20a%20Power%20cone.%20However%2C%20there%20are%20a%20few%20possible%20cases%3A%0A%0A%20%20%20%201.)%20%24%5Cgamma%20%3E%201%24%3A%20In%20this%20case%2C%20the%20conic%20representation%20is%3A%0A%0A%20%20%20%20%24%24%5CBigg(h(I_T)%2C1%2C%5Cbigg(%5Cfrac%7BaW(I_T)%7D%7B1-%5Cgamma%7D%20%2B%20b%5Cbigg)%20%5CBigg)%20%5Cin%20%5Cmathcal%7BP%7D_3%5E%7B1%2F%5Cgamma%7D%24%24%0A%0A%20%20%20%202.)%20%240%20%3C%20%5Cgamma%20%3C%201%24%3A%0A%0A%20%20%20%20%24%24%5CBigg(%5Cbigg(%5Cfrac%7BaW(I_T)%7D%7B1-%5Cgamma%7D%20%2B%20b%5Cbigg)%2C1%2C%20h(I_T)%20%5CBigg)%20%5Cin%20%5Cmathcal%7BP%7D_3%5E%7B%5Cgamma%7D%24%24%0A%0A%20%20%20%203.)%20%24%5Cgamma%20%3C%200%24%3A%0A%0A%20%20%20%20%24%24%5CBigg(h(I_T)%2C%5Cbigg(%5Cfrac%7BaW(I_T)%7D%7B1-%5Cgamma%7D%20%2B%20b%5Cbigg)%2C1%20%20%5CBigg)%20%5Cin%20%5Cmathcal%7BP%7D_3%5E%7B1%2F(1-%5Cgamma)%7D%24%24%0A%20%20%20%20%22%22%22)%0A%20%20%20%20return%0A%0A%0A%40app.cell(hide_code%3DTrue)%0Adef%20_(mo)%3A%0A%20%20%20%20mo.md(r%22%22%22%0A%20%20%20%20%23%23%23%20Exponential%20utility%20as%20an%20exponential%20cone%3A%0A%20%20%20%20%22%22%22)%0A%20%20%20%20return%0A%0A%0A%40app.cell(hide_code%3DTrue)%0Adef%20_(mo)%3A%0A%20%20%20%20mo.md(r%22%22%22%0A%20%20%20%20The%20objective%20function%20in%20the%20case%20of%20exponential%20utility%20will%20be%20given%20by%3A%0A%0A%20%20%20%20%24%24%5Ctext%7Bmaximize%20%20%20%7DE%5BU(W_T)%5D%20%3D%20%5Csum_%7BI_T%5Cin%20F_T%7DP(I_T)%20%5Cbigg(1%20-%20e%5E%7B-%20%5B%5Ctext%7BARA%7D(W)%5D%20W(I_T)%7D%5Cbigg)%0A%20%20%20%20%24%24%0A%0A%20%20%20%20if%20the%20Absolute%20Risk%20aversion%20is%20nonzero.%20However%2C%20if%20ARA%24(W)%20%3D%200%24%2C%20then%20the%20objective%20function%20is%20simply%3A%0A%0A%20%20%20%20%24%24%5Ctext%7Bmaximize%20%20%20%7DE%5BU(W_T)%5D%20%3D%20%5Csum_%7BI_T%5Cin%20F_T%7DP(I_T)%20W(I_T)%24%24%0A%0A%20%20%20%20For%20the%20non-zero%20ARA%24(W)%24%2C%20we%20express%20the%20objective%20function%20as%20follows%3A%0A%0A%20%20%20%20%24%24%5Ctext%7Bmaximize%20%20%20%7D%20%5Csum_%7BI_T%5Cin%20F_T%7DP(I_T)%20h(I_T)%24%24%0A%0A%20%20%20%20%24%24%5Ctext%7Bsubject%20to%3A%20%20%7D%20(1-h(I_T))%5Cgeq%20e%5E%7B-%5B%5Ctext%7BARA%7D(W)%5DW(I_T)%7D%24%24%0A%0A%20%20%20%20and%20the%20constraint%20is%20readily%20expressed%20as%20an%20exponential%20cone%3A%0A%0A%20%20%20%20%24%24%5Cbig((1-h(I_T))%2C1%2C-%5B%5Ctext%7BARA%7D(W)%5DW(I_T)%5Cbig)%20%5Cin%20K_%7Bexp%7D%24%24%0A%20%20%20%20%22%22%22)%0A%20%20%20%20return%0A%0A%0A%40app.cell%0Adef%20_()%3A%0A%20%20%20%20import%20numpy%20as%20np%0A%20%20%20%20from%20mosek.fusion%20import%20Model%2C%20Domain%2C%20Expr%2C%20ObjectiveSense%2C%20Matrix%2C%20Var%2C%20SolutionStatus%0A%20%20%20%20import%20sys%0A%20%20%20%20import%20matplotlib.pyplot%20as%20plt%0A%20%20%20%20import%20time%0A%20%20%20%20return%20Domain%2C%20Expr%2C%20Model%2C%20ObjectiveSense%2C%20np%2C%20sys%0A%0A%0A%40app.cell%0Adef%20_(Domain%2C%20Expr%2C%20Level%2C%20np)%3A%0A%20%20%20%20class%20Tree%3A%20%20%20%20%0A%20%20%20%20%20%20%20%20%23%20Instantiate%20the%20Tree%20class.%0A%20%20%20%20%20%20%20%20def%20__init__(self%2C%20M%2C%20T%2C%20W_0%2C%20S%2C%20theta%2C%20S_v_0%2C%20r%2C%20U)%3A%0A%20%20%20%20%20%20%20%20%20%20%20%20self.M%20%3D%20M%0A%20%20%20%20%20%20%20%20%20%20%20%20self.W_0%20%3D%20W_0%0A%20%20%20%20%20%20%20%20%20%20%20%20self.T%20%3D%20T%0A%20%20%20%20%20%20%20%20%20%20%20%20self.S_v%20%3D%20S%0A%20%20%20%20%20%20%20%20%20%20%20%20self.r%20%3D%20r%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20%20%20%23%20Shape%20of%20the%20cost%20scaling%20matrix%20will%20give%20us%20the%20split%20index%20and%20the%20number%20of%20risky%20securities.%0A%20%20%20%20%20%20%20%20%20%20%20%20self.s%2C%20self.n%20%3D%20S.shape%0A%20%20%20%20%20%20%20%20%20%20%20%20self.cost%20%3D%20np.asarray(%5Btheta%5D)%0A%20%20%20%20%20%20%20%20%20%20%20%20self.S_v_0%20%3D%20S_v_0%0A%20%20%20%20%20%20%20%20%20%20%20%20%23%20Parameters%20for%20the%20utility%20function.%0A%20%20%20%20%20%20%20%20%20%20%20%20self.U%20%3D%20U%0A%20%20%20%20%20%20%20%20%20%20%20%20self.S_v_t%20%3D%20S_v_0%0A%20%20%20%20%20%20%20%20%20%20%20%20%23%20This%20is%20to%20decide%20which%20utility%20will%20be%20used.%0A%20%20%20%20%20%20%20%20%20%20%20%20self.util_dispatch%20%3D%20%7B'HARA'%3A%20self.HARA_util%2C%20'EXP'%3A%20self.exp_util%7D%0A%20%20%20%20%20%20%20%20%20%20%20%20self.levels%20%3D%20%5B%5D%0A%0A%20%20%20%20%20%20%20%20%23%20Method%20to%20make%20all%20the%20levels%2C%20or%20the%20time%20steps%20in%20the%20tree.%0A%20%20%20%20%20%20%20%20def%20level_make(self)%3A%0A%20%20%20%20%20%20%20%20%20%20%20%20%23%20Number%20of%20risky%20securities%2C%20i.e.%20alpha%7Bi%2Ct%3D0%7D%0A%20%20%20%20%20%20%20%20%20%20%20%20self.a0%20%3D%20self.M.variable('a_0'%2C%20%5B1%2C%20self.n%5D)%0A%20%20%20%20%20%20%20%20%20%20%20%20%23%20Bonds%20at%20t%3D0.%0A%20%20%20%20%20%20%20%20%20%20%20%20self.b0%20%3D%20self.M.variable('b_0'%2C%201)%0A%20%20%20%20%20%20%20%20%20%20%20%20%23%20Making%20the%20first%20budget%20constraint.%0A%20%20%20%20%20%20%20%20%20%20%20%20self.budg_ex%20%3D%20Expr.sub(%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20Expr.sub(self.W_0%2C%20self.b0)%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20Expr.dot(self.S_v_0%2C%20Expr.mulElm(1%20%2B%20self.cost%2C%20self.a0))%0A%20%20%20%20%20%20%20%20%20%20%20%20)%0A%20%20%20%20%20%20%20%20%20%20%20%20self.root_budget%20%3D%20self.M.constraint('Budget_0'%2C%20self.budg_ex%2C%20Domain.greaterThan(0.0))%0A%20%20%20%20%20%20%20%20%20%20%20%20%23%20This%20list%20will%20hold%20the%20level%20objects%20associated%20to%20this%20tree.%0A%20%20%20%20%20%20%20%20%20%20%20%20a%2C%20b%20%3D%20self.a0%2C%20self.b0%0A%20%20%20%20%20%20%20%20%20%20%20%20for%20i%20in%20range(1%2C%20self.T%20%2B%201)%3A%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%23%20Appending%20level%20n%2C%20based%20on%20the%20level%20(n-1).%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20self.levels.append(Level(i%2C%20self%2C%20a%2C%20b))%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20a%20%3D%20self.levels%5Bi%20-%201%5D.a_new%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20b%20%3D%20self.levels%5Bi%20-%201%5D.b_new%0A%20%20%20%20%20%20%20%20%20%20%20%20%23%20a_T%20is%20zero%20().%0A%0A%20%20%20%20%20%20%20%20%23%20Method%20to%20make%20the%20HARA%20utility%20function%20and%20the%20corresponding%20Power-cone%20constraint.%0A%20%20%20%20%20%20%20%20def%20HARA_util(self%2C%20W)%3A%0A%20%20%20%20%20%20%20%20%20%20%20%20self.h%20%3D%20self.M.variable('h'%2C%20self.s**self.T%2C%20Domain.greaterThan(0.0))%0A%0A%20%20%20%20%20%20%20%20%20%20%20%20%23%20HARA%20utility%20is%20only%20defined%20for%20when%20W%20%3E%20(gamma%20-%201)a%2Fb.%0A%20%20%20%20%20%20%20%20%20%20%20%20self.M.constraint(W%2C%20Domain.greaterThan(self.U%5B1%5D%20*%20(self.U%5B2%5D%20-%201)%20%2F%20self.U%5B0%5D))%0A%0A%20%20%20%20%20%20%20%20%20%20%20%20I%20%3D%20Expr.constTerm(%5Bself.s**self.T%5D%2C%201.0)%0A%20%20%20%20%20%20%20%20%20%20%20%20self.E1%20%3D%20Expr.add(%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20Expr.mul(self.U%5B0%5D%20%2F%20(1%20-%20self.U%5B2%5D)%2C%20W)%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20Expr.constTerm(W.getShape()%2C%20self.U%5B1%5D)%0A%20%20%20%20%20%20%20%20%20%20%20%20)%0A%0A%20%20%20%20%20%20%20%20%20%20%20%20%23%20Different%20cases%20for%20different%20gamma%20values%0A%20%20%20%20%20%20%20%20%20%20%20%20if%20self.U%5B2%5D%20%3E%201.0%3A%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20self.M.constraint('Obj_terms_HARA'%2C%20Expr.hstack(self.h%2C%20I%2C%20self.E1)%2C%20Domain.inPPowerCone(1%20%2F%20self.U%5B2%5D))%0A%20%20%20%20%20%20%20%20%20%20%20%20elif%20self.U%5B2%5D%20%3C%200.0%3A%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20self.M.constraint('Obj_terms_HARA'%2C%20Expr.hstack(self.h%2C%20self.E1%2C%20I)%2C%20Domain.inPPowerCone(1%20%2F%20(1%20-%20self.U%5B2%5D)))%0A%20%20%20%20%20%20%20%20%20%20%20%20else%3A%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20self.M.constraint('Obj_terms_HARA'%2C%20Expr.hstack(self.E1%2C%20I%2C%20self.h)%2C%20Domain.inPPowerCone(self.U%5B2%5D))%0A%0A%20%20%20%20%20%20%20%20%20%20%20%20return%20Expr.mul(((1%20-%20self.U%5B2%5D)%20%2F%20self.U%5B2%5D)%2C%20self.h)%0A%0A%20%20%20%20%20%20%20%20%23%20Method%20to%20make%20the%20Exponential%20utility%20constraints.%0A%20%20%20%20%20%20%20%20def%20exp_util(self%2C%20W)%3A%0A%20%20%20%20%20%20%20%20%20%20%20%20%23%20Zero%20ARA(W)%20case%0A%20%20%20%20%20%20%20%20%20%20%20%20if%20self.U%20%3D%3D%200%3A%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20return%20W%0A%20%20%20%20%20%20%20%20%20%20%20%20%23%20Nonzero%20ARA(W)%20case%0A%20%20%20%20%20%20%20%20%20%20%20%20self.h%20%3D%20self.M.variable('h'%2C%20self.s**self.T)%0A%20%20%20%20%20%20%20%20%20%20%20%20I%20%3D%20Expr.constTerm(%5Bself.s**self.T%5D%2C%201.0)%0A%20%20%20%20%20%20%20%20%20%20%20%20E_exp%20%3D%20Expr.mul(-self.U%2C%20W)%0A%20%20%20%20%20%20%20%20%20%20%20%20self.M.constraint('Obj_terms_exp'%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20Expr.hstack(Expr.sub(I%2C%20Expr.mul(self.U%2C%20self.h))%2C%20I%2C%20E_exp)%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20Domain.inPExpCone())%0A%20%20%20%20%20%20%20%20%20%20%20%20return%20self.h%0A%20%20%20%20return%20(Tree%2C)%0A%0A%0A%40app.cell(hide_code%3DTrue)%0Adef%20_(mo)%3A%0A%20%20%20%20mo.md(r%22%22%22%0A%20%20%20%20The%20%3Ci%3ETree%3C%2Fi%3E%20class%20defined%20above%20has%20the%20sub-class%20%3Ci%3ELevel%3C%2Fi%3E.%20The%20budget%20constraints%20involved%20in%20our%20model%20connect%20variables%20that%20lie%20in%20consecutive%20levels.%20Therefore%2C%20we%20can%20visualize%20all%20the%20constraints%20between%20two%20levels%20in%20the%20following%20manner%20(Note%3A%20for%20ease%20of%20visualization%2C%20we%20take%20the%20split%20index%20as%20%24s%20%3D%203%24%2C%20and%20a%20time%20period%20of%20n%20%3D%203)%3A%0A%0A%20%20%20%20%24%24%0A%20%20%20%20%5Cbegin%7Bpmatrix%7D%0A%20%20%20%20a%5Cbegin%7Bbmatrix%7D%0A%20%20%20%20S_%7B(1%2C2)%7D%20%5C%5C%0A%20%20%20%20S_%7B(2%2C2)%7D%20%5C%5C%0A%20%20%20%20S_%7B(3%2C2)%7D%20%5C%5C%0A%20%20%20%20%5Cend%7Bbmatrix%7D%5C%5C%0A%20%20%20%20b%5Cbegin%7Bbmatrix%7D%0A%20%20%20%20S_%7B(1%2C2)%7D%20%5C%5C%0A%20%20%20%20S_%7B(2%2C2)%7D%20%5C%5C%0A%20%20%20%20S_%7B(3%2C2)%7D%20%5C%5C%0A%20%20%20%20%5Cend%7Bbmatrix%7D%5C%5C%0A%20%20%20%20c%5Cbegin%7Bbmatrix%7D%0A%20%20%20%20S_%7B(1%2C2)%7D%20%5C%5C%0A%20%20%20%20S_%7B(2%2C2)%7D%20%5C%5C%0A%20%20%20%20S_%7B(3%2C2)%7D%20%5C%5C%0A%20%20%20%20%5Cend%7Bbmatrix%7D%5C%5C%0A%20%20%20%20%5Cend%7Bpmatrix%7D%0A%20%20%20%20%3A%0A%20%20%20%20%5Cbegin%7Bpmatrix%7D%0A%20%20%20%20%5Cbegin%7Bbmatrix%7D%0A%20%20%20%20%5Cmathbf%7B%5Calpha_%7B(1%2C2)%7D%7D%2C%5Cbeta_%7B(1%2C2)%7D%20%5C%5C%0A%20%20%20%20%5Cmathbf%7B%5Calpha_%7B(2%2C2)%7D%7D%2C%5Cbeta_%7B(2%2C2)%7D%20%5C%5C%0A%20%20%20%20%5Cmathbf%7B%5Calpha_%7B(3%2C2)%7D%7D%2C%5Cbeta_%7B(3%2C2)%7D%20%5C%5C%0A%20%20%20%20%5Cend%7Bbmatrix%7D%20%5C%5C%0A%20%20%20%20%5Cbegin%7Bbmatrix%7D%0A%20%20%20%20%5Cmathbf%7B%5Calpha_%7B(1%2C2)%7D%7D%2C%5Cbeta_%7B(1%2C2)%7D%20%5C%5C%0A%20%20%20%20%5Cmathbf%7B%5Calpha_%7B(2%2C2)%7D%7D%2C%5Cbeta_%7B(2%2C2)%7D%20%5C%5C%0A%20%20%20%20%5Cmathbf%7B%5Calpha_%7B(3%2C2)%7D%7D%2C%5Cbeta_%7B(3%2C2)%7D%20%5C%5C%0A%20%20%20%20%5Cend%7Bbmatrix%7D%20%5C%5C%0A%20%20%20%20%5Cbegin%7Bbmatrix%7D%0A%20%20%20%20%5Cmathbf%7B%5Calpha_%7B(1%2C2)%7D%7D%2C%5Cbeta_%7B(1%2C2)%7D%20%5C%5C%0A%20%20%20%20%5Cmathbf%7B%5Calpha_%7B(2%2C2)%7D%7D%2C%5Cbeta_%7B(2%2C2)%7D%20%5C%5C%0A%20%20%20%20%5Cmathbf%7B%5Calpha_%7B(3%2C2)%7D%7D%2C%5Cbeta_%7B(3%2C2)%7D%20%5C%5C%0A%20%20%20%20%5Cend%7Bbmatrix%7D%20%5C%5C%0A%20%20%20%20%5Cend%7Bpmatrix%7D%20%20%5Clongrightarrow%0A%20%20%20%20%5Cbegin%7Bpmatrix%7D%0A%20%20%20%20%5Cmathbf%7B%5Calpha_%7B(1%2C3)%7D%7D%2C%5Cbeta_%7B(1%2C3)%7D%20%5C%5C%0A%20%20%20%20%5Cmathbf%7B%5Calpha_%7B(2%2C3)%7D%7D%2C%5Cbeta_%7B(2%2C3)%7D%20%5C%5C%0A%20%20%20%20%5Cmathbf%7B%5Calpha_%7B(3%2C3)%7D%7D%2C%5Cbeta_%7B(3%2C3)%7D%20%5C%5C%0A%20%20%20%20%5Cmathbf%7B%5Calpha_%7B(4%2C3)%7D%7D%2C%5Cbeta_%7B(4%2C3)%7D%20%5C%5C%0A%20%20%20%20%5Cmathbf%7B%5Calpha_%7B(5%2C3)%7D%7D%2C%5Cbeta_%7B(5%2C3)%7D%20%5C%5C%0A%20%20%20%20%5Cmathbf%7B%5Calpha_%7B(6%2C3)%7D%7D%2C%5Cbeta_%7B(6%2C3)%7D%20%5C%5C%0A%20%20%20%20%5Cmathbf%7B%5Calpha_%7B(7%2C3)%7D%7D%2C%5Cbeta_%7B(7%2C3)%7D%20%5C%5C%0A%20%20%20%20%5Cmathbf%7B%5Calpha_%7B(8%2C3)%7D%7D%2C%5Cbeta_%7B(8%2C3)%7D%20%5C%5C%0A%20%20%20%20%5Cmathbf%7B%5Calpha_%7B(9%2C3)%7D%7D%2C%5Cbeta_%7B(9%2C3)%7D%20%5C%5C%0A%20%20%20%20%5Cend%7Bpmatrix%7D%0A%20%20%20%20%24%24%0A%0A%20%20%20%20Here%2C%20the%20first%20column%20vector%20is%20a%20%3Ci%3E%22vstack%22%3C%2Fi%3E%20of%20the%20price%20vector%20at%20level%20%24n%3D2%24%2C%20multiplied%20by%20the%20scaling%20factors%20for%20the%20price.%20Therefore%2C%20the%20first%20column%20is%20the%20new%20price%20vector%20(for%20%24n%3D3%24).%20In%20the%20second%20column%2C%20%24%5Calpha%24's%20will%20be%20vectors%20if%20there%20are%20multiple%20risky%20securities.%20Also%2C%20%24%5Calpha_%7B(i%2Cn)%7D%24%20and%20%24%5Cbeta_%7B(i%2Cn)%7D%24%20correspond%20to%20the%20number%20of%20risky%20securities%20and%20the%20bonds%2C%20respectively%2C%20for%20the%20%24i%5E%7B%5Ctext%7Bth%7D%7D%24%20path%20at%20the%20%24n%5E%7B%5Ctext%7Bth%7D%7D%24%20time%20period.%20It%20is%20to%20be%20realized%20that%20for%20a%20given%20time%20period%2C%20%241%5Cleq%20i%20%5Cleq%20s%5En%24.%0A%0A%20%20%20%20The%20above-stated%20representation%20shows%20that%20we%20can%20%3Ci%3E%22repeat%22%3C%2Fi%3E%20the%20variables%20of%20the%20previous%20level%20%24s%24%20number%20of%20times%20and%20then%20it%20becomes%20quite%20easy%20to%20implement%20the%20budget%20constraints%20in%20%3Ci%3EFusion%3C%2Fi%3E.%20One%20can%20also%20extend%20the%20above%20shown%20method%20to%20a%20higher%20split%20index.%0A%20%20%20%20%22%22%22)%0A%20%20%20%20return%0A%0A%0A%40app.cell%0Adef%20_(Domain%2C%20Expr%2C%20np)%3A%0A%20%20%20%20%23%20Each%20level%20corresponds%20to%20a%20time%20step%20in%20the%20event%20tree.%0A%20%20%20%20class%20Level%3A%0A%20%20%20%20%20%20%20%20%23%20l%20corresponds%20to%20the%20time%20step%3B%20a_old%2C%20b_old%20belong%20to%20(l-1)%20in%20the%20tree.%20%0A%20%20%20%20%20%20%20%20def%20__init__(self%2C%20l%2C%20Tree%2C%20a_old%2C%20b_old)%3A%0A%20%20%20%20%20%20%20%20%20%20%20%20if%20l%20%3D%3D%20Tree.T%3A%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%23%20If%20the%20current%20level%20is%20the%20final%20time%20period%2C%20then%20all%20risky%20securities%20are%20considered%20sold.%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20self.a_new%20%3D%20Expr.constTerm(%5BTree.s**l%2C%20Tree.n%5D%2C%200.0)%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%23%20Final%20step's%20bonds%20are%20the%20wealth%20W(I_T)%3B%20later%20used%20in%20the%20utility%20function.%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20self.b_new%20%3D%20Tree.M.variable('W_T'%2C%20Tree.s**l)%0A%20%20%20%20%20%20%20%20%20%20%20%20else%3A%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%23%20Risky%20securities%20for%20time%20step%20l.%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20self.a_new%20%3D%20Tree.M.variable(f'a_%7Bl%7D'%2C%20%5BTree.s**l%2C%20Tree.n%5D)%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%23%20Bonds%20in%20dollars%20for%20time%20step%20l.%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20self.b_new%20%3D%20Tree.M.variable(f'b_%7Bl%7D'%2C%20Tree.s**l)%0A%0A%20%20%20%20%20%20%20%20%20%20%20%20%23%20Variable%20for%20the%20quadratic%20cone%20to%20implement%20the%20absolute%20value%20constraint.%0A%20%20%20%20%20%20%20%20%20%20%20%20self.t_new%20%3D%20Tree.M.variable(f't_%7Bl%7D'%2C%20%5BTree.s**l%2C%20Tree.n%5D%2C%20Domain.greaterThan(0.0))%0A%20%20%20%20%20%20%20%20%20%20%20%20Tree.cost%20%3D%20np.repeat(Tree.cost%2C%20Tree.s%2C%20axis%3D0)%0A%0A%20%20%20%20%20%20%20%20%20%20%20%20%23%20Repeating%2FStacking%20the%20(l-1)%20level%20variables%20for%20budget%20constraints.%20%0A%20%20%20%20%20%20%20%20%20%20%20%20A%20%3D%20Expr.repeat(a_old%2C%20Tree.s%2C%200)%0A%20%20%20%20%20%20%20%20%20%20%20%20B%20%3D%20Expr.repeat(b_old%2C%20Tree.s%2C%200)%0A%0A%20%20%20%20%20%20%20%20%20%20%20%20%23%20Price%20vector%20of%20previous%20level%2C%20scaled%20and%20stacked%20vertically.%0A%20%20%20%20%20%20%20%20%20%20%20%20Tree.S_v_t%20%3D%20np.vstack(%5Bnp.multiply(j%2C%20Tree.S_v_t)%20for%20j%20in%20Tree.S_v%5D)%0A%0A%20%20%20%20%20%20%20%20%20%20%20%20%23%20Expressions%20for%20budget%20constraints.%0A%20%20%20%20%20%20%20%20%20%20%20%20self.bond_sub%20%3D%20Expr.sub(Expr.mul(B%2C%20(1%20%2B%20Tree.r))%2C%20self.b_new)%0A%20%20%20%20%20%20%20%20%20%20%20%20self.secu_sub%20%3D%20Expr.sub(self.a_new%2C%20A)%0A%20%20%20%20%20%20%20%20%20%20%20%20self.transact%20%3D%20Expr.add(self.secu_sub%2C%20Expr.mulElm(Tree.cost%2C%20self.t_new))%0A%20%20%20%20%20%20%20%20%20%20%20%20self.secu_exp%20%3D%20Expr.mulDiag(self.transact%2C%20Tree.S_v_t.transpose())%0A%0A%20%20%20%20%20%20%20%20%20%20%20%20%23%20Linear%20budget%20constraint.%0A%20%20%20%20%20%20%20%20%20%20%20%20self.budg_constr%20%3D%20Tree.M.constraint(f'Budget_%7Bl%7D'%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20Expr.sub(self.bond_sub%2C%20self.secu_exp)%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20Domain.greaterThan(0.0))%0A%20%20%20%20%20%20%20%20%20%20%20%20%23%20Quadratic%20cone%20for%20absolute%20value%20requirement.%0A%20%20%20%20%20%20%20%20%20%20%20%20Tree.M.constraint(f'a%7Bl%7D_abs'%2C%20Expr.stack(2%2C%20self.t_new%2C%20self.secu_sub)%2C%20Domain.inQCone())%0A%20%20%20%20return%20(Level%2C)%0A%0A%0A%40app.cell(hide_code%3DTrue)%0Adef%20_(mo)%3A%0A%20%20%20%20mo.md(r%22%22%22%0A%20%20%20%20%23%23%23%20Now%20that%20we%20have%20the%20basic%20structure%20of%20the%20tree%20ready%2C%20we%20can%20easily%20make%20the%20%3Ci%3EFusion%3C%2Fi%3E%20model%20as%20follows...%0A%20%20%20%20%22%22%22)%0A%20%20%20%20return%0A%0A%0A%40app.cell(hide_code%3DTrue)%0Adef%20_(mo)%3A%0A%20%20%20%20mo.md(r%22%22%22%0A%20%20%20%20We%20will%20represent%20the%20paths%20%24I_T%24%20by%20their%20numbers.%20Therefore%2C%20we%20have%20(split_index)%24%5ET%24%20paths.%20Each%20Path%20number%20represented%20in%20the%20base%20of%20the%20split%20index%20will%20give%20us%20a%20unique%20id%20for%20each%20path.%0A%20%20%20%20%22%22%22)%0A%20%20%20%20return%0A%0A%0A%40app.cell%0Adef%20_(np)%3A%0A%20%20%20%20def%20base_rep(b%2C%20i%2C%20size)%3A%0A%20%20%20%20%20%20%20%20n%20%3D%20np.zeros(size)%0A%20%20%20%20%20%20%20%20for%20j%20in%20range(size)%3A%0A%20%20%20%20%20%20%20%20%20%20%20%20n%5Bj%5D%20%3D%20i%20%25%20b%0A%20%20%20%20%20%20%20%20%20%20%20%20if%20i%20%2F%2F%20b%20%3D%3D%200%3A%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20break%0A%20%20%20%20%20%20%20%20%20%20%20%20else%3A%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20i%20%3D%20i%20%2F%2F%20b%0A%20%20%20%20%20%20%20%20return%20np.flip(n)%0A%0A%20%20%20%20def%20path_id_make(split_index%2C%20T)%3A%0A%20%20%20%20%20%20%20%20path_id%20%3D%20%5B%5D%0A%20%20%20%20%20%20%20%20for%20i%20in%20range(split_index%20**%20T)%3A%0A%20%20%20%20%20%20%20%20%20%20%20%20path_id.append(base_rep(split_index%2C%20i%2C%20T))%0A%20%20%20%20%20%20%20%20return%20np.asarray(path_id).astype(int)%0A%0A%20%20%20%20def%20path_route_calc(path_id%2C%20split_index%2C%20q%2C%20*args)%3A%0A%20%20%20%20%20%20%20%20s%20%3D%20np.zeros(split_index)%0A%20%20%20%20%20%20%20%20for%20_p%20in%20path_id%3A%0A%20%20%20%20%20%20%20%20%20%20%20%20s%5B_p%5D%20%3D%20s%5B_p%5D%20%2B%201%0A%20%20%20%20%20%20%20%20if%20args%3A%0A%20%20%20%20%20%20%20%20%20%20%20%20path_S1%20%3D%20%5B%5D%0A%20%20%20%20%20%20%20%20%20%20%20%20for%20j%20in%20range(split_index)%3A%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20path_S1.append(args%5B0%5D%5Bj%5D%20**%20s%5Bj%5D)%0A%20%20%20%20%20%20%20%20%20%20%20%20path_S1T%20%3D%20np.prod(np.asarray(path_S1))%0A%20%20%20%20%20%20%20%20%20%20%20%20return%20path_S1T%0A%20%20%20%20%20%20%20%20else%3A%0A%20%20%20%20%20%20%20%20%20%20%20%20path_prob%20%3D%20np.prod(q%20**%20s)%0A%20%20%20%20%20%20%20%20%20%20%20%20return%20path_prob%0A%0A%20%20%20%20def%20price_vector_z(sigma%2C%20eps%2C%20dt%2C%20q)%3A%0A%20%20%20%20%20%20%20%20E%20%3D%20np.exp(np.matmul(eps%2C%20sigma)%20*%20np.sqrt(dt))%0A%20%20%20%20%20%20%20%20return%20np.matmul(q%2C%20E)%0A%0A%20%20%20%20def%20price_vector_abc(sigma%2C%20eps%2C%20dt%2C%20q%2C%20mu%2C%20Z)%3A%0A%20%20%20%20%20%20%20%20E1%20%3D%20np.multiply(np.exp(np.matmul(eps%2C%20sigma)%20*%20np.sqrt(dt))%2C%201%20%2F%20Z)%0A%20%20%20%20%20%20%20%20E2%20%3D%20np.repeat(%5Bnp.exp(mu%20*%20dt)%5D%2C%20eps.shape%5B0%5D%2C%20axis%3D0)%0A%20%20%20%20%20%20%20%20return%20np.multiply(E2%2C%20E1)%0A%20%20%20%20return%20path_id_make%2C%20path_route_calc%2C%20price_vector_abc%2C%20price_vector_z%0A%0A%0A%40app.cell(hide_code%3DTrue)%0Adef%20_(mo)%3A%0A%20%20%20%20mo.md(r%22%22%22%0A%20%20%20%20%23%23%23%20Portfolio%20without%20call%20option%3A%0A%20%20%20%20%22%22%22)%0A%20%20%20%20return%0A%0A%0A%40app.cell%0Adef%20_(Expr%2C%20Model%2C%20ObjectiveSense%2C%20Tree%2C%20path_id_make%2C%20path_route_calc%2C%20sys)%3A%0A%20%20%20%20def%20Portfolio(port_params%2C%20util_type%3D'HARA'%2C%20wrtLog%3DTrue)%3A%0A%20%20%20%20%20%20%20%20T%2C%20W_0%2C%20S%2C%20theta%2C%20S_v_0%2C%20r%2C%20U%2C%20q%20%3D%20port_params%0A%20%20%20%20%20%20%20%20M%20%3D%20Model('PORTFOLIO')%0A%20%20%20%20%20%20%20%20if%20wrtLog%3A%0A%20%20%20%20%20%20%20%20%20%20%20%20M.setLogHandler(sys.stdout)%0A%20%20%20%20%20%20%20%20Tree_1%20%3D%20Tree(M%2C%20T%2C%20W_0%2C%20S%2C%20theta%2C%20S_v_0%2C%20r%2C%20U)%0A%20%20%20%20%20%20%20%20Tree_1.level_make()%0A%20%20%20%20%20%20%20%20H%20%3D%20Tree_1.util_dispatch%5Butil_type%5D(Tree_1.levels%5BT%20-%201%5D.b_new)%0A%20%20%20%20%20%20%20%20path_ids%20%3D%20path_id_make(Tree_1.s%2C%20T)%0A%20%20%20%20%20%20%20%20path_probs%20%3D%20%5Bpath_route_calc(_p%2C%20Tree_1.s%2C%20q)%20for%20_p%20in%20path_ids%5D%0A%20%20%20%20%20%20%20%20Obj%20%3D%20Expr.dot(H%2C%20path_probs)%0A%20%20%20%20%20%20%20%20M.objective('PORTFOLIO_OBJ'%2C%20ObjectiveSense.Maximize%2C%20Obj)%0A%20%20%20%20%20%20%20%20M.solve()%0A%20%20%20%20%20%20%20%20utility_W0%20%3D%20M.primalObjValue()%0A%20%20%20%20%20%20%20%20ut_time%20%3D%20M.getSolverDoubleInfo('optimizerTime')%0A%20%20%20%20%20%20%20%20ut_iter%20%3D%20M.getSolverIntInfo('intpntIter')%0A%20%20%20%20%20%20%20%20return%20(M%2C%20Tree_1%2C%20utility_W0%2C%20path_ids%2C%20Obj%2C%20%5But_iter%2C%20ut_time%5D)%0A%20%20%20%20return%20(Portfolio%2C)%0A%0A%0A%40app.cell(hide_code%3DTrue)%0Adef%20_(mo)%3A%0A%20%20%20%20mo.md(r%22%22%22%0A%20%20%20%20%23%23%23%20Portfolio%20with%20call%20option%3A%0A%20%20%20%20%22%22%22)%0A%20%20%20%20return%0A%0A%0A%40app.cell(hide_code%3DTrue)%0Adef%20_(mo)%3A%0A%20%20%20%20mo.md(r%22%22%22%0A%20%20%20%20This%20model%20involves%20modifying%20the%20initial%20and%20the%20final%20budget%20constraints%2C%20adding%20a%20constraint%20on%20the%20new%20utility%2C%20creating%20a%20new%20objective%20(the%20option%20price)%20and%20re-optimizing%20the%20previous%20model.%20Fusion%20allows%20re-optimizing%20(this%20saves%20a%20considerable%20amount%20of%20time%2C%20which%20would%20otherwise%20be%20spent%20in%20re-building%20the%20model).%0A%20%20%20%20%22%22%22)%0A%20%20%20%20return%0A%0A%0A%40app.cell%0Adef%20_(Domain%2C%20Expr%2C%20ObjectiveSense%2C%20Portfolio%2C%20np%2C%20path_route_calc)%3A%0A%20%20%20%20def%20Option_Portfolio(port_params%2C%20K%2C%20util_type%3D'HARA'%2C%20writeLog%3DTrue%2C%20solver_info%3DFalse)%3A%0A%20%20%20%20%20%20%20%20T%2C%20W_0%2C%20S%2C%20theta%2C%20S_v_0%2C%20r%2C%20U%2C%20q%20%3D%20port_params%0A%20%20%20%20%20%20%20%20M%2C%20Tree_1%2C%20utility_W0%2C%20path_ids%2C%20Obj%2C%20obj_info%20%3D%20Portfolio(port_params%2C%20util_type%3Dutil_type%2C%20wrtLog%3DwriteLog)%0A%20%20%20%20%20%20%20%20path_Svs%20%3D%20np.asarray(%5Bpath_route_calc(_p%2C%20S.shape%5B0%5D%2C%20q%2C%20S%5B%3A%2C%200%5D)%20for%20_p%20in%20path_ids%5D)%0A%20%20%20%20%20%20%20%20call_profit%20%3D%20(path_Svs%20-%20K%20%2B%20abs(path_Svs%20-%20K))%20%2F%202%0A%20%20%20%20%20%20%20%20Call%20%3D%20M.variable('Call_Price'%2C%201%2C%20Domain.inRange(0.0%2C%20S_v_0%5B0%5D))%0A%20%20%20%20%20%20%20%20Tree_1.root_budget.update(Expr.neg(Call)%2C%20Call)%0A%20%20%20%20%20%20%20%20Tree_1.levels%5BT%20-%201%5D.budg_constr.update(call_profit.tolist())%0A%20%20%20%20%20%20%20%20M.constraint('E_geq_U'%2C%20Expr.sub(Obj%2C%20utility_W0)%2C%20Domain.greaterThan(0.0))%0A%20%20%20%20%20%20%20%20M.objective('Call_price_OBJECTIVE'%2C%20ObjectiveSense.Maximize%2C%20Call)%0A%20%20%20%20%20%20%20%20M.solve()%0A%20%20%20%20%20%20%20%20if%20solver_info%3A%0A%20%20%20%20%20%20%20%20%20%20%20%20price_time%20%3D%20M.getSolverDoubleInfo('optimizerTime')%0A%20%20%20%20%20%20%20%20%20%20%20%20price_iter%20%3D%20M.getSolverIntInfo('intpntIter')%0A%20%20%20%20%20%20%20%20%20%20%20%20n_cons%20%3D%20M.getSolverIntInfo('optNumcon')%0A%20%20%20%20%20%20%20%20%20%20%20%20n_vars%20%3D%20M.getSolverIntInfo('optNumvar')%0A%20%20%20%20%20%20%20%20%20%20%20%20return%20(M.primalObjValue()%2C%20n_cons%2C%20n_vars%2C%20obj_info%5B0%5D%2C%20obj_info%5B1%5D%2C%20price_iter%2C%20price_time)%0A%20%20%20%20%20%20%20%20else%3A%0A%20%20%20%20%20%20%20%20%20%20%20%20return%20M.primalObjValue()%0A%20%20%20%20return%20(Option_Portfolio%2C)%0A%0A%0A%40app.cell(hide_code%3DTrue)%0Adef%20_(mo)%3A%0A%20%20%20%20mo.md(r%22%22%22%0A%20%20%20%20Now%2C%20to%20demonstrate%20the%20model%2C%20we%20solve%20it%20for%20two%20simple%20cases.%20The%20values%20taken%20below%20are%20the%20same%20as%20mentioned%20in%20the%20paper%20(%3Ca%20href%3D%22https%3A%2F%2Fwww.sciencedirect.com%2Fscience%2Farticle%2Fpii%2FS0168927498001044%22%3EAndersen%20et.%20al.%3C%2Fa%3E).%0A%20%20%20%20%22%22%22)%0A%20%20%20%20return%0A%0A%0A%40app.cell%0Adef%20_(Option_Portfolio%2C%20np%2C%20price_vector_abc%2C%20price_vector_z)%3A%0A%20%20%20%20T%20%3D%205%0A%20%20%20%20sigma%20%3D%20np.asarray(%5B0.2%5D)%0A%20%20%20%20q%20%3D%20np.ones(3)%20%2F%203%0A%20%20%20%20eps%20%3D%20np.asarray(%5B%5Bnp.sqrt(2)%5D%2C%20%5B-1%20%2F%20np.sqrt(2)%5D%2C%20%5B-1%20%2F%20np.sqrt(2)%5D%5D)%0A%20%20%20%20T_horizon%20%3D%201%20%2F%204%0A%20%20%20%20dT%20%3D%20T_horizon%20%2F%20T%0A%20%20%20%20theta%20%3D%20%5B0.005%5D%0A%20%20%20%20S_v_0%20%3D%20%5B1.0%5D%0A%20%20%20%20r%20%3D%201.06%20**%20dT%20-%201%0A%20%20%20%20W_0%20%3D%201.0%0A%20%20%20%20gamma%20%3D%200.3%0A%20%20%20%20b%20%3D%201%0A%20%20%20%20c%20%3D%200.2%0A%20%20%20%20a%20%3D%20b%20%2F%20(1%20%2F%20c%20%2B%20W_0%20%2F%20(gamma%20-%201))%0A%20%20%20%20K%20%3D%201%0A%20%20%20%20mu%20%3D%200.15%0A%20%20%20%20Z%20%3D%20price_vector_z(sigma%2C%20eps%2C%20dT%2C%20q)%0A%20%20%20%20S_coeffs%20%3D%20np.expand_dims(price_vector_abc(sigma%2C%20eps%2C%20dT%2C%20q%2C%20mu%2C%20Z)%2C%20axis%3D1)%0A%20%20%20%20_util_paras%20%3D%20np.asarray(%5Ba%2C%20b%2C%20gamma%5D)%0A%20%20%20%20_input_pars%20%3D%20%5BT%2C%20W_0%2C%20S_coeffs%2C%20theta%2C%20S_v_0%2C%20r%2C%20_util_paras%2C%20q%5D%0A%20%20%20%20print('%5Cn%5CnCall%20option%20price%20%3D%20%7B%7D'.format(Option_Portfolio(_input_pars%2C%20K)))%0A%20%20%20%20return%20K%2C%20S_coeffs%2C%20S_v_0%2C%20T%2C%20W_0%2C%20b%2C%20c%2C%20eps%2C%20mu%2C%20q%2C%20r%2C%20sigma%2C%20theta%0A%0A%0A%40app.cell%0Adef%20_(K%2C%20Option_Portfolio%2C%20S_coeffs%2C%20S_v_0%2C%20T%2C%20W_0%2C%20c%2C%20q%2C%20r%2C%20theta)%3A%0A%20%20%20%20_input_pars%20%3D%20%5BT%2C%20W_0%2C%20S_coeffs%2C%20theta%2C%20S_v_0%2C%20r%2C%20c%2C%20q%5D%0A%20%20%20%20print('%5Cn%5CnCall%20option%20price%20%3D%20%7B%7D'.format(Option_Portfolio(_input_pars%2C%20K%2C%20util_type%3D'EXP')))%0A%20%20%20%20return%0A%0A%0A%40app.cell(hide_code%3DTrue)%0Adef%20_(mo)%3A%0A%20%20%20%20mo.md(r%22%22%22%0A%20%20%20%20%23%20Test-cases%3A%0A%20%20%20%20%22%22%22)%0A%20%20%20%20return%0A%0A%0A%40app.cell(hide_code%3DTrue)%0Adef%20_(mo)%3A%0A%20%20%20%20mo.md(r%22%22%22%0A%20%20%20%20%23%23%23%20Reservation%20price%20sensitivity%20for%20the%20choice%20of%20utility%20function%3A%0A%20%20%20%20%22%22%22)%0A%20%20%20%20return%0A%0A%0A%40app.cell(hide_code%3DTrue)%0Adef%20_(mo)%3A%0A%20%20%20%20mo.md(r%22%22%22%0A%20%20%20%20%3Cb%3E(a.)%20Dependency%20of%20the%20reservation%20purchase%20price%20on%20%24%5Cgamma%24%2C%20%24ARA(W_0)%24%20and%20%24%5Coverline%7BT%7D%24.%3C%2Fb%3E%20(Consider%20Table%203%2C%20%3Ca%20href%3D%22https%3A%2F%2Fwww.sciencedirect.com%2Fscience%2Farticle%2Fpii%2FS0168927498001044%22%3EAndersen%20et.%20al.%3C%2Fa%3E)%0A%20%20%20%20%22%22%22)%0A%20%20%20%20return%0A%0A%0A%40app.cell%0Adef%20_(K%2C%20Option_Portfolio%2C%20S_coeffs%2C%20S_v_0%2C%20T%2C%20W_0%2C%20b%2C%20c%2C%20np%2C%20q%2C%20r%2C%20theta)%3A%0A%20%20%20%20gamma_1%20%3D%20%5B-4.0%2C%20-2.0%2C%20-0.9%2C%20-0.3%2C%200.3%2C%200.6%5D%0A%20%20%20%20print('ARA%20%3D%200.2%20%3B%20Time%20Horizon%20%3D%201%2F4%20year')%0A%20%20%20%20print('%7B0%3A%5E6%7D%20%20%7B1%3A%5E9%7D'.format('gamma'%2C%20'C'))%0A%20%20%20%20for%20_g%20in%20gamma_1%3A%0A%20%20%20%20%20%20%20%20a_1%20%3D%20b%20%2F%20(1%20%2F%20c%20%2B%20W_0%20%2F%20(_g%20-%201))%0A%20%20%20%20%20%20%20%20_util_paras%20%3D%20np.asarray(%5Ba_1%2C%20b%2C%20_g%5D)%0A%20%20%20%20%20%20%20%20_input_pars%20%3D%20%5BT%2C%20W_0%2C%20S_coeffs%2C%20theta%2C%20S_v_0%2C%20r%2C%20_util_paras%2C%20q%5D%0A%20%20%20%20%20%20%20%20print('%7B0%3A%5E%205.1f%7D%20%20%7B1%3A%5E9.7f%7D'.format(_g%2C%20Option_Portfolio(_input_pars%2C%20K%2C%20writeLog%3DFalse)))%0A%20%20%20%20_input_pars%20%3D%20%5BT%2C%20W_0%2C%20S_coeffs%2C%20theta%2C%20S_v_0%2C%20r%2C%20c%2C%20q%5D%0A%20%20%20%20print('%7B0%3A%5E5%7D%20%20%7B1%3A%5E9.7f%7D'.format('exp'%2C%20Option_Portfolio(_input_pars%2C%20K%2C%20util_type%3D'EXP'%2C%20writeLog%3DFalse)))%0A%20%20%20%20return%20(gamma_1%2C)%0A%0A%0A%40app.cell%0Adef%20_(%0A%20%20%20%20K%2C%0A%20%20%20%20Option_Portfolio%2C%0A%20%20%20%20S_coeffs%2C%0A%20%20%20%20S_v_0%2C%0A%20%20%20%20T%2C%0A%20%20%20%20W_0%2C%0A%20%20%20%20b%2C%0A%20%20%20%20gamma_1%2C%0A%20%20%20%20np%2C%0A%20%20%20%20q%2C%0A%20%20%20%20r%2C%0A%20%20%20%20theta%2C%0A)%3A%0A%20%20%20%20c_11%20%3D%201.0%0A%20%20%20%20print('ARA%20%3D%201.0%20%3B%20Time%20Horizon%20%3D%201%2F4%20year')%0A%20%20%20%20print('%7B0%3A%5E6%7D%20%20%7B1%3A%5E9%7D'.format('gamma'%2C%20'C'))%0A%20%20%20%20for%20_g%20in%20gamma_1%5B0%3A4%5D%3A%0A%20%20%20%20%20%20%20%20a_2%20%3D%20b%20%2F%20(1%20%2F%20c_11%20%2B%20W_0%20%2F%20(_g%20-%201))%0A%20%20%20%20%20%20%20%20_util_paras%20%3D%20np.asarray(%5Ba_2%2C%20b%2C%20_g%5D)%0A%20%20%20%20%20%20%20%20_input_pars%20%3D%20%5BT%2C%20W_0%2C%20S_coeffs%2C%20theta%2C%20S_v_0%2C%20r%2C%20_util_paras%2C%20q%5D%0A%20%20%20%20%20%20%20%20print('%7B0%3A%5E%205.1f%7D%20%20%7B1%3A%5E9.7f%7D'.format(_g%2C%20Option_Portfolio(_input_pars%2C%20K%2C%20writeLog%3DFalse)))%0A%20%20%20%20_input_pars%20%3D%20%5BT%2C%20W_0%2C%20S_coeffs%2C%20theta%2C%20S_v_0%2C%20r%2C%20c_11%2C%20q%5D%0A%20%20%20%20print('%7B0%3A%5E5%7D%20%20%7B1%3A%5E9.7f%7D'.format('exp'%2C%20Option_Portfolio(_input_pars%2C%20K%2C%20util_type%3D'EXP'%2C%20writeLog%3DFalse)))%0A%20%20%20%20return%0A%0A%0A%40app.cell%0Adef%20_(%0A%20%20%20%20K%2C%0A%20%20%20%20Option_Portfolio%2C%0A%20%20%20%20S_v_0%2C%0A%20%20%20%20T%2C%0A%20%20%20%20W_0%2C%0A%20%20%20%20b%2C%0A%20%20%20%20eps%2C%0A%20%20%20%20gamma_1%2C%0A%20%20%20%20mu%2C%0A%20%20%20%20np%2C%0A%20%20%20%20price_vector_abc%2C%0A%20%20%20%20price_vector_z%2C%0A%20%20%20%20q%2C%0A%20%20%20%20sigma%2C%0A%20%20%20%20theta%2C%0A)%3A%0A%20%20%20%20T_horizon_1%20%3D%209%0A%20%20%20%20dT_1%20%3D%20T_horizon_1%20%2F%20T%0A%20%20%20%20_Z%20%3D%20price_vector_z(sigma%2C%20eps%2C%20dT_1%2C%20q)%0A%20%20%20%20S_coeffs_1%20%3D%20np.expand_dims(price_vector_abc(sigma%2C%20eps%2C%20dT_1%2C%20q%2C%20mu%2C%20_Z)%2C%20axis%3D1)%0A%20%20%20%20r_1%20%3D%201.06%20**%20dT_1%20-%201%0A%20%20%20%20c_2%20%3D%200.2%0A%20%20%20%20print('ARA%20%3D%200.2%20%3B%20Time%20Horizon%20%3D%209%20years')%0A%20%20%20%20print('%7B0%3A%5E6%7D%20%20%7B1%3A%5E9%7D'.format('gamma'%2C%20'C'))%0A%20%20%20%20for%20_g%20in%20gamma_1%3A%0A%20%20%20%20%20%20%20%20a_3%20%3D%20b%20%2F%20(1%20%2F%20c_2%20%2B%20W_0%20%2F%20(_g%20-%201))%0A%20%20%20%20%20%20%20%20_util_paras%20%3D%20np.asarray(%5Ba_3%2C%20b%2C%20_g%5D)%0A%20%20%20%20%20%20%20%20_input_pars%20%3D%20%5BT%2C%20W_0%2C%20S_coeffs_1%2C%20theta%2C%20S_v_0%2C%20r_1%2C%20_util_paras%2C%20q%5D%0A%20%20%20%20%20%20%20%20print('%7B0%3A%5E%205.1f%7D%20%20%7B1%3A%5E9.7f%7D'.format(_g%2C%20Option_Portfolio(_input_pars%2C%20K%2C%20writeLog%3DFalse)))%0A%20%20%20%20_input_pars%20%3D%20%5BT%2C%20W_0%2C%20S_coeffs_1%2C%20theta%2C%20S_v_0%2C%20r_1%2C%20c_2%2C%20q%5D%0A%20%20%20%20print('%7B0%3A%5E5%7D%20%20%7B1%3A%5E9.7f%7D'.format('exp'%2C%20Option_Portfolio(_input_pars%2C%20K%2C%20util_type%3D'EXP'%2C%20writeLog%3DFalse)))%0A%20%20%20%20return%20S_coeffs_1%2C%20r_1%0A%0A%0A%40app.cell%0Adef%20_(%0A%20%20%20%20K%2C%0A%20%20%20%20Option_Portfolio%2C%0A%20%20%20%20S_coeffs_1%2C%0A%20%20%20%20S_v_0%2C%0A%20%20%20%20T%2C%0A%20%20%20%20W_0%2C%0A%20%20%20%20b%2C%0A%20%20%20%20gamma_1%2C%0A%20%20%20%20np%2C%0A%20%20%20%20q%2C%0A%20%20%20%20r_1%2C%0A%20%20%20%20theta%2C%0A)%3A%0A%20%20%20%20c_3%20%3D%201.0%0A%20%20%20%20print('ARA%20%3D%201.0%20%3B%20Time%20Horizon%20%3D%209%20years')%0A%20%20%20%20print('%7B0%3A%5E6%7D%20%20%7B1%3A%5E9%7D'.format('gamma'%2C%20'C'))%0A%20%20%20%20for%20_g%20in%20gamma_1%5B0%3A4%5D%3A%0A%20%20%20%20%20%20%20%20a_4%20%3D%20b%20%2F%20(1%20%2F%20c_3%20%2B%20W_0%20%2F%20(_g%20-%201))%0A%20%20%20%20%20%20%20%20_util_paras%20%3D%20np.asarray(%5Ba_4%2C%20b%2C%20_g%5D)%0A%20%20%20%20%20%20%20%20_input_pars%20%3D%20%5BT%2C%20W_0%2C%20S_coeffs_1%2C%20theta%2C%20S_v_0%2C%20r_1%2C%20_util_paras%2C%20q%5D%0A%20%20%20%20%20%20%20%20print('%7B0%3A%5E%205.1f%7D%20%20%7B1%3A%5E9.7f%7D'.format(_g%2C%20Option_Portfolio(_input_pars%2C%20K%2C%20writeLog%3DFalse)))%0A%20%20%20%20_input_pars%20%3D%20%5BT%2C%20W_0%2C%20S_coeffs_1%2C%20theta%2C%20S_v_0%2C%20r_1%2C%20c_3%2C%20q%5D%0A%20%20%20%20print('%7B0%3A%5E5%7D%20%20%7B1%3A%5E9.7f%7D'.format('exp'%2C%20Option_Portfolio(_input_pars%2C%20K%2C%20util_type%3D'EXP'%2C%20writeLog%3DFalse)))%0A%20%20%20%20return%0A%0A%0A%40app.cell(hide_code%3DTrue)%0Adef%20_(mo)%3A%0A%20%20%20%20mo.md(r%22%22%22%0A%20%20%20%20%3Cb%3E(b.)%20Dependency%20of%20the%20reservation%20purchase%20price%20on%20the%20initial%20level%20of%20Relative%20Risk%20Aversion%2C%20%24RRA(W_0)%24%3C%2Fb%3E%20(Consider%20Table%204%2C%20%3Ca%20href%3D%22https%3A%2F%2Fwww.sciencedirect.com%2Fscience%2Farticle%2Fpii%2FS0168927498001044%22%3EAndersen%20et.%20al.%3C%2Fa%3E)%0A%20%20%20%20%22%22%22)%0A%20%20%20%20return%0A%0A%0A%40app.cell%0Adef%20_(%0A%20%20%20%20K%2C%0A%20%20%20%20Option_Portfolio%2C%0A%20%20%20%20S_v_0%2C%0A%20%20%20%20eps%2C%0A%20%20%20%20mu%2C%0A%20%20%20%20np%2C%0A%20%20%20%20price_vector_abc%2C%0A%20%20%20%20price_vector_z%2C%0A%20%20%20%20q%2C%0A%20%20%20%20sigma%2C%0A%20%20%20%20theta%2C%0A)%3A%0A%20%20%20%20T_1%20%3D%205%0A%20%20%20%20T_horizon_2%20%3D%201%20%2F%204%0A%20%20%20%20dT_2%20%3D%20T_horizon_2%20%2F%20T_1%0A%20%20%20%20r_2%20%3D%201.06%20**%20dT_2%20-%201%0A%20%20%20%20W_0_1%20%3D%20%5B1.0%2C%204.0%2C%208.0%5D%0A%20%20%20%20gamma_2%20%3D%20-1.0%0A%20%20%20%20b_1%20%3D%201%0A%20%20%20%20c_4%20%3D%200.2%0A%20%20%20%20Z2%20%3D%20price_vector_z(sigma%2C%20eps%2C%20dT_2%2C%20q)%0A%20%20%20%20S_coeffs_2%20%3D%20np.expand_dims(price_vector_abc(sigma%2C%20eps%2C%20dT_2%2C%20q%2C%20mu%2C%20Z2)%2C%20axis%3D1)%0A%20%20%20%20print('ARA%20%3D%200.2%20%3B%20Time%20Horizon%20%3D%201%2F4%20year')%0A%20%20%20%20print('%7B0%3A%5E5%7D%20%20%7B1%3A%5E5%7D%20%20%7B2%3A%5E9%7D'.format('W_0'%2C%20'RRA'%2C%20'C'))%0A%20%20%20%20for%20_w0%20in%20W_0_1%3A%0A%20%20%20%20%20%20%20%20a_5%20%3D%20b_1%20%2F%20(1%20%2F%20c_4%20%2B%20_w0%20%2F%20(gamma_2%20-%201))%0A%20%20%20%20%20%20%20%20_util_paras%20%3D%20np.asarray(%5Ba_5%2C%20b_1%2C%20gamma_2%5D)%0A%20%20%20%20%20%20%20%20_input_pars%20%3D%20%5BT_1%2C%20_w0%2C%20S_coeffs_2%2C%20theta%2C%20S_v_0%2C%20r_2%2C%20_util_paras%2C%20q%5D%0A%20%20%20%20%20%20%20%20print('%7B0%3A%5E5.0f%7D%20%20%7B1%3A%5E5.1f%7D%20%20%7B2%3A%5E9.7f%7D'.format(_w0%2C%20c_4%20*%20_w0%2C%20Option_Portfolio(_input_pars%2C%20K%2C%20writeLog%3DFalse)))%0A%20%20%20%20_input_pars%20%3D%20%5BT_1%2C%201.0%2C%20S_coeffs_2%2C%20theta%2C%20S_v_0%2C%20r_2%2C%20c_4%2C%20q%5D%0A%20%20%20%20print('%7B0%3A%5E5%7D%20%20%7B1%3A%5E5%7D%20%20%7B2%3A%5E9.7f%7D'.format('exp'%2C%20''%2C%20Option_Portfolio(_input_pars%2C%20K%2C%20util_type%3D'EXP'%2C%20writeLog%3DFalse)))%0A%20%20%20%20return%20T_1%2C%20W_0_1%2C%20b_1%2C%20c_4%2C%20gamma_2%0A%0A%0A%40app.cell%0Adef%20_(%0A%20%20%20%20K%2C%0A%20%20%20%20Option_Portfolio%2C%0A%20%20%20%20S_v_0%2C%0A%20%20%20%20T_1%2C%0A%20%20%20%20W_0_1%2C%0A%20%20%20%20b_1%2C%0A%20%20%20%20c_4%2C%0A%20%20%20%20eps%2C%0A%20%20%20%20gamma_2%2C%0A%20%20%20%20mu%2C%0A%20%20%20%20np%2C%0A%20%20%20%20price_vector_abc%2C%0A%20%20%20%20price_vector_z%2C%0A%20%20%20%20q%2C%0A%20%20%20%20sigma%2C%0A%20%20%20%20theta%2C%0A)%3A%0A%20%20%20%20T_horizon_3%20%3D%209%0A%20%20%20%20dT_3%20%3D%20T_horizon_3%20%2F%20T_1%0A%20%20%20%20r_3%20%3D%201.06%20**%20dT_3%20-%201%0A%20%20%20%20Z3%20%3D%20price_vector_z(sigma%2C%20eps%2C%20dT_3%2C%20q)%0A%20%20%20%20S_coeffs_3%20%3D%20np.expand_dims(price_vector_abc(sigma%2C%20eps%2C%20dT_3%2C%20q%2C%20mu%2C%20Z3)%2C%20axis%3D1)%0A%20%20%20%20print('ARA%20%3D%200.2%20%3B%20Time%20Horizon%20%3D%209%20years')%0A%20%20%20%20print('%7B0%3A%5E5%7D%20%20%7B1%3A%5E5%7D%20%20%7B2%3A%5E9%7D'.format('W_0'%2C%20'RRA'%2C%20'C'))%0A%20%20%20%20for%20_w0%20in%20W_0_1%3A%0A%20%20%20%20%20%20%20%20a_6%20%3D%20b_1%20%2F%20(1%20%2F%20c_4%20%2B%20_w0%20%2F%20(gamma_2%20-%201))%0A%20%20%20%20%20%20%20%20_util_paras%20%3D%20np.asarray(%5Ba_6%2C%20b_1%2C%20gamma_2%5D)%0A%20%20%20%20%20%20%20%20_input_pars%20%3D%20%5BT_1%2C%20_w0%2C%20S_coeffs_3%2C%20theta%2C%20S_v_0%2C%20r_3%2C%20_util_paras%2C%20q%5D%0A%20%20%20%20%20%20%20%20print('%7B0%3A%5E5.0f%7D%20%20%7B1%3A%5E5.1f%7D%20%20%7B2%3A%5E9.7f%7D'.format(_w0%2C%20c_4%20*%20_w0%2C%20Option_Portfolio(_input_pars%2C%20K%2C%20writeLog%3DFalse)))%0A%20%20%20%20_input_pars%20%3D%20%5BT_1%2C%201.0%2C%20S_coeffs_3%2C%20theta%2C%20S_v_0%2C%20r_3%2C%20c_4%2C%20q%5D%0A%20%20%20%20print('%7B0%3A%5E5%7D%20%20%7B1%3A%5E5%7D%20%20%7B2%3A%5E9.7f%7D'.format('exp'%2C%20''%2C%20Option_Portfolio(_input_pars%2C%20K%2C%20util_type%3D'EXP'%2C%20writeLog%3DFalse)))%0A%20%20%20%20return%0A%0A%0A%40app.cell(hide_code%3DTrue)%0Adef%20_(mo)%3A%0A%20%20%20%20mo.md(r%22%22%22%0A%20%20%20%20%3Cb%3E(c.)%20Convergence%20of%20the%20reservation%20purchase%20price.%3C%2Fb%3E%20(Consider%20Table%205%2C%20%3Ca%20href%3D%22https%3A%2F%2Fwww.sciencedirect.com%2Fscience%2Farticle%2Fpii%2FS0168927498001044%22%3EAndersen%20et.%20al.%3C%2Fa%3E)%0A%20%20%20%20%22%22%22)%0A%20%20%20%20return%0A%0A%0A%40app.cell%0Adef%20_(%0A%20%20%20%20K%2C%0A%20%20%20%20Option_Portfolio%2C%0A%20%20%20%20S_v_0%2C%0A%20%20%20%20eps%2C%0A%20%20%20%20mu%2C%0A%20%20%20%20np%2C%0A%20%20%20%20price_vector_abc%2C%0A%20%20%20%20price_vector_z%2C%0A%20%20%20%20q%2C%0A%20%20%20%20sigma%2C%0A%20%20%20%20theta%2C%0A)%3A%0A%20%20%20%20T_horizon_4%20%3D%201%20%2F%204%0A%20%20%20%20W_0_2%20%3D%201.0%0A%20%20%20%20gamma_3%20%3D%200.3%0A%20%20%20%20b_2%20%3D%200.0%0A%20%20%20%20c_5%20%3D%200.7%0A%20%20%20%20a_7%20%3D%201%20-%20gamma_3%0A%20%20%20%20_util_paras%20%3D%20np.asarray(%5Ba_7%2C%20b_2%2C%20gamma_3%5D)%0A%20%20%20%20C_trio%20%3D%20%5B%5D%0A%20%20%20%20print('%7B0%3A%5E3%7D%20%20%7B1%3A12%7D%20%20%7B2%3A12%7D%20%20%7B3%3A%5E12%7D'.format('%20'%2C%20'-exp(-0.7W)'%2C%20'(W%5E0.3)%2F0.3'%2C%20'%20'))%0A%20%20%20%20print('%7B0%3A%5E3%7D%20%20%7B1%3A%5E12%7D%20%20%7B2%3A%5E12%7D%20%20%7B3%3A%5E12%7D'.format('T'%2C%20'C_exp'%2C%20'C_pow'%2C%20'CRR'))%0A%20%20%20%20for%20T_2%20in%20np.arange(1%2C%2012)%3A%0A%20%20%20%20%20%20%20%20dT_4%20%3D%20T_horizon_4%20%2F%20T_2%0A%20%20%20%20%20%20%20%20r_4%20%3D%201.06%20**%20dT_4%20-%201%0A%20%20%20%20%20%20%20%20Z4%20%3D%20price_vector_z(sigma%2C%20eps%2C%20dT_4%2C%20q)%0A%20%20%20%20%20%20%20%20S_coeffs_4%20%3D%20np.expand_dims(price_vector_abc(sigma%2C%20eps%2C%20dT_4%2C%20q%2C%20mu%2C%20Z4)%2C%20axis%3D1)%0A%20%20%20%20%20%20%20%20_input_pars%20%3D%20%5BT_2%2C%20W_0_2%2C%20S_coeffs_4%2C%20theta%2C%20S_v_0%2C%20r_4%2C%20_util_paras%2C%20q%5D%0A%20%20%20%20%20%20%20%20_C_pow%20%3D%20Option_Portfolio(_input_pars%2C%20K%2C%20writeLog%3DFalse)%0A%20%20%20%20%20%20%20%20_input_pars%20%3D%20%5BT_2%2C%20W_0_2%2C%20S_coeffs_4%2C%20%5B0.0%5D%2C%20S_v_0%2C%20r_4%2C%20_util_paras%2C%20q%5D%0A%20%20%20%20%20%20%20%20CRR%20%3D%20Option_Portfolio(_input_pars%2C%20K%2C%20writeLog%3DFalse)%0A%20%20%20%20%20%20%20%20_input_pars%20%3D%20%5BT_2%2C%20W_0_2%2C%20S_coeffs_4%2C%20theta%2C%20S_v_0%2C%20r_4%2C%20c_5%2C%20q%5D%0A%20%20%20%20%20%20%20%20_C_exp%20%3D%20Option_Portfolio(_input_pars%2C%20K%2C%20util_type%3D'EXP'%2C%20writeLog%3DFalse)%0A%20%20%20%20%20%20%20%20print('%7B0%3A%5E3d%7D%20%20%7B1%3A%5E12.10f%7D%20%20%7B2%3A%5E12.10f%7D%20%20%7B3%3A%5E12.10f%7D'.format(T_2%2C%20_C_exp%2C%20_C_pow%2C%20CRR))%0A%20%20%20%20%20%20%20%20C_trio.append(%5B_C_exp%2C%20_C_pow%2C%20CRR%5D)%0A%20%20%20%20return%20T_horizon_4%2C%20W_0_2%0A%0A%0A%40app.cell(hide_code%3DTrue)%0Adef%20_(mo)%3A%0A%20%20%20%20mo.md(r%22%22%22%0A%20%20%20%20%3Cb%3E(d.)%20Reservation%20purchase%20price%20dependence%20on%20absolute%20risk%20aversion%20(Exponential%20utility).%3C%2Fb%3E%20(Consider%20Table%206%2C%20%3Ca%20href%3D%22https%3A%2F%2Fwww.sciencedirect.com%2Fscience%2Farticle%2Fpii%2FS0168927498001044%22%3EAndersen%20et.%20al.%3C%2Fa%3E)%0A%20%20%20%20%22%22%22)%0A%20%20%20%20return%0A%0A%0A%40app.cell%0Adef%20_(%0A%20%20%20%20K%2C%0A%20%20%20%20Option_Portfolio%2C%0A%20%20%20%20S_v_0%2C%0A%20%20%20%20T_horizon_4%2C%0A%20%20%20%20W_0_2%2C%0A%20%20%20%20eps%2C%0A%20%20%20%20mu%2C%0A%20%20%20%20np%2C%0A%20%20%20%20price_vector_abc%2C%0A%20%20%20%20price_vector_z%2C%0A%20%20%20%20q%2C%0A%20%20%20%20sigma%2C%0A)%3A%0A%20%20%20%20T_3%20%3D%209%0A%20%20%20%20dT_5%20%3D%20T_horizon_4%20%2F%20T_3%0A%20%20%20%20theta_1%20%3D%20%5B0.005%5D%0A%20%20%20%20r_5%20%3D%201.06%20**%20dT_5%20-%201%0A%20%20%20%20c_6%20%3D%20%5B0.1%2C%200.2%2C%200.4%2C%200.8%2C%201.0%2C%202.0%2C%204.0%5D%0A%20%20%20%20Z5%20%3D%20price_vector_z(sigma%2C%20eps%2C%20dT_5%2C%20q)%0A%20%20%20%20S_coeffs_5%20%3D%20np.expand_dims(price_vector_abc(sigma%2C%20eps%2C%20dT_5%2C%20q%2C%20mu%2C%20Z5)%2C%20axis%3D1)%0A%20%20%20%20print('%7B0%3A%5E8%7D%20%20%7B1%3A%5E12%7D'.format('ARA(W_0)'%2C%20'C%5BARA(W_0)%5D'))%0A%20%20%20%20C_ara%20%3D%20%5B%5D%0A%20%20%20%20for%20kappa%20in%20c_6%3A%0A%20%20%20%20%20%20%20%20_input_pars%20%3D%20%5BT_3%2C%20W_0_2%2C%20S_coeffs_5%2C%20theta_1%2C%20S_v_0%2C%20r_5%2C%20kappa%2C%20q%5D%0A%20%20%20%20%20%20%20%20_C_exp%20%3D%20Option_Portfolio(_input_pars%2C%20K%2C%20util_type%3D'EXP'%2C%20writeLog%3DFalse)%0A%20%20%20%20%20%20%20%20print('%7B0%3A%5E8.2f%7D%20%20%7B1%3A%5E12.10f%7D'.format(kappa%2C%20_C_exp))%0A%20%20%20%20%20%20%20%20C_ara.append(_C_exp)%0A%20%20%20%20return%20S_coeffs_5%2C%20T_3%2C%20dT_5%2C%20r_5%2C%20theta_1%0A%0A%0A%40app.cell(hide_code%3DTrue)%0Adef%20_(mo)%3A%0A%20%20%20%20mo.md(r%22%22%22%0A%20%20%20%20%3Cb%3E(e.)%20Reservation%20purchase%20price%20dependence%20on%20absolute%20risk%20aversion%20(Power%20utility).%3C%2Fb%3E%20(Consider%20Table%207%2C%20%3Ca%20href%3D%22https%3A%2F%2Fwww.sciencedirect.com%2Fscience%2Farticle%2Fpii%2FS0168927498001044%22%3EAndersen%20et.%20al.%3C%2Fa%3E)%0A%20%20%20%20%22%22%22)%0A%20%20%20%20return%0A%0A%0A%40app.cell%0Adef%20_(K%2C%20Option_Portfolio%2C%20S_coeffs_5%2C%20S_v_0%2C%20T_3%2C%20W_0_2%2C%20np%2C%20q%2C%20r_5%2C%20theta_1)%3A%0A%20%20%20%20_eta%20%3D%20np.linspace(0.1%2C%200.9%2C%209)%0A%20%20%20%20a_8%20%3D%201%0A%20%20%20%20b_3%20%3D%200.0%0A%20%20%20%20print('%7B0%3A%5E5%7D%20%20%7B1%3A%5E12%7D'.format('eta'%2C%20'C%5BARA(W_0)%5D'))%0A%20%20%20%20C_eta%20%3D%20%5B%5D%0A%20%20%20%20for%20n%20in%20_eta%3A%0A%20%20%20%20%20%20%20%20gamma_4%20%3D%201%20-%20n%0A%20%20%20%20%20%20%20%20_util_paras%20%3D%20np.asarray(%5Ba_8%2C%20b_3%2C%20gamma_4%5D)%0A%20%20%20%20%20%20%20%20_input_pars%20%3D%20%5BT_3%2C%20W_0_2%2C%20S_coeffs_5%2C%20theta_1%2C%20S_v_0%2C%20r_5%2C%20_util_paras%2C%20q%5D%0A%20%20%20%20%20%20%20%20_C_pow%20%3D%20Option_Portfolio(_input_pars%2C%20K%2C%20writeLog%3DFalse)%0A%20%20%20%20%20%20%20%20print('%7B0%3A%5E5.2f%7D%20%20%7B1%3A%5E12.10f%7D'.format(n%2C%20_C_pow))%0A%20%20%20%20%20%20%20%20C_eta.append(_C_pow)%0A%20%20%20%20return%20a_8%2C%20b_3%0A%0A%0A%40app.cell(hide_code%3DTrue)%0Adef%20_(mo)%3A%0A%20%20%20%20mo.md(r%22%22%22%0A%20%20%20%20%3Cb%3E(f.)%20Reservation%20purchase%20price%20dependence%20on%20initial%20wealth%20(Power%20utility%20with%20%24%5Ceta%20%3D%200.7%24).%3C%2Fb%3E%20(Consider%20Table%208%2C%20%3Ca%20href%3D%22https%3A%2F%2Fwww.sciencedirect.com%2Fscience%2Farticle%2Fpii%2FS0168927498001044%22%3EAndersen%20et.%20al.%3C%2Fa%3E)%0A%20%20%20%20%22%22%22)%0A%20%20%20%20return%0A%0A%0A%40app.cell%0Adef%20_(%0A%20%20%20%20K%2C%0A%20%20%20%20Option_Portfolio%2C%0A%20%20%20%20S_coeffs_5%2C%0A%20%20%20%20S_v_0%2C%0A%20%20%20%20T_3%2C%0A%20%20%20%20a_8%2C%0A%20%20%20%20b_3%2C%0A%20%20%20%20np%2C%0A%20%20%20%20q%2C%0A%20%20%20%20r_5%2C%0A%20%20%20%20theta_1%2C%0A)%3A%0A%20%20%20%20_eta%20%3D%200.7%0A%20%20%20%20W_0_3%20%3D%20%5B0.25%2C%200.5%2C%201.0%2C%202.0%2C%204.0%2C%208.0%5D%0A%20%20%20%20gamma_5%20%3D%201%20-%20_eta%0A%20%20%20%20_util_paras%20%3D%20np.asarray(%5Ba_8%2C%20b_3%2C%20gamma_5%5D)%0A%20%20%20%20print('%7B0%3A%5E5%7D%20%20%7B1%3A%5E12%7D'.format('W_0'%2C%20'C_pow(W_0)'))%0A%20%20%20%20C_w0%20%3D%20%5B%5D%0A%20%20%20%20for%20_w0%20in%20W_0_3%3A%0A%20%20%20%20%20%20%20%20_input_pars%20%3D%20%5BT_3%2C%20_w0%2C%20S_coeffs_5%2C%20theta_1%2C%20S_v_0%2C%20r_5%2C%20_util_paras%2C%20q%5D%0A%20%20%20%20%20%20%20%20_C_pow%20%3D%20Option_Portfolio(_input_pars%2C%20K%2C%20writeLog%3DFalse)%0A%20%20%20%20%20%20%20%20print('%7B0%3A%5E5.2f%7D%20%20%7B1%3A%5E12.10f%7D'.format(_w0%2C%20_C_pow))%0A%20%20%20%20%20%20%20%20C_w0.append(_C_pow)%0A%20%20%20%20return%0A%0A%0A%40app.cell(hide_code%3DTrue)%0Adef%20_(mo)%3A%0A%20%20%20%20mo.md(r%22%22%22%0A%20%20%20%20%23%23%23%20The%20effect%20of%20diversification%20opportunities%20on%20the%20reservation%20purchase%20price.%0A%20%20%20%20%22%22%22)%0A%20%20%20%20return%0A%0A%0A%40app.cell(hide_code%3DTrue)%0Adef%20_(mo)%3A%0A%20%20%20%20mo.md(r%22%22%22%0A%20%20%20%20The%20model%20presented%20above%20is%20fairly%20general%2C%20and%20therefore%20we%20can%20easily%20extend%20its%20application%20to%20the%20case%20where%20trade%20takes%20place%20in%20multiple%20securities.%20For%20illustration%2C%20we%20present%20the%20case%20where%20there%20are%20two%20risky%20securities%2C%20following%20%3Ca%20href%3D%22https%3A%2F%2Fwww.sciencedirect.com%2Fscience%2Farticle%2Fpii%2FS0168927498001044%22%3EAndersen%20et.%20al.%3C%2Fa%3E.%20For%20this%20example%2C%20we%20have%3A%0A%0A%20%20%20%20%24%24%0A%20%20%20%20%5Csigma%5E%7BT%7D%20%3D%20%5Cbegin%7Bpmatrix%7D%0A%20%20%20%20%5Csigma_%7B11%7D%5C%2C%20%2C%5C%2C%5Csigma_%7B21%7D%20%5C%5C%0A%20%20%20%20%5Csigma_%7B12%7D%5C%2C%20%2C%5C%2C%5Csigma_%7B22%7D%20%5C%5C%0A%20%20%20%20%5Cend%7Bpmatrix%7D%20%3D%20%5Cbegin%7Bpmatrix%7D%0A%20%20%20%20%5Csigma_%7B11%7D%5C%2C%20%2C%5C%2C%200.2%5Crho%5C%5C%0A%20%20%20%200.0%5C%2C%20%2C%20%5C%2C%20%5Csqrt%7B(0.2)%5E2%20-%20%5Csigma_%7B21%7D%5E2%7D%20%5C%5C%0A%20%20%20%20%5Cend%7Bpmatrix%7D%0A%20%20%20%20%24%24%0A%0A%20%20%20%20where%20%24%5Crho%24%20is%20the%20correlation%20between%20logarithms%20of%20the%20two%20securities.%20The%20%24%5Cepsilon%24%20matrix%20is%20given%20by%2C%0A%0A%20%20%20%20%24%24%5Cepsilon%20%3D%20%5Cbegin%7Bpmatrix%7D%0A%20%20%20%20%5Cepsilon_1%20(%5Comega_1)%2C%5Cepsilon_2%20(%5Comega_1)%20%5C%5C%0A%20%20%20%20%5Cepsilon_1%20(%5Comega_2)%2C%5Cepsilon_2%20(%5Comega_2)%20%5C%5C%0A%20%20%20%20%5Cepsilon_1%20(%5Comega_3)%2C%5Cepsilon_2%20(%5Comega_3)%0A%20%20%20%20%5Cend%7Bpmatrix%7D%20%3D%20%5Cbegin%7Bpmatrix%7D%0A%20%20%20%20%5Csqrt%7B2%7D%5C%2C%5C%2C%2C%5C%2C%5C%2C0%20%5C%5C%0A%20%20%20%20-1%2F%5Csqrt%7B2%7D%2C%5Csqrt%7B3%2F2%7D%20%5C%5C%0A%20%20%20%20-1%2F%5Csqrt%7B2%7D%2C%5Csqrt%7B3%2F2%7D%0A%20%20%20%20%5Cend%7Bpmatrix%7D%0A%20%20%20%20%24%24%0A%20%20%20%20%22%22%22)%0A%20%20%20%20return%0A%0A%0A%40app.cell(hide_code%3DTrue)%0Adef%20_(mo)%3A%0A%20%20%20%20mo.md(r%22%22%22%0A%20%20%20%20Moreover%2C%20we%20will%20consider%20different%20values%20for%20the%20transaction%20costs.%20There%20are%20three%20situations%20considered%20below%3A%20completely%20frictionless%20market%2C%20friction%20in%20one%20security%2C%20friction%20in%20both%20securities.%0A%0A%20%20%20%20%3Cb%3ENote%3C%2Fb%3E%3A%20In%20the%20code%2C%20we%20use%20the%20transpose%20of%20the%20sigma%20matrix%2C%20hence%20the%20shapes%20of%20the%20arrays%20that%20represent%20%24%5Csigma%24%20and%20%24%5Cepsilon%24%20must%20be%20maintained%20similar%20to%20what%20is%20shown%20in%20the%20code%20below.%0A%20%20%20%20%22%22%22)%0A%20%20%20%20return%0A%0A%0A%40app.cell(hide_code%3DTrue)%0Adef%20_(mo)%3A%0A%20%20%20%20mo.md(r%22%22%22%0A%20%20%20%20%3Cb%3E(g.)%20Reservation%20purchase%20price%20of%20a%20call%20option%20for%20T%3D9%20as%20a%20function%20of%20%24%5Crho%24%20and%20%24%5Ctheta_i%24%20in%20the%20presence%20of%20two%20risky%20securities.%3C%2Fb%3E%20(Consider%20Table%2010%2C%20%3Ca%20href%3D%22https%3A%2F%2Fwww.sciencedirect.com%2Fscience%2Farticle%2Fpii%2FS0168927498001044%22%3EAndersen%20et.%20al.%3C%2Fa%3E)%0A%20%20%20%20%22%22%22)%0A%20%20%20%20return%0A%0A%0A%40app.cell%0Adef%20_(%0A%20%20%20%20Option_Portfolio%2C%0A%20%20%20%20T_3%2C%0A%20%20%20%20dT_5%2C%0A%20%20%20%20np%2C%0A%20%20%20%20price_vector_abc%2C%0A%20%20%20%20price_vector_z%2C%0A%20%20%20%20q%2C%0A%20%20%20%20r_5%2C%0A)%3A%0A%20%20%20%20W_0_4%20%3D%201.0%0A%20%20%20%20gamma_6%20%3D%200.3%0A%20%20%20%20b_4%20%3D%201%0A%20%20%20%20c_7%20%3D%200.2%0A%20%20%20%20a_9%20%3D%20b_4%20%2F%20(1%20%2F%20c_7%20%2B%20W_0_4%20%2F%20(gamma_6%20-%201))%0A%20%20%20%20_util_paras%20%3D%20np.asarray(%5Ba_9%2C%20b_4%2C%20gamma_6%5D)%0A%20%20%20%20K_1%20%3D%201%0A%20%20%20%20sig11%20%3D%200.2%0A%20%20%20%20sig12%20%3D%200.0%0A%20%20%20%20eps_1%20%3D%20np.asarray(%5B%5Bnp.sqrt(2)%2C%200%5D%2C%20%5B-1%20%2F%20np.sqrt(2)%2C%20np.sqrt(3%20%2F%202)%5D%2C%20%5B-1%20%2F%20np.sqrt(2)%2C%20-np.sqrt(3%20%2F%202)%5D%5D)%0A%20%20%20%20S_v_0_1%20%3D%20%5B1.0%2C%201.0%5D%0A%20%20%20%20mu_1%20%3D%20np.asarray(%5B0.15%2C%200.15%5D)%0A%20%20%20%20rho%20%3D%20%5B1%2C%200.5%2C%200.0%2C%20-0.5%2C%20-0.9%5D%0A%20%20%20%20theta_2%20%3D%20%5B0.0%2C%200.0%5D%0A%20%20%20%20print('theta_1%20%3D%20%7B0%3A5.3f%7D%20%3B%20theta_2%20%3D%20%7B1%3A5.3f%7D'.format(theta_2%5B0%5D%2C%20theta_2%5B1%5D))%0A%20%20%20%20print('%7B0%3A%5E5%7D%20%20%7B1%3A%5E12%7D'.format('rho'%2C%20'C(S1%2CS2)'))%0A%20%20%20%20for%20_p%20in%20rho%3A%0A%20%20%20%20%20%20%20%20_sig21%20%3D%20_p%20*%200.2%0A%20%20%20%20%20%20%20%20sigma_1%20%3D%20np.asarray(%5B%5Bsig11%2C%20_sig21%5D%2C%20%5Bsig12%2C%20np.sqrt(0.2%20**%202%20-%20_sig21%20**%202)%5D%5D)%0A%20%20%20%20%20%20%20%20Z6%20%3D%20price_vector_z(sigma_1%2C%20eps_1%2C%20dT_5%2C%20q)%0A%20%20%20%20%20%20%20%20S_coeffs_6%20%3D%20price_vector_abc(sigma_1%2C%20eps_1%2C%20dT_5%2C%20q%2C%20mu_1%2C%20Z6)%0A%20%20%20%20%20%20%20%20_input_pars%20%3D%20%5BT_3%2C%20W_0_4%2C%20S_coeffs_6%2C%20theta_2%2C%20S_v_0_1%2C%20r_5%2C%20c_7%2C%20q%5D%0A%20%20%20%20%20%20%20%20print('%7B0%3A%5E%204.1f%7D%20%20%7B1%3A%5E12.10f%7D'.format(_p%2C%20Option_Portfolio(_input_pars%2C%20K_1%2C%20util_type%3D'EXP'%2C%20writeLog%3DFalse)))%0A%20%20%20%20return%20K_1%2C%20S_v_0_1%2C%20W_0_4%2C%20c_7%2C%20eps_1%2C%20mu_1%2C%20rho%2C%20sig11%2C%20sig12%0A%0A%0A%40app.cell%0Adef%20_(%0A%20%20%20%20K_1%2C%0A%20%20%20%20Option_Portfolio%2C%0A%20%20%20%20S_v_0_1%2C%0A%20%20%20%20T_3%2C%0A%20%20%20%20W_0_4%2C%0A%20%20%20%20c_7%2C%0A%20%20%20%20dT_5%2C%0A%20%20%20%20eps_1%2C%0A%20%20%20%20mu_1%2C%0A%20%20%20%20np%2C%0A%20%20%20%20price_vector_abc%2C%0A%20%20%20%20price_vector_z%2C%0A%20%20%20%20q%2C%0A%20%20%20%20r_5%2C%0A%20%20%20%20rho%2C%0A%20%20%20%20sig11%2C%0A%20%20%20%20sig12%2C%0A)%3A%0A%20%20%20%20theta_3%20%3D%20%5B0.005%2C%200.0%5D%0A%20%20%20%20print('theta_1%20%3D%20%7B0%3A5.3f%7D%20%3B%20theta_2%20%3D%20%7B1%3A5.3f%7D'.format(theta_3%5B0%5D%2C%20theta_3%5B1%5D))%0A%20%20%20%20print('%7B0%3A%5E5%7D%20%20%7B1%3A%5E12%7D'.format('rho'%2C%20'C(S1%2CS2)'))%0A%20%20%20%20for%20_p%20in%20rho%3A%0A%20%20%20%20%20%20%20%20_sig21%20%3D%20_p%20*%200.2%0A%20%20%20%20%20%20%20%20sigma_2%20%3D%20np.asarray(%5B%5Bsig11%2C%20_sig21%5D%2C%20%5Bsig12%2C%20np.sqrt(0.2%20**%202%20-%20_sig21%20**%202)%5D%5D)%0A%20%20%20%20%20%20%20%20Z7%20%3D%20price_vector_z(sigma_2%2C%20eps_1%2C%20dT_5%2C%20q)%0A%20%20%20%20%20%20%20%20S_coeffs_7%20%3D%20price_vector_abc(sigma_2%2C%20eps_1%2C%20dT_5%2C%20q%2C%20mu_1%2C%20Z7)%0A%20%20%20%20%20%20%20%20_input_pars%20%3D%20%5BT_3%2C%20W_0_4%2C%20S_coeffs_7%2C%20theta_3%2C%20S_v_0_1%2C%20r_5%2C%20c_7%2C%20q%5D%0A%20%20%20%20%20%20%20%20print('%7B0%3A%5E%204.2f%7D%20%20%7B1%3A%5E12.10f%7D'.format(_p%2C%20Option_Portfolio(_input_pars%2C%20K_1%2C%20util_type%3D'EXP'%2C%20writeLog%3DFalse)))%0A%20%20%20%20return%0A%0A%0A%40app.cell%0Adef%20_(%0A%20%20%20%20K_1%2C%0A%20%20%20%20Option_Portfolio%2C%0A%20%20%20%20S_v_0_1%2C%0A%20%20%20%20T_3%2C%0A%20%20%20%20W_0_4%2C%0A%20%20%20%20c_7%2C%0A%20%20%20%20dT_5%2C%0A%20%20%20%20eps_1%2C%0A%20%20%20%20mu_1%2C%0A%20%20%20%20np%2C%0A%20%20%20%20price_vector_abc%2C%0A%20%20%20%20price_vector_z%2C%0A%20%20%20%20q%2C%0A%20%20%20%20r_5%2C%0A%20%20%20%20rho%2C%0A%20%20%20%20sig11%2C%0A%20%20%20%20sig12%2C%0A)%3A%0A%20%20%20%20theta_4%20%3D%20%5B0.005%2C%200.005%5D%0A%20%20%20%20print('theta_1%20%3D%20%7B0%3A5.3f%7D%20%3B%20theta_2%20%3D%20%7B1%3A5.3f%7D'.format(theta_4%5B0%5D%2C%20theta_4%5B1%5D))%0A%20%20%20%20print('%7B0%3A%5E5%7D%20%20%7B1%3A%5E12%7D'.format('rho'%2C%20'C(S1%2CS2)'))%0A%20%20%20%20for%20_p%20in%20rho%3A%0A%20%20%20%20%20%20%20%20_sig21%20%3D%20_p%20*%200.2%0A%20%20%20%20%20%20%20%20sigma_3%20%3D%20np.asarray(%5B%5Bsig11%2C%20_sig21%5D%2C%20%5Bsig12%2C%20np.sqrt(0.2%20**%202%20-%20_sig21%20**%202)%5D%5D)%0A%20%20%20%20%20%20%20%20Z8%20%3D%20price_vector_z(sigma_3%2C%20eps_1%2C%20dT_5%2C%20q)%0A%20%20%20%20%20%20%20%20S_coeffs_8%20%3D%20price_vector_abc(sigma_3%2C%20eps_1%2C%20dT_5%2C%20q%2C%20mu_1%2C%20Z8)%0A%20%20%20%20%20%20%20%20_input_pars%20%3D%20%5BT_3%2C%20W_0_4%2C%20S_coeffs_8%2C%20theta_4%2C%20S_v_0_1%2C%20r_5%2C%20c_7%2C%20q%5D%0A%20%20%20%20%20%20%20%20print('%7B0%3A%5E%204.2f%7D%20%20%7B1%3A%5E12.10f%7D'.format(_p%2C%20Option_Portfolio(_input_pars%2C%20K_1%2C%20util_type%3D'EXP'%2C%20writeLog%3DFalse)))%0A%20%20%20%20return%0A%0A%0A%40app.cell(hide_code%3DTrue)%0Adef%20_(mo)%3A%0A%20%20%20%20mo.md(r%22%22%22%0A%20%20%20%20%3Cb%3E(h.)%20Reservation%20purchase%20price%20of%20a%20call%20option%20for%20T%3D9%2C%20as%20a%20function%20of%20%24%5Ctheta_i%24%2C%20in%20the%20case%20of%20two%20risky%20securities%3B%20%24%5Crho%20%3D%20-0.9%24.%3C%2Fb%3E%20(Consider%20Table%2011%2C%20%3Ca%20href%3D%22https%3A%2F%2Fwww.sciencedirect.com%2Fscience%2Farticle%2Fpii%2FS0168927498001044%22%3EAndersen%20et.%20al.%3C%2Fa%3E)%0A%20%20%20%20%22%22%22)%0A%20%20%20%20return%0A%0A%0A%40app.cell%0Adef%20_(%0A%20%20%20%20K_1%2C%0A%20%20%20%20Option_Portfolio%2C%0A%20%20%20%20S_v_0_1%2C%0A%20%20%20%20T_3%2C%0A%20%20%20%20W_0_4%2C%0A%20%20%20%20c_7%2C%0A%20%20%20%20dT_5%2C%0A%20%20%20%20eps_1%2C%0A%20%20%20%20mu_1%2C%0A%20%20%20%20np%2C%0A%20%20%20%20price_vector_abc%2C%0A%20%20%20%20price_vector_z%2C%0A%20%20%20%20q%2C%0A%20%20%20%20r_5%2C%0A%20%20%20%20sig11%2C%0A%20%20%20%20sig12%2C%0A)%3A%0A%20%20%20%20rho_1%20%3D%20-0.9%0A%20%20%20%20_sig21%20%3D%20rho_1%20*%200.2%0A%20%20%20%20sigma_4%20%3D%20np.asarray(%5B%5Bsig11%2C%20_sig21%5D%2C%20%5Bsig12%2C%20np.sqrt(0.2%20**%202%20-%20_sig21%20**%202)%5D%5D)%0A%20%20%20%20Z9%20%3D%20price_vector_z(sigma_4%2C%20eps_1%2C%20dT_5%2C%20q)%0A%20%20%20%20S_coeffs_9%20%3D%20price_vector_abc(sigma_4%2C%20eps_1%2C%20dT_5%2C%20q%2C%20mu_1%2C%20Z9)%0A%20%20%20%20theta_list%20%3D%20%5B0.0008%2C%200.0016%2C%200.003%2C%200.006%2C%200.01%2C%200.02%2C%200.05%2C%200.1%5D%0A%20%20%20%20print('%7B0%3A%5E5%7D%20%20%7B1%3A%5E12%7D'.format('theta'%2C%20'C(S1%2CS2)'))%0A%20%20%20%20for%20theta_i%20in%20theta_list%3A%0A%20%20%20%20%20%20%20%20theta_5%20%3D%20%5Btheta_i%2C%20theta_i%5D%0A%20%20%20%20%20%20%20%20_input_pars%20%3D%20%5BT_3%2C%20W_0_4%2C%20S_coeffs_9%2C%20theta_5%2C%20S_v_0_1%2C%20r_5%2C%20c_7%2C%20q%5D%0A%20%20%20%20%20%20%20%20print('%7B0%3A%5E5.4f%7D%20%20%7B1%3A%5E12.10f%7D'.format(theta_i%2C%20Option_Portfolio(_input_pars%2C%20K_1%2C%20util_type%3D'EXP'%2C%20writeLog%3DFalse)))%0A%20%20%20%20return%20(sigma_4%2C)%0A%0A%0A%40app.cell(hide_code%3DTrue)%0Adef%20_(mo)%3A%0A%20%20%20%20mo.md(r%22%22%22%0A%20%20%20%20%3Cb%3E(i.)%20Computational%20efficiency%20for%20different%20values%20of%20T%20(time%20periods).%3C%2Fb%3E%20(Consider%20Table%2012%2C%20%3Ca%20href%3D%22https%3A%2F%2Fwww.sciencedirect.com%2Fscience%2Farticle%2Fpii%2FS0168927498001044%22%3EAndersen%20et.%20al.%3C%2Fa%3E)%0A%20%20%20%20%22%22%22)%0A%20%20%20%20return%0A%0A%0A%40app.cell(hide_code%3DTrue)%0Adef%20_(mo)%3A%0A%20%20%20%20mo.md(r%22%22%22%0A%20%20%20%20The%20columns%20of%20the%20output%20table%20in%20the%20following%20cell%20denote%3A%20T%20(time%20periods)%2C%20cons.%20(number%20of%20constraints)%2C%20vars.%20(number%20of%20variables)%2C%20it.%20(number%20of%20iterations%20for%20the%20%3Ci%3Eno-option%3C%2Fi%3E%20model%20as%20well%20as%20the%20%3Ci%3Eoption-price%3C%2Fi%3E%20model)%2C%20time.%20(time%20taken%2C%20in%20seconds%20for%20both%20models).%0A%20%20%20%20%22%22%22)%0A%20%20%20%20return%0A%0A%0A%40app.cell%0Adef%20_(%0A%20%20%20%20K_1%2C%0A%20%20%20%20OptimizerError%2C%0A%20%20%20%20Option_Portfolio%2C%0A%20%20%20%20S_v_0_1%2C%0A%20%20%20%20SolutionError%2C%0A%20%20%20%20W_0_4%2C%0A%20%20%20%20c_7%2C%0A%20%20%20%20dT_5%2C%0A%20%20%20%20eps_1%2C%0A%20%20%20%20mu_1%2C%0A%20%20%20%20price_vector_abc%2C%0A%20%20%20%20price_vector_z%2C%0A%20%20%20%20q%2C%0A%20%20%20%20sigma_4%2C%0A)%3A%0A%20%20%20%20theta_6%20%3D%20%5B0.005%2C%200.005%5D%0A%20%20%20%20print('%7B0%3A%5E2%7D%20%20%7B1%3A%5E8%7D%20%20%7B2%3A%5E10%7D%20%20%7B3%3A%5E11%7D%20%20%7B4%3A%5E11%7D'.format(''%2C%20''%2C%20''%2C%20'No-option'%2C%20'Option-price'))%0A%20%20%20%20print('%7B0%3A%3E2%7D%20%20%7B1%3A%3E8%7D%20%20%7B2%3A%3E10%7D%20%20%7B3%3A%5E3%7D%20%20%7B4%3A%5E6%7D%20%20%7B5%3A%5E3%7D%20%20%7B6%3A%5E6%7D'.format('T'%2C%20'cons.'%2C%20'vars.'%2C%20'it.'%2C%20'time'%2C%20'it.'%2C%20'time'))%0A%20%20%20%20total_info_arr%20%3D%20%5B%5D%0A%20%20%20%20for%20T_4%20in%20range(1%2C%2010)%3A%0A%20%20%20%20%20%20%20%20try%3A%0A%20%20%20%20%20%20%20%20%20%20%20%20T_horizon_5%20%3D%201%20%2F%204%0A%20%20%20%20%20%20%20%20%20%20%20%20dt%20%3D%20T_horizon_5%20%2F%20T_4%0A%20%20%20%20%20%20%20%20%20%20%20%20r_6%20%3D%201.06%20**%20dT_5%20-%201%0A%20%20%20%20%20%20%20%20%20%20%20%20Z10%20%3D%20price_vector_z(sigma_4%2C%20eps_1%2C%20dT_5%2C%20q)%0A%20%20%20%20%20%20%20%20%20%20%20%20S_coeffs_10%20%3D%20price_vector_abc(sigma_4%2C%20eps_1%2C%20dT_5%2C%20q%2C%20mu_1%2C%20Z10)%0A%20%20%20%20%20%20%20%20%20%20%20%20_input_pars%20%3D%20%5BT_4%2C%20W_0_4%2C%20S_coeffs_10%2C%20theta_6%2C%20S_v_0_1%2C%20r_6%2C%20c_7%2C%20q%5D%0A%20%20%20%20%20%20%20%20%20%20%20%20call%2C%20n_cons%2C%20n_var%2C%20ut_it%2C%20ut_time%2C%20price_it%2C%20price_time%20%3D%20Option_Portfolio(_input_pars%2C%20K_1%2C%20util_type%3D'EXP'%2C%20writeLog%3DFalse%2C%20solver_info%3DTrue)%0A%20%20%20%20%20%20%20%20%20%20%20%20print('%7B0%3A%3E2d%7D%20%20%7B1%3A%3E8d%7D%20%20%7B2%3A%3E10d%7D%20%20%7B3%3A%3E3d%7D%20%20%7B4%3A%3E6.3f%7D%20%20%7B5%3A%3E3d%7D%20%20%7B6%3A%3E6.3f%7D'.format(T_4%2C%20n_cons%2C%20n_var%2C%20ut_it%2C%20ut_time%2C%20price_it%2C%20price_time))%0A%20%20%20%20%20%20%20%20%20%20%20%20total_info_arr.append(%5Bcall%2C%20n_cons%2C%20n_var%2C%20ut_it%2C%20ut_time%2C%20price_it%2C%20price_time%5D)%0A%20%20%20%20%20%20%20%20except%20MemoryError%20as%20e%3A%0A%20%20%20%20%20%20%20%20%20%20%20%20print(e)%0A%20%20%20%20%20%20%20%20%20%20%20%20break%0A%20%20%20%20%20%20%20%20except%20SolutionError%20as%20s%3A%0A%20%20%20%20%20%20%20%20%20%20%20%20print(s)%0A%20%20%20%20%20%20%20%20except%20OptimizerError%20as%20e%3A%0A%20%20%20%20%20%20%20%20%20%20%20%20print(e)%0A%20%20%20%20%20%20%20%20%20%20%20%20break%0A%20%20%20%20return%0A%0A%0A%40app.cell(hide_code%3DTrue)%0Adef%20_(mo)%3A%0A%20%20%20%20mo.md(r%22%22%22%0A%20%20%20%20The%20calculations%20shown%20above%20were%20performed%20on%20a%20desktop%20with%2015.6%20GB%20of%20RAM%20and%20an%20Intel%24%5E%5CcircledR%24%20Core%24%5E%7B%5Ctext%7BTM%7D%7D%24%20i7-6770HQ%20CPU%20%40%202.6%20GHz%20%24%5Ctimes%24%208.%0A%20%20%20%20%22%22%22)%0A%20%20%20%20return%0A%0A%0A%40app.cell(hide_code%3DTrue)%0Adef%20_(mo)%3A%0A%20%20%20%20mo.md(r%22%22%22%0A%20%20%20%20%3Ca%20rel%3D%22license%22%20href%3D%22http%3A%2F%2Fcreativecommons.org%2Flicenses%2Fby%2F4.0%2F%22%3E%3Cimg%20alt%3D%22Creative%20Commons%20License%22%20style%3D%22border-width%3A0%22%20src%3D%22https%3A%2F%2Fi.creativecommons.org%2Fl%2Fby%2F4.0%2F80x15.png%22%20%2F%3E%3C%2Fa%3E%3Cbr%20%2F%3EThis%20work%20is%20licensed%20under%20a%20%3Ca%20rel%3D%22license%22%20href%3D%22http%3A%2F%2Fcreativecommons.org%2Flicenses%2Fby%2F4.0%2F%22%3ECreative%20Commons%20Attribution%204.0%20International%20License%3C%2Fa%3E.%20The%20**MOSEK**%20logo%20and%20name%20are%20trademarks%20of%20%3Ca%20href%3D%22http%3A%2F%2Fmosek.com%22%3EMosek%20ApS%3C%2Fa%3E.%20The%20code%20is%20provided%20as-is.%20Compatibility%20with%20future%20release%20of%20**MOSEK**%20or%20the%20%60Fusion%20API%60%20are%20not%20guaranteed.%20For%20more%20information%20contact%20our%20%5Bsupport%5D(mailto%3Asupport%40mosek.com).%0A%20%20%20%20%22%22%22)%0A%20%20%20%20return%0A%0A%0A%40app.cell(hide_code%3DTrue)%0Adef%20_()%3A%0A%20%20%20%20import%20marimo%20as%20mo%0A%20%20%20%20return%20(mo%2C)%0A%0A%0Aif%20__name__%20%3D%3D%20%22__main__%22%3A%0A%20%20%20%20app.run()%0A
</marimo-code>

<marimo-code-hash hidden="">73706384db58f5ec67056771a1ea898f</marimo-code-hash>
</body>
</html>
